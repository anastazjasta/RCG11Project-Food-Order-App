(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"./node_modules/angular-intro.js/src/angular-intro.js":function(e,t,n){var i,r,s;r=[n("./node_modules/angular/index.js"),n("./node_modules/intro.js/intro.js")],void 0===(s="function"==typeof(i=function(a,o){if(typeof o=="object")o=o.introJs;var e=a.module("angular-intro",[]);function l(){this.message="Intro.js is not available. Make sure it is properly loaded.";this.name="IntroJsNotAvailable"}return e.factory("ngIntroService",["$q",function(e){if("function"!=typeof o)throw new l;var n,i={},t={addListener:function(e,t){a.isFunction(t)&&(i[e]=t)},removeListener:function(e){delete i[e]},setOptions:function(e){n.setOptions(e)},start:function(e){"number"==typeof e?n.start().goToStep(e):n.start();r("open")},exit:function(){n.exit(),r("closed")},clear:s,previous:function(){n.previousStep(),r("open")},next:function(){n.nextStep(),r("open")},refresh:function(){n.refresh()},onComplete:function(e){return n.oncomplete(function(){a.isFunction(e)&&e(),r("closed")})},onExit:function(e){return n.onexit(function(){r("closed"),a.isFunction(e)&&e()})},onBeforeChange:function(t){return n.onbeforechange(function(e){a.isFunction(t)&&t(e)})},onAfterChange:function(t){return n.onafterchange(function(e){a.isFunction(t)&&t(e)})},onChange:function(t){return n.onchange(function(e){a.isFunction(t)&&t(e)})},addHints:function(){return n.addHints()},showHints:function(){return n.showHints()},hideHint:function(e){return n.hideHint(e)},hideHints:function(){return n.hideHints()},onHintClick:function(e){n.onhintclick(function(){a.isFunction(e)&&e()})},onHintClose:function(e){return n.onhintclose(function(){a.isFunction(e)&&e()})},onHintsAdded:function(e){return n.onhintclose(function(){a.isFunction(e)&&e()})}};function r(e){for(var t in i)i.hasOwnProperty(t)&&a.isFunction(i[t])&&i[t](e)}function s(e){return void 0!==n&&n.exit(),n=new o,r("closed"),a.isFunction(e)&&e(),n}return Object.defineProperty(t,"intro",{get:function(){return n},enumerable:!0,configurable:!0}),s(),t}]).directive("ngIntroDisableButton",["ngIntroService","$compile",function(r,e){var s=0;return{restrict:"A",priority:1,scope:{introDisableButton:"="},link:function(e,t,n){var i="disabledBtn"+s++;r.addListener(i,function(e){"open"===e?n.$set("disabled","disabled"):(delete n.disabled,t.removeAttr("disabled"))}),e.$on("$destroy",function(){r.removeListener(i)})}}}]).directive("ngIntroOptions",["$timeout","ngIntroService",function(s,o){return{restrict:"A",scope:{ngIntroMethod:"=",ngIntroExitMethod:"=?",ngIntroNextMethod:"=?",ngIntroPreviousMethod:"=?",ngIntroRefreshMethod:"=?",ngIntroOptions:"=",ngIntroOncomplete:"=",ngIntroOnexit:"=",ngIntroOnchange:"=",ngIntroOnbeforechange:"=",ngIntroOnafterchange:"=",ngIntroAutostart:"=",ngIntroAutorefresh:"=",ngIntroHintsMethod:"=?",ngIntroOnhintsadded:"=",ngIntroOnhintclick:"=?",ngIntroOnhintclose:"=?",ngIntroShowHint:"=?",ngIntroShowHints:"=?",ngIntroHideHint:"=?",ngIntroHideHints:"=?"},link:function(t,e,n){var i=[];t.ngIntroOncomplete&&o.onComplete(t.ngIntroOncomplete),t.ngIntroOnexit&&o.onExit(t.ngIntroOnexit),t.ngIntroOnbeforechange&&o.onBeforeChange(t.ngIntroOnbeforechange),t.ngIntroOnchange&&o.onChange(t.ngIntroOnchange),t.ngIntroOnafterchange&&o.onAfterChange(t.ngIntroOnafterchange),t.ngIntroMethod=function(e){o.setOptions(t.ngIntroOptions),o.start(e)},t.ngIntroHintsMethod=function(){o.setOptions(t.ngIntroOptions),o.start(step),t.ngIntroOnhintsadded&&o.onHintsAdded(t.ngIntroOnbeforechange),t.ngIntroOnhintclick&&o.onHintClick(t.ngIntroOnbeforechange),t.ngIntroOnhintclose&&o.onHintClick(t.ngIntroOnbeforechange),intro.addHints()},t.ngIntroShowHint=function(e){o.showHint(e)},t.ngIntroShowHints=function(){o.showHints()},t.ngIntroHideHint=function(e){o.hideHint(e)},t.ngIntroHideHints=function(){o.hideHints()},t.ngIntroNextMethod=function(){o.next()},t.ngIntroPreviousMethod=function(){o.previous()},t.ngIntroExitMethod=function(e){o.exit(),a.isFunction(e)&&e()},t.ngIntroRefreshMethod=function(){o.refresh()};var r=t.$watch("ngIntroAutostart",function(){t.ngIntroAutostart&&s(function(){t.ngIntroMethod()}),r()});i.push(t.$on("$locationChangeStart",function(){o.exit()})),i.push(t.$on("$locationChangeSuccess",function(){o.exit()})),t.ngIntroAutorefresh&&i.push(t.$watch(function(){o.refresh()})),i.push(t.$on("$destroy",function(){o.exit()})),t.$on("$destroy",function(){!function(){for(var e=0;e>i.length;e++)i[e]()}()})}}}]),e})?i.apply(t,r):i)||(e.exports=s)},"./node_modules/angular-moment/angular-moment.js":function(e,t,n){var i,r,s;!function(){"use strict";function k(e){return angular.isUndefined(e)||null===e}window&&window.process&&window.process.type;r=[n("./node_modules/angular/index.js"),n("./node_modules/moment/moment.js")],void 0===(s="function"==typeof(i=function(j,e){return void 0===e&&(e=function(){try{return n("./node_modules/moment/moment.js")}catch(e){throw new Error("Please install moment via npm. Please reference to: https://github.com/urish/angular-moment")}}()),j.module("angularMoment",[]).constant("angularMomentConfig",{preprocess:null,timezone:null,format:null,statefulFilters:!0}).constant("moment",e).constant("amTimeAgoConfig",{withoutSuffix:!1,serverTime:null,titleFormat:null,fullDateThreshold:null,fullDateFormat:null,fullDateThresholdUnit:"day"}).directive("amTimeAgo",["$window","moment","amMoment","amTimeAgoConfig",function(y,b,x,w){return function(e,o,t){var n,i,a=null,l=w.withoutSuffix,c=w.titleFormat,d=w.fullDateThreshold,h=w.fullDateFormat,u=w.fullDateThresholdUnit,r=(new Date).getTime(),s=t.amTimeAgo,f="TIME"===o[0].nodeName.toUpperCase(),p=!o.attr("title");function g(){var e;if(i)e=i;else if(w.serverTime){var t=(new Date).getTime()-r+w.serverTime;e=b(t)}else e=b();return e}function _(){a&&(y.clearTimeout(a),a=null)}function m(e){f&&o.attr("datetime",e)}function v(){if(_(),n){var e=x.preprocessDate(n);!function e(t){var n=g().diff(t,u),i=d&&d<=n;if(i?o.text(t.format(h)):o.text(t.from(g(),l)),c&&p&&o.attr("title",t.format(c)),!i){var r=Math.abs(g().diff(t,"minute")),s=3600;r<1?s=1:r<60?s=30:r<180&&(s=300),a=y.setTimeout(function(){e(t)},1e3*s)}}(e),m(e.toISOString())}}e.$watch(s,function(e){if(k(e)||""===e)return _(),void(n&&(o.text(""),m(""),n=null));n=e,v()}),j.isDefined(t.amFrom)&&e.$watch(t.amFrom,function(e){i=k(e)||""===e?null:b(e),v()}),j.isDefined(t.amWithoutSuffix)&&e.$watch(t.amWithoutSuffix,function(e){"boolean"==typeof e?(l=e,v()):l=w.withoutSuffix}),t.$observe("amFullDateThreshold",function(e){d=e,v()}),t.$observe("amFullDateFormat",function(e){h=e,v()}),t.$observe("amFullDateThresholdUnit",function(e){u=e,v()}),e.$on("$destroy",function(){_()}),e.$on("amMoment:localeChanged",function(){v()})}}]).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(i,r,t,n){var s=null;this.changeLocale=function(e,t){var n=i.locale(e,t);return j.isDefined(e)&&r.$broadcast("amMoment:localeChanged"),n},this.changeTimezone=function(e){i.tz&&i.tz.setDefault?(i.tz.setDefault(e),r.$broadcast("amMoment:timezoneChanged")):t.warn("angular-moment: changeTimezone() works only with moment-timezone.js v0.3.0 or greater."),n.timezone=e,s=e},this.preprocessDate=function(e){return s!==n.timezone&&this.changeTimezone(n.timezone),n.preprocess?n.preprocess(e):!isNaN(parseFloat(e))&&isFinite(e)?i(parseInt(e,10)):i(e)}}]).filter("amParse",["moment",function(n){return function(e,t){return n(e,t)}}]).filter("amFromUnix",["moment",function(t){return function(e){return t.unix(e)}}]).filter("amUtc",["moment",function(t){return function(e){return t.utc(e)}}]).filter("amUtcOffset",["amMoment",function(n){return function(e,t){return n.preprocessDate(e).utcOffset(t)}}]).filter("amLocal",["moment",function(t){return function(e){return t.isMoment(e)?e.local():null}}]).filter("amTimezone",["amMoment","angularMomentConfig","$log",function(i,e,r){return function(e,t){var n=i.preprocessDate(e);return t?n.tz?n.tz(t):(r.warn("angular-moment: named timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js ?"),n):n}}]).filter("amCalendar",["moment","amMoment","angularMomentConfig",function(e,r,t){function n(e,t,n){if(k(e))return"";var i=r.preprocessDate(e);return i.isValid()?i.calendar(t,n):""}return n.$stateful=t.statefulFilters,n}]).filter("amDifference",["moment","amMoment","angularMomentConfig",function(o,a,e){function t(e,t,n,i){if(k(e))return"";var r=a.preprocessDate(e),s=k(t)?o():a.preprocessDate(t);return r.isValid()&&s.isValid()?r.diff(s,n,i):""}return t.$stateful=e.statefulFilters,t}]).filter("amDateFormat",["moment","amMoment","angularMomentConfig",function(e,i,t){function n(e,t){if(k(e))return"";var n=i.preprocessDate(e);return n.isValid()?n.format(t):""}return n.$stateful=t.statefulFilters,n}]).filter("amDurationFormat",["moment","angularMomentConfig",function(i,e){function t(e,t,n){return k(e)?"":i.duration(e,t).humanize(n)}return t.$stateful=e.statefulFilters,t}]).filter("amTimeAgo",["moment","amMoment","angularMomentConfig",function(s,o,e){function t(e,t,n){var i,r;return k(e)?"":(e=o.preprocessDate(e),(i=s(e)).isValid()?(r=s(n),!k(n)&&r.isValid()?i.from(r,t):i.fromNow(t)):"")}return t.$stateful=e.statefulFilters,t}]).filter("amSubtract",["moment","angularMomentConfig",function(i,e){function t(e,t,n){return k(e)?"":i(e).subtract(parseInt(t,10),n)}return t.$stateful=e.statefulFilters,t}]).filter("amAdd",["moment","angularMomentConfig",function(i,e){function t(e,t,n){return k(e)?"":i(e).add(parseInt(t,10),n)}return t.$stateful=e.statefulFilters,t}]).filter("amStartOf",["moment","angularMomentConfig",function(n,e){function t(e,t){return k(e)?"":n(e).startOf(t)}return t.$stateful=e.statefulFilters,t}]).filter("amEndOf",["moment","angularMomentConfig",function(n,e){function t(e,t){return k(e)?"":n(e).endOf(t)}return t.$stateful=e.statefulFilters,t}]),"angularMoment"})?i.apply(t,r):i)||(e.exports=s)}()},"./node_modules/checklist-model/checklist-model.js":function(e,t,n){e.exports===t&&(e.exports="checklist-model"),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(_,m){function v(e,t,n){if(angular.isArray(e))for(var i=e.length;i--;)if(n(e[i],t))return!0;return!1}function y(e,t,n){return v(e=angular.isArray(e)?e:[],t,n)||e.push(t),e}function b(e,t,n){if(angular.isArray(e))for(var i=e.length;i--;)if(n(e[i],t)){e.splice(i,1);break}return e}function n(i,e,r){var t=r.checklistModel;r.$set("checklistModel",null),m(e)(i),r.$set("checklistModel",t);var s=_(t),n=_(r.checklistChange),o=_(r.checklistBeforeChange),a=_(r.ngModel),l=function(e,t){return isNaN(e)||isNaN(t)?angular.equals(e,t):String(e)===String(t)};if(r.hasOwnProperty("checklistComparator"))if("."==r.checklistComparator[0]){var c=r.checklistComparator.substring(1);l=function(e,t){return e[c]===t[c]}}else l=_(r.checklistComparator)(i.$parent);var d=i.$watch(r.ngModel,function(e,t){e!==t&&(o&&!1===o(i)?a.assign(i,v(s(i.$parent),f(),l)):(p(f(),e),n&&n(i)))}),h=i.$watch(f,function(e,t){if(e!=t&&angular.isDefined(t)&&!0===i[r.ngModel]){var n=s(i.$parent);s.assign(i.$parent,b(n,t,l)),s.assign(i.$parent,y(n,e,l))}},!0),u=i.$on("$destroy",function(){d(),h(),u()});function f(){return r.checklistValue?_(r.checklistValue)(i.$parent):r.value}function p(e,t){var n=s(i.$parent);angular.isFunction(s.assign)&&(!0===t?s.assign(i.$parent,y(n,e,l)):s.assign(i.$parent,b(n,e,l)))}function g(e,t){o&&!1===o(i)?p(f(),a(i)):a.assign(i,v(e,f(),l))}angular.isFunction(i.$parent.$watchCollection)?i.$parent.$watchCollection(t,g):i.$parent.$watch(t,g,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if(!t.checklistValue&&!t.value)throw"You should provide `value` or `checklist-value`.";return t.ngModel||t.$set("ngModel","checked"),n}}}])},"./node_modules/firepad/dist/firepad.js":function(e,t){var n,i;n=function(){var t,u;function e(e,t){this.pos=e,this.length=t}function n(e){this.type=e,this.chars=null,this.text=null,this.attributes=null,"insert"===e?(this.text=arguments[1],t.assert("string"==typeof this.text),this.attributes=arguments[2]||{},t.assert("object"==typeof this.attributes)):"delete"===e?(this.chars=arguments[1],t.assert("number"==typeof this.chars)):"retain"===e&&(this.chars=arguments[1],t.assert("number"==typeof this.chars),this.attributes=arguments[2]||{},t.assert("object"==typeof this.attributes))}function i(e){this.imageInsertionUI=e,this.element_=this.makeElement_()}(M=M||{}).utils={},M.utils.makeEventEmitter=function(e,t){e.prototype.allowedEvents_=t,e.prototype.on=function(e,t,n){this.validateEventType_(e),this.eventListeners_=this.eventListeners_||{},this.eventListeners_[e]=this.eventListeners_[e]||[],this.eventListeners_[e].push({callback:t,context:n})},e.prototype.off=function(e,t){this.validateEventType_(e),this.eventListeners_=this.eventListeners_||{};for(var n=this.eventListeners_[e]||[],i=0;i<n.length;i++)if(n[i].callback===t)return void n.splice(i,1)},e.prototype.trigger=function(e){this.eventListeners_=this.eventListeners_||{};for(var t=this.eventListeners_[e]||[],n=0;n<t.length;n++)t[n].callback.apply(t[n].context,Array.prototype.slice.call(arguments,1))},e.prototype.validateEventType_=function(e){if(this.allowedEvents_){for(var t=!1,n=0;n<this.allowedEvents_.length;n++)if(this.allowedEvents_[n]===e){t=!0;break}if(!t)throw new Error('Unknown event "'+e+'"')}}},M.utils.elt=function(e,t,n){var i=document.createElement(e);if("string"==typeof t)M.utils.setTextContent(i,t);else if(t)for(var r=0;r<t.length;++r)i.appendChild(t[r]);for(var s in n||{})i.setAttribute(s,n[s]);return i},M.utils.setTextContent=function(e,t){e.innerHTML="",e.appendChild(document.createTextNode(t))},M.utils.on=function(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n)},M.utils.off=function(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n)},M.utils.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},M.utils.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},M.utils.stopEvent=function(e){M.utils.preventDefault(e),M.utils.stopPropagation(e)},M.utils.stopEventAnd=function(t){return function(e){return t(e),M.utils.stopEvent(e),!1}},M.utils.trim=function(e){return e.replace(/^\s+/g,"").replace(/\s+$/g,"")},M.utils.stringEndsWith=function(e,t){for(var n="string"==typeof t?[t]:t,i=0;i<n.length;i++){t=n[i];if(-1!==e.indexOf(t,e.length-t.length))return!0}return!1},M.utils.assert=function(e,t){if(!e)throw new Error(t||"assertion error")},M.utils.log=function(){if("undefined"!=typeof console&&void 0!==console.log)for(var e=["Firepad:"],t=0;t<arguments.length;t++)e.push(arguments[t])},(M=M||{}).Span=(e.prototype.end=function(){return this.pos+this.length},e),(M=M||{}).TextOp=(t=M.utils,n.prototype.isInsert=function(){return"insert"===this.type},n.prototype.isDelete=function(){return"delete"===this.type},n.prototype.isRetain=function(){return"retain"===this.type},n.prototype.equals=function(e){return this.type===e.type&&this.text===e.text&&this.chars===e.chars&&this.attributesEqual(e.attributes)},n.prototype.attributesEqual=function(e){for(var t in this.attributes)if(this.attributes[t]!==e[t])return!1;for(t in e)if(this.attributes[t]!==e[t])return!1;return!0},n.prototype.hasEmptyAttributes=function(){var e=!0;for(var t in this.attributes){e=!1;break}return e},n),(M=M||{}).TextOperation=function(){"use strict";var r=M.TextOp,_=M.utils;function u(){if(!this||this.constructor!==u)return new u;this.ops=[],this.baseLength=0,this.targetLength=0}function s(e){var t=e.ops;switch(t.length){case 1:return t[0];case 2:return t[0].isRetain()?t[1]:t[1].isRetain()?t[0]:null;case 3:if(t[0].isRetain()&&t[2].isRetain())return t[1]}return null}function o(e){return e.ops[0].isRetain()?e.ops[0].chars:0}return u.prototype.equals=function(e){if(this.baseLength!==e.baseLength)return!1;if(this.targetLength!==e.targetLength)return!1;if(this.ops.length!==e.ops.length)return!1;for(var t=0;t<this.ops.length;t++)if(!this.ops[t].equals(e.ops[t]))return!1;return!0},u.prototype.retain=function(e,t){if("number"!=typeof e||e<0)throw new Error("retain expects a positive integer.");if(0===e)return this;this.baseLength+=e,this.targetLength+=e,t=t||{};var n=0<this.ops.length?this.ops[this.ops.length-1]:null;return n&&n.isRetain()&&n.attributesEqual(t)?n.chars+=e:this.ops.push(new r("retain",e,t)),this},u.prototype.insert=function(e,t){if("string"!=typeof e)throw new Error("insert expects a string");if(""===e)return this;t=t||{},this.targetLength+=e.length;var n=0<this.ops.length?this.ops[this.ops.length-1]:null,i=1<this.ops.length?this.ops[this.ops.length-2]:null;return n&&n.isInsert()&&n.attributesEqual(t)?n.text+=e:n&&n.isDelete()?i&&i.isInsert()&&i.attributesEqual(t)?i.text+=e:(this.ops[this.ops.length-1]=new r("insert",e,t),this.ops.push(n)):this.ops.push(new r("insert",e,t)),this},u.prototype.delete=function(e){if("string"==typeof e&&(e=e.length),"number"!=typeof e||e<0)throw new Error("delete expects a positive integer or a string");if(0===e)return this;this.baseLength+=e;var t=0<this.ops.length?this.ops[this.ops.length-1]:null;return t&&t.isDelete()?t.chars+=e:this.ops.push(new r("delete",e)),this},u.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()},u.prototype.clone=function(){for(var e=new u,t=0;t<this.ops.length;t++)this.ops[t].isRetain()?e.retain(this.ops[t].chars,this.ops[t].attributes):this.ops[t].isInsert()?e.insert(this.ops[t].text,this.ops[t].attributes):e.delete(this.ops[t].chars);return e},u.prototype.toString=function(){return(Array.prototype.map||function(e){for(var t=[],n=0,i=this.length;n<i;n++)t[n]=e(this[n]);return t}).call(this.ops,function(e){return e.isRetain()?"retain "+e.chars:e.isInsert()?"insert '"+e.text+"'":"delete "+e.chars}).join(", ")},u.prototype.toJSON=function(){for(var e=[],t=0;t<this.ops.length;t++)this.ops[t].hasEmptyAttributes()||e.push(this.ops[t].attributes),"retain"===this.ops[t].type?e.push(this.ops[t].chars):"insert"===this.ops[t].type?e.push(this.ops[t].text):"delete"===this.ops[t].type&&e.push(-this.ops[t].chars);return 0===e.length&&e.push(0),e},u.fromJSON=function(e){for(var t=new u,n=0,i=e.length;n<i;n++){var r=e[n],s={};"object"==typeof r&&(s=r,r=e[++n]),"number"==typeof r?0<r?t.retain(r,s):t.delete(-r):(_.assert("string"==typeof r),t.insert(r,s))}return t},u.prototype.apply=function(e,t,n){if(t=t||[],n=n||[],e.length!==this.baseLength)throw new Error("The operation's base length must be equal to the string's length.");for(var i,r,s=[],o=0,a=0,l=this.ops,c=0,d=l.length;c<d;c++){var h=l[c];if(h.isRetain()){if(a+h.chars>e.length)throw new Error("Operation can't retain more characters than are left in the string.");for(s[o++]=e.slice(a,a+h.chars),i=0;i<h.chars;i++){var u=t[a+i]||{},f={};for(r in u)f[r]=u[r],_.assert(!1!==f[r]);for(r in h.attributes)!1===h.attributes[r]?delete f[r]:f[r]=h.attributes[r],_.assert(!1!==f[r]);n.push(f)}a+=h.chars}else if(h.isInsert())for(s[o++]=h.text,i=0;i<h.text.length;i++){var p={};for(r in h.attributes)p[r]=h.attributes[r],_.assert(!1!==p[r]);n.push(p)}else a+=h.chars}if(a!==e.length)throw new Error("The operation didn't operate on the whole string.");var g=s.join("");return _.assert(g.length===n.length),g},u.prototype.invert=function(e){for(var t=0,n=new u,i=this.ops,r=0,s=i.length;r<s;r++){var o=i[r];o.isRetain()?(n.retain(o.chars),t+=o.chars):o.isInsert()?n.delete(o.text.length):(n.insert(e.slice(t,t+o.chars)),t+=o.chars)}return n},u.prototype.compose=function(e){if(this.targetLength!==e.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");function t(e,t,n){var i,r={};for(i in e)r[i]=e[i];for(i in t)n&&!1===t[i]?delete r[i]:r[i]=t[i];return r}for(var n,i=new u,r=this.clone().ops,s=e.clone().ops,o=0,a=0,l=r[o++],c=s[a++];void 0!==l||void 0!==c;)if(l&&l.isDelete())i.delete(l.chars),l=r[o++];else if(c&&c.isInsert())i.insert(c.text,c.attributes),c=s[a++];else{if(void 0===l)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===c)throw new Error("Cannot compose operations: first operation is too long.");if(l.isRetain()&&c.isRetain())n=t(l.attributes,c.attributes),l.chars>c.chars?(i.retain(c.chars,n),l.chars-=c.chars,c=s[a++]):l.chars===c.chars?(i.retain(l.chars,n),l=r[o++],c=s[a++]):(i.retain(l.chars,n),c.chars-=l.chars,l=r[o++]);else if(l.isInsert()&&c.isDelete())l.text.length>c.chars?(l.text=l.text.slice(c.chars),c=s[a++]):l.text.length===c.chars?(l=r[o++],c=s[a++]):(c.chars-=l.text.length,l=r[o++]);else if(l.isInsert()&&c.isRetain())n=t(l.attributes,c.attributes,!0),l.text.length>c.chars?(i.insert(l.text.slice(0,c.chars),n),l.text=l.text.slice(c.chars),c=s[a++]):l.text.length===c.chars?(i.insert(l.text,n),l=r[o++],c=s[a++]):(i.insert(l.text,n),c.chars-=l.text.length,l=r[o++]);else{if(!l.isRetain()||!c.isDelete())throw new Error("This shouldn't happen: op1: "+JSON.stringify(l)+", op2: "+JSON.stringify(c));l.chars>c.chars?(i.delete(c.chars),l.chars-=c.chars,c=s[a++]):l.chars===c.chars?(i.delete(c.chars),l=r[o++],c=s[a++]):(i.delete(l.chars),c.chars-=l.chars,l=r[o++])}}return i},u.prototype.shouldBeComposedWith=function(e){if(this.isNoop()||e.isNoop())return!0;var t=o(this),n=o(e),i=s(this),r=s(e);return!(!i||!r)&&(i.isInsert()&&r.isInsert()?t+i.text.length===n:!(!i.isDelete()||!r.isDelete())&&(n+r.chars===t||t===n))},u.prototype.shouldBeComposedWithInverted=function(e){if(this.isNoop()||e.isNoop())return!0;var t=o(this),n=o(e),i=s(this),r=s(e);return!(!i||!r)&&(i.isInsert()&&r.isInsert()?t+i.text.length===n||t===n:!(!i.isDelete()||!r.isDelete())&&n+r.chars===t)},u.transformAttributes=function(e,t){var n,i={},r={},s={};for(n in e)s[n]=!0;for(n in t)s[n]=!0;for(n in s){var o=e[n],a=t[n];_.assert(null!=o||null!=a),null==o?r[n]=a:null!=a&&o===a||(i[n]=o)}return[i,r]},u.transform=function(e,t){if(e.baseLength!==t.baseLength)throw new Error("Both operations have to have the same base length");for(var n=new u,i=new u,r=e.clone().ops,s=t.clone().ops,o=0,a=0,l=r[o++],c=s[a++];void 0!==l||void 0!==c;)if(l&&l.isInsert())n.insert(l.text,l.attributes),i.retain(l.text.length),l=r[o++];else if(c&&c.isInsert())n.retain(c.text.length),i.insert(c.text,c.attributes),c=s[a++];else{if(void 0===l)throw new Error("Cannot transform operations: first operation is too short.");if(void 0===c)throw new Error("Cannot transform operations: first operation is too long.");var d;if(l.isRetain()&&c.isRetain()){var h=u.transformAttributes(l.attributes,c.attributes);l.chars>c.chars?(d=c.chars,l.chars-=c.chars,c=s[a++]):l.chars===c.chars?(d=c.chars,l=r[o++],c=s[a++]):(d=l.chars,c.chars-=l.chars,l=r[o++]),n.retain(d,h[0]),i.retain(d,h[1])}else if(l.isDelete()&&c.isDelete())l.chars>c.chars?(l.chars-=c.chars,c=s[a++]):l.chars===c.chars?(l=r[o++],c=s[a++]):(c.chars-=l.chars,l=r[o++]);else if(l.isDelete()&&c.isRetain())l.chars>c.chars?(d=c.chars,l.chars-=c.chars,c=s[a++]):l.chars===c.chars?(d=c.chars,l=r[o++],c=s[a++]):(d=l.chars,c.chars-=l.chars,l=r[o++]),n.delete(d);else{if(!l.isRetain()||!c.isDelete())throw new Error("The two operations aren't compatible");l.chars>c.chars?(d=c.chars,l.chars-=c.chars,c=s[a++]):l.chars===c.chars?(d=l.chars,l=r[o++],c=s[a++]):(d=l.chars,c.chars-=l.chars,l=r[o++]),i.delete(d)}}return[n,i]},u.prototype.transform=function(e){return u.transform(this,e)},u}(),(M=M||{}).AnnotationList=function(){var l=M.Span;function d(e,t){if(!e)throw new Error("AnnotationList assertion failed"+(t?": "+t:""))}function u(e,t){this.pos=e,this.length=t.length,this.annotation=t.annotation,this.attachedObject_=t.attachedObject}function f(e,t){this.pos=e,this.length=t.length,this.annotation=t.annotation,this.node_=t}u.prototype.getAttachedObject=function(){return this.attachedObject_},f.prototype.attachObject=function(e){this.node_.attachedObject=e};var h={equals:function(){return!1}};function e(e){this.head_=new p(0,h),this.changeHandler_=e}function p(e,t){this.length=e,this.annotation=t,this.attachedObject=null,this.next=null}return e.prototype.insertAnnotatedSpan=function(r,s){this.wrapOperation_(new l(r.pos,0),function(e,t){d(!t||null===t.next);var n=new p(r.length,s);if(t){d(r.pos>e&&r.pos<e+t.length);var i=new p(0,h);return i.next=new p(r.pos-e,t.annotation),(i.next.next=n).next=new p(e+t.length-r.pos,t.annotation),i.next}return n})},e.prototype.removeSpan=function(s){0!==s.length&&this.wrapOperation_(s,function(e,t){d(null!==t);var n=new p(0,h),i=n;for(s.pos>e&&(i.next=new p(s.pos-e,t.annotation),i=i.next);s.end()>e+t.length;)e+=t.length,t=t.next;var r=e+t.length-s.end();return 0<r&&(i.next=new p(r,t.annotation)),n.next})},e.prototype.updateSpan=function(l,c){0!==l.length&&this.wrapOperation_(l,function(e,t){d(null!==t);var n=new p(0,h),i=n,r=e,s=l.pos-r;for(d(s<t.length),0<s&&(i.next=new p(s,t.annotation),r+=(i=i.next).length);null!==t&&l.end()>=e+t.length;){var o=e+t.length-r;i.next=new p(o,c(t.annotation,o)),i=i.next,e+=t.length,t=t.next,r=e}var a=l.end()-r;return 0<a&&(d(a<t.length),i.next=new p(a,c(t.annotation,a)),r+=(i=i.next).length,i.next=new p(e+t.length-r,t.annotation)),n.next})},e.prototype.wrapOperation_=function(e,t){if(e.pos<0)throw new Error("Span start cannot be negative.");var n,i=[],r=[],s=this.getAffectedNodes_(e);null!==s.start?(n=s.end.next,s.end.next=null):n=s.succ;var o=t(s.startPos,s.start),a=!1,l=!1;if(o){var c;for(this.mergeNodesWithSameAnnotations_(o),c=s.pred&&s.pred.annotation.equals(o.annotation)?(a=!0,o.length+=s.pred.length,s.beforePred.next=o,s.predPos):(s.beforeStart.next=o,s.startPos);o.next;)r.push(new f(c,o)),c+=o.length,o=o.next;s.succ&&s.succ.annotation.equals(o.annotation)?(o.length+=s.succ.length,l=!0,o.next=s.succ.next):o.next=n,r.push(new f(c,o))}else s.pred&&s.succ&&s.pred.annotation.equals(s.succ.annotation)?(l=a=!0,o=new p(s.pred.length+s.succ.length,s.pred.annotation),(s.beforePred.next=o).next=s.succ.next,r.push(new f(s.startPos-s.pred.length,o))):s.beforeStart.next=n;a&&i.push(new u(s.predPos,s.pred));for(var d=s.startPos,h=s.start;null!==h;)i.push(new u(d,h)),d+=h.length,h=h.next;l&&i.push(new u(d,s.succ)),this.changeHandler_(i,r)},e.prototype.getAffectedNodes_=function(e){for(var t={},n=null,i=this.head_,r=i.next,s=0;null!==r&&e.pos>=s+r.length;)s+=r.length,n=i,r=(i=r).next;if(null===r&&(0!==e.length||e.pos!==s))throw new Error("Span start exceeds the bounds of the AnnotationList.");for(t.startPos=s,0===e.length&&e.pos===s?t.start=null:t.start=r,t.beforeStart=i,s===e.pos&&0<s?(t.pred=i,t.predPos=s-i.length,t.beforePred=n):t.pred=null;null!==r&&e.end()>s;)s+=r.length,r=(i=r).next;if(e.end()>s)throw new Error("Span end exceeds the bounds of the AnnotationList.");return 0===e.length&&e.end()===s?t.end=null:t.end=i,t.succ=s===e.end()?r:null,t},e.prototype.mergeNodesWithSameAnnotations_=function(e){if(e)for(var t=null,n=e;n;)t&&t.annotation.equals(n.annotation)?(t.length+=n.length,t.next=n.next):t=n,n=n.next},e.prototype.forEach=function(e){for(var t=this.head_.next;null!==t;)e(t.length,t.annotation,t.attachedObject),t=t.next},e.prototype.getAnnotatedSpansForPos=function(e){for(var t=0,n=this.head_.next,i=null;null!==n&&t+n.length<=e;)t+=n.length,n=(i=n).next;if(null===n&&t!==e)throw new Error("pos exceeds the bounds of the AnnotationList");var r=[];return t===e&&i&&r.push(new u(t-i.length,i)),n&&r.push(new u(t,n)),r},e.prototype.getAnnotatedSpansForSpan=function(e){if(0===e.length)return[];for(var t=[],n=this.getAffectedNodes_(e),i=n.startPos,r=n.start;null!==r&&i<e.end();){var s=Math.max(i,e.pos),o=Math.min(i+r.length,e.end()),a=new l(s,o-s);a.annotation=r.annotation,t.push(a),i+=r.length,r=r.next}return t},e.prototype.count=function(){for(var e=0,t=this.head_.next,n=null;null!==t;)n&&d(!n.annotation.equals(t.annotation)),t=(n=t).next,e++;return e},p.prototype.clone=function(){var e=new p(this.spanLength,this.annotation);return e.next=this.next,e},e}(),(M=M||{}).Cursor=function(){"use strict";function n(e,t){this.position=e,this.selectionEnd=t}return n.fromJSON=function(e){return new n(e.position,e.selectionEnd)},n.prototype.equals=function(e){return this.position===e.position&&this.selectionEnd===e.selectionEnd},n.prototype.compose=function(e){return e},n.prototype.transform=function(s){function e(e){for(var t=e,n=s.ops,i=0,r=s.ops.length;i<r&&(n[i].isRetain()?e-=n[i].chars:n[i].isInsert()?t+=n[i].text.length:(t-=Math.min(e,n[i].chars),e-=n[i].chars),!(e<0));i++);return t}var t=e(this.position);return this.position===this.selectionEnd?new n(t,t):new n(t,e(this.selectionEnd))},n}(),(M=M||{}).FirebaseAdapter=function(){"undefined"==typeof firebase&&"function"==typeof require&&"function"!=typeof Firebase&&(firebase=require("firebase"));var s=M.TextOperation,l=M.utils;function e(e,t,n){this.ref_=e,this.ready_=!1,this.firebaseCallbacks_=[],this.zombie_=!1,this.document_=new s,this.revision_=0,this.pendingReceivedRevisions_={};var i=this;if(t){this.setUserId(t),this.setColor(n);var r=e.root.child(".info/connected");this.firebaseOn_(r,"value",function(e){!0===e.val()&&i.initializeUserData_()},this),this.on("ready",function(){i.monitorCursors_()})}else this.userId_=e.push().key;setTimeout(function(){i.monitorHistory_()},0)}function c(e,t){if(!e)throw new Error(t||"assertion error")}l.makeEventEmitter(e,["ready","cursor","operation","ack","retry"]),e.prototype.dispose=function(){var e=this;this.ready_?(this.removeFirebaseCallbacks_(),this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("color").remove()),this.ref_=null,this.document_=null,this.zombie_=!0):this.on("ready",function(){e.dispose()})},e.prototype.setUserId=function(e){this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("cursor").onDisconnect().cancel(),this.userRef_.child("color").remove(),this.userRef_.child("color").onDisconnect().cancel()),this.userId_=e,this.userRef_=this.ref_.child("users").child(e),this.initializeUserData_()},e.prototype.isHistoryEmpty=function(){return c(this.ready_,"Not ready yet."),0===this.revision_},e.prototype.sendOperation=function(e,o){var a=this;if(this.ready_){c(this.document_.targetLength===e.baseLength,"sendOperation() called with invalid operation.");var t=r(this.revision_);this.sent_={id:t,op:e},function i(r,s){a.ref_.child("history").child(r).transaction(function(e){if(null===e)return s},function(e,t,n){if(e){if("disconnect"!==e.message)throw l.log("Transaction failure!",e),e;a.sent_&&a.sent_.id===r?setTimeout(function(){i(r,s)},0):o&&o(e,!1)}else o&&o(null,t)},!1)}(t,{a:a.userId_,o:e.toJSON(),t:firebase.database.ServerValue.TIMESTAMP})}else this.on("ready",function(){a.trigger("retry")})},e.prototype.sendCursor=function(e){this.userRef_.child("cursor").set(e),this.cursor_=e},e.prototype.setColor=function(e){this.userRef_.child("color").set(e),this.color_=e},e.prototype.getDocument=function(){return this.document_},e.prototype.registerCallbacks=function(e){for(var t in e)this.on(t,e[t])},e.prototype.initializeUserData_=function(){this.userRef_.child("cursor").onDisconnect().remove(),this.userRef_.child("color").onDisconnect().remove(),this.sendCursor(this.cursor_||null),this.setColor(this.color_||null)},e.prototype.monitorCursors_=function(){var e=this.ref_.child("users"),i=this;function t(e){var t=e.key,n=e.val();i.trigger("cursor",t,n.cursor,n.color)}this.firebaseOn_(e,"child_added",t),this.firebaseOn_(e,"child_changed",t),this.firebaseOn_(e,"child_removed",function(e){var t=e.key;i.trigger("cursor",t,null)})},e.prototype.monitorHistory_=function(){var r=this;this.ref_.child("checkpoint").once("value",function(e){if(!r.zombie_){var t=e.child("id").val(),n=e.child("o").val(),i=e.child("a").val();null!=n&&null!=t&&null!==i?(r.pendingReceivedRevisions_[t]={o:n,a:i},r.checkpointRevision_=function(e){c(0<e.length&&e[0]===o[e.length+8]);for(var t=0,n=1;n<e.length;n++)t*=o.length,t+=o.indexOf(e[n]);return t}(t),r.monitorHistoryStartingAt_(r.checkpointRevision_+1)):(r.checkpointRevision_=0,r.monitorHistoryStartingAt_(r.checkpointRevision_))}})},e.prototype.monitorHistoryStartingAt_=function(e){var t=this.ref_.child("history").startAt(null,r(e)),n=this;setTimeout(function(){n.firebaseOn_(t,"child_added",function(e){var t=e.key;n.pendingReceivedRevisions_[t]=e.val(),n.ready_&&n.handlePendingReceivedRevisions_()}),t.once("value",function(){n.handleInitialRevisions_()})},0)},e.prototype.handleInitialRevisions_=function(){c(!this.ready_,"Should not be called multiple times."),this.revision_=this.checkpointRevision_;for(var e=r(this.revision_),t=this.pendingReceivedRevisions_;null!=t[e];){var n=this.parseRevision_(t[e]);n?this.document_=this.document_.compose(n.operation):l.log("Invalid operation.",this.ref_.toString(),e,t[e]),delete t[e],this.revision_++,e=r(this.revision_)}this.trigger("operation",this.document_),this.ready_=!0;var i=this;setTimeout(function(){i.trigger("ready")},0)},e.prototype.handlePendingReceivedRevisions_=function(){for(var e=this.pendingReceivedRevisions_,t=r(this.revision_),n=!1;null!=e[t];){this.revision_++;var i=this.parseRevision_(e[t]);i?(this.document_=this.document_.compose(i.operation),this.sent_&&t===this.sent_.id?this.sent_.op.equals(i.operation)&&i.author===this.userId_?(this.revision_%100==0&&this.saveCheckpoint_(),this.sent_=null,this.trigger("ack")):(n=!0,this.trigger("operation",i.operation)):this.trigger("operation",i.operation)):l.log("Invalid operation.",this.ref_.toString(),t,e[t]),delete e[t],t=r(this.revision_)}n&&(this.sent_=null,this.trigger("retry"))},e.prototype.parseRevision_=function(e){if("object"!=typeof e)return null;if("string"!=typeof e.a||"object"!=typeof e.o)return null;var t=null;try{t=s.fromJSON(e.o)}catch(e){return null}return t.baseLength!==this.document_.targetLength?null:{author:e.a,operation:t}},e.prototype.saveCheckpoint_=function(){this.ref_.child("checkpoint").set({a:this.userId_,o:this.document_.toJSON(),id:r(this.revision_-1)})},e.prototype.firebaseOn_=function(e,t,n,i){return this.firebaseCallbacks_.push({ref:e,eventType:t,callback:n,context:i}),e.on(t,n,i),n},e.prototype.firebaseOff_=function(e,t,n,i){e.off(t,n,i);for(var r=0;r<this.firebaseCallbacks_.length;r++){var s=this.firebaseCallbacks_[r];if(s.ref===e&&s.eventType===t&&s.callback===n&&s.context===i){this.firebaseCallbacks_.splice(r,1);break}}},e.prototype.removeFirebaseCallbacks_=function(){for(var e=0;e<this.firebaseCallbacks_.length;e++){var t=this.firebaseCallbacks_[e];t.ref.off(t.eventType,t.callback,t.context)}this.firebaseCallbacks_=[]};var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function r(e){if(0===e)return"A0";for(var t="";0<e;){var n=e%o.length;t=o[n]+t,e-=n,e/=o.length}return o[t.length+9]+t}return e}(),(M=M||{}).RichTextToolbar=((u=M.utils).makeEventEmitter(i,["bold","italic","underline","strike","font","font-size","color","left","center","right","unordered-list","ordered-list","todo-list","indent-increase","indent-decrease","undo","redo","insert-image"]),i.prototype.element=function(){return this.element_},i.prototype.makeButton_=function(e,t){var n=this;t=t||e;var i=u.elt("a",[u.elt("span","",{class:"firepad-tb-"+t})],{class:"firepad-btn"});return u.on(i,"click",u.stopEventAnd(function(){n.trigger(e)})),i},i.prototype.makeElement_=function(){var e=this,t=this.makeFontDropdown_(),n=this.makeFontSizeDropdown_(),i=this.makeColorDropdown_(),r=[u.elt("div",[t],{class:"firepad-btn-group"}),u.elt("div",[n],{class:"firepad-btn-group"}),u.elt("div",[i],{class:"firepad-btn-group"}),u.elt("div",[e.makeButton_("bold"),e.makeButton_("italic"),e.makeButton_("underline"),e.makeButton_("strike","strikethrough")],{class:"firepad-btn-group"}),u.elt("div",[e.makeButton_("unordered-list","list-2"),e.makeButton_("ordered-list","numbered-list"),e.makeButton_("todo-list","list")],{class:"firepad-btn-group"}),u.elt("div",[e.makeButton_("indent-decrease"),e.makeButton_("indent-increase")],{class:"firepad-btn-group"}),u.elt("div",[e.makeButton_("left","paragraph-left"),e.makeButton_("center","paragraph-center"),e.makeButton_("right","paragraph-right")],{class:"firepad-btn-group"}),u.elt("div",[e.makeButton_("undo"),e.makeButton_("redo")],{class:"firepad-btn-group"})];e.imageInsertionUI&&r.push(u.elt("div",[e.makeButton_("insert-image")],{class:"firepad-btn-group"}));var s=u.elt("div",r,{class:"firepad-toolbar-wrapper"}),o=u.elt("div",null,{class:"firepad-toolbar"});return o.appendChild(s),o},i.prototype.makeFontDropdown_=function(){for(var e=["Arial","Comic Sans MS","Courier New","Impact","Times New Roman","Verdana"],t=[],n=0;n<e.length;n++){var i=u.elt("span",e[n]);i.setAttribute("style","font-family:"+e[n]),t.push({content:i,value:e[n]})}return this.makeDropdown_("Font","font",t)},i.prototype.makeFontSizeDropdown_=function(){for(var e=[9,10,12,14,18,24,32,42],t=[],n=0;n<e.length;n++){var i=u.elt("span",e[n].toString());i.setAttribute("style","font-size:"+e[n]+"px; line-height:"+(e[n]-6)+"px;"),t.push({content:i,value:e[n]})}return this.makeDropdown_("Size","font-size",t,"px")},i.prototype.makeColorDropdown_=function(){for(var e=["black","red","green","blue","yellow","cyan","magenta","grey"],t=[],n=0;n<e.length;n++){var i=u.elt("div");i.className="firepad-color-dropdown-item",i.setAttribute("style","background-color:"+e[n]),t.push({content:i,value:e[n]})}return this.makeDropdown_("Color","color",t)},i.prototype.makeDropdown_=function(e,i,t,r){r=r||"";var s=this,n=u.elt("a",e+" â–¾",{class:"firepad-btn firepad-dropdown"}),o=u.elt("ul",[],{class:"firepad-dropdown-menu"});n.appendChild(o);var a=!1,l=!1;function c(){a&&(o.style.display="",u.off(document,"click",c,!0),a=!1),l=!0,setTimeout(function(){l=!1},0)}function d(e,t){"object"!=typeof e&&(e=document.createTextNode(String(e)));var n=u.elt("a",[e]);u.on(n,"click",u.stopEventAnd(function(){c(),s.trigger(i,t+r)})),o.appendChild(n)}for(var h=0;h<t.length;h++)d(t[h].content,t[h].value);return u.on(n,"click",u.stopEventAnd(function(){l||a||(o.style.display="block",u.on(document,"click",c,!0),a=!0)})),n},i),(M=M||{}).WrappedOperation=function(){"use strict";function i(e,t){this.wrapped=e,this.meta=t}function r(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function s(e,t){return e&&"object"==typeof e&&"function"==typeof e.transform?e.transform(t):e}return i.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)},i.prototype.invert=function(){var e=this.meta;return new i(this.wrapped.invert.apply(this.wrapped,arguments),e&&"object"==typeof e&&"function"==typeof e.invert?e.invert.apply(e,arguments):e)},i.prototype.compose=function(e){return new i(this.wrapped.compose(e.wrapped),function(e,t){if(e&&"object"==typeof e){if("function"==typeof e.compose)return e.compose(t);var n={};return r(e,n),r(t,n),n}return t}(this.meta,e.meta))},i.transform=function(e,t){var n=e.wrapped.transform(t.wrapped);return[new i(n[0],s(e.meta,t.wrapped)),new i(n[1],s(t.meta,e.wrapped))]},i.prototype.transform=function(e){return i.transform(this,e)},i}(),(M=M||{}).UndoManager=function(){"use strict";var t="normal",i="undoing",r="redoing";function e(e){this.maxItems=e||50,this.state=t,this.dontCompose=!1,this.undoStack=[],this.redoStack=[]}function n(e,t){for(var n=[],i=t.constructor,r=e.length-1;0<=r;r--){var s=i.transform(e[r],t);"function"==typeof s[0].isNoop&&s[0].isNoop()||n.push(s[0]),t=s[1]}return n.reverse()}return e.prototype.add=function(e,t){if(this.state===i)this.redoStack.push(e),this.dontCompose=!0;else if(this.state===r)this.undoStack.push(e),this.dontCompose=!0;else{var n=this.undoStack;!this.dontCompose&&t&&0<n.length?n.push(e.compose(n.pop())):(n.push(e),n.length>this.maxItems&&n.shift()),this.dontCompose=!1,this.redoStack=[]}},e.prototype.transform=function(e){this.undoStack=n(this.undoStack,e),this.redoStack=n(this.redoStack,e)},e.prototype.performUndo=function(e){if(this.state=i,0===this.undoStack.length)throw new Error("undo not possible");e(this.undoStack.pop()),this.state=t},e.prototype.performRedo=function(e){if(this.state=r,0===this.redoStack.length)throw new Error("redo not possible");e(this.redoStack.pop()),this.state=t},e.prototype.canUndo=function(){return 0!==this.undoStack.length},e.prototype.canRedo=function(){return 0!==this.redoStack.length},e.prototype.isUndoing=function(){return this.state===i},e.prototype.isRedoing=function(){return this.state===r},e}(),(M=M||{}).Client=function(){"use strict";function e(){this.state=n}function t(){}e.prototype.setState=function(e){this.state=e},e.prototype.applyClient=function(e){this.setState(this.state.applyClient(this,e))},e.prototype.applyServer=function(e){this.setState(this.state.applyServer(this,e))},e.prototype.serverAck=function(){this.setState(this.state.serverAck(this))},e.prototype.serverRetry=function(){this.setState(this.state.serverRetry(this))},e.prototype.sendOperation=function(e){throw new Error("sendOperation must be defined in child class")},e.prototype.applyOperation=function(e){throw new Error("applyOperation must be defined in child class")},(e.Synchronized=t).prototype.applyClient=function(e,t){return e.sendOperation(t),new i(t)},t.prototype.applyServer=function(e,t){return e.applyOperation(t),this},t.prototype.serverAck=function(e){throw new Error("There is no pending operation.")},t.prototype.serverRetry=function(e){throw new Error("There is no pending operation.")};var n=new t;function i(e){this.outstanding=e}function r(e,t){this.outstanding=e,this.buffer=t}return(e.AwaitingConfirm=i).prototype.applyClient=function(e,t){return new r(this.outstanding,t)},i.prototype.applyServer=function(e,t){var n=this.outstanding.transform(t);return e.applyOperation(n[1]),new i(n[0])},i.prototype.serverAck=function(e){return n},i.prototype.serverRetry=function(e){return e.sendOperation(this.outstanding),this},(e.AwaitingWithBuffer=r).prototype.applyClient=function(e,t){var n=this.buffer.compose(t);return new r(this.outstanding,n)},r.prototype.applyServer=function(e,t){var n=this.outstanding.transform(t),i=this.buffer.transform(n[1]);return e.applyOperation(i[1]),new r(n[0],i[0])},r.prototype.serverRetry=function(e){var t=this.outstanding.compose(this.buffer);return e.sendOperation(t),new i(t)},r.prototype.serverAck=function(e){return e.sendOperation(this.buffer),new i(this.buffer)},e}(),(M=M||{}).EditorClient=function(){"use strict";var e,s=M.Client,o=M.Cursor,n=M.UndoManager,a=M.WrappedOperation;function l(e,t){this.cursorBefore=e,this.cursorAfter=t}function i(e,t){this.id=e,this.editorAdapter=t}function t(e,t){s.call(this),this.serverAdapter=e,this.editorAdapter=t,this.undoManager=new n,this.clients={};var r=this;this.editorAdapter.registerCallbacks({change:function(e,t){r.onChange(e,t)},cursorActivity:function(){r.onCursorActivity()},blur:function(){r.onBlur()},focus:function(){r.onFocus()}}),this.editorAdapter.registerUndo(function(){r.undo()}),this.editorAdapter.registerRedo(function(){r.redo()}),this.serverAdapter.registerCallbacks({ack:function(){r.serverAck(),r.focused&&r.state instanceof s.Synchronized&&(r.updateCursor(),r.sendCursor(r.cursor)),r.emitStatus()},retry:function(){r.serverRetry()},operation:function(e){r.applyServer(e)},cursor:function(e,t,n){if(r.serverAdapter.userId_!==e&&r.state instanceof s.Synchronized){var i=r.getClientObject(e);t?(n&&i.setColor(n),i.updateCursor(o.fromJSON(t))):i.removeCursor()}}})}function r(){}return l.prototype.invert=function(){return new l(this.cursorAfter,this.cursorBefore)},l.prototype.compose=function(e){return new l(this.cursorBefore,e.cursorAfter)},l.prototype.transform=function(e){return new l(this.cursorBefore?this.cursorBefore.transform(e):null,this.cursorAfter?this.cursorAfter.transform(e):null)},i.prototype.setColor=function(e){this.color=e},i.prototype.updateCursor=function(e){this.removeCursor(),this.cursor=e,this.mark=this.editorAdapter.setOtherCursor(e,this.color,this.id)},i.prototype.removeCursor=function(){this.mark&&this.mark.clear()},e=t,r.prototype=s.prototype,e.prototype=new r,e.prototype.constructor=e,t.prototype.getClientObject=function(e){var t=this.clients[e];return t||(this.clients[e]=new i(e,this.editorAdapter))},t.prototype.applyUnredo=function(e){this.undoManager.add(this.editorAdapter.invertOperation(e)),this.editorAdapter.applyOperation(e.wrapped),this.cursor=e.meta.cursorAfter,this.cursor&&this.editorAdapter.setCursor(this.cursor),this.applyClient(e.wrapped)},t.prototype.undo=function(){var t=this;this.undoManager.canUndo()&&this.undoManager.performUndo(function(e){t.applyUnredo(e)})},t.prototype.redo=function(){var t=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(e){t.applyUnredo(e)})},t.prototype.onChange=function(e,t){var n=this.cursor;this.updateCursor();var i,r=0<this.undoManager.undoStack.length&&t.shouldBeComposedWithInverted((i=this.undoManager.undoStack)[i.length-1].wrapped),s=new l(this.cursor,n);this.undoManager.add(new a(t,s),r),this.applyClient(e)},t.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()},t.prototype.onCursorActivity=function(){var e=this.cursor;this.updateCursor(),!this.focused||e&&this.cursor.equals(e)||this.sendCursor(this.cursor)},t.prototype.onBlur=function(){this.cursor=null,this.sendCursor(null),this.focused=!1},t.prototype.onFocus=function(){this.focused=!0,this.onCursorActivity()},t.prototype.sendCursor=function(e){this.state instanceof s.AwaitingWithBuffer||this.serverAdapter.sendCursor(e)},t.prototype.sendOperation=function(e){this.serverAdapter.sendOperation(e),this.emitStatus()},t.prototype.applyOperation=function(e){this.editorAdapter.applyOperation(e),this.updateCursor(),this.undoManager.transform(new a(e,null))},t.prototype.emitStatus=function(){var e=this;setTimeout(function(){e.trigger("synced",e.state instanceof s.Synchronized)},0)},t}(),M.utils.makeEventEmitter(M.EditorClient,["synced"]);function s(e,t){return function(){return e.apply(t,arguments)}}var o,r,a,l,c,I,N,O,d,h,f,p,M,g=[].slice;function _(e){var t;this.onCursorActivity=s(this.onCursorActivity,this),this.onFocus=s(this.onFocus,this),this.onBlur=s(this.onBlur,this),this.onChange=s(this.onChange,this),this.ace=e,this.aceSession=this.ace.getSession(),this.aceDoc=this.aceSession.getDocument(),this.aceDoc.setNewLineMode("unix"),this.grabDocumentState(),this.ace.on("change",this.onChange),this.ace.on("blur",this.onBlur),this.ace.on("focus",this.onFocus),this.aceSession.selection.on("changeCursor",this.onCursorActivity),null==this.aceRange&&(this.aceRange=(null!=(t=ace.require)?t:require)("ace/range").Range)}function m(e){this.onCursorActivity=s(this.onCursorActivity,this),this.onFocus=s(this.onFocus,this),this.onBlur=s(this.onBlur,this),this.onChange=s(this.onChange,this),this.monaco=e,this.monacoModel=this.monaco.getModel(),this.grabDocumentState();var t=this.monaco.onDidChangeModelContent(this.onChange),n=this.monaco.onDidBlurEditor(this.onBlur),i=this.monaco.onDidFocusEditor(this.onFocus),r=this.monaco.onDidChangeCursorPosition(this.onCursorActivity);this.detach=function(){t.dispose(),n.dispose(),i.dispose(),r.dispose()}}function v(){this.entities_={};var r=["src","alt","width","height","style","class"];this.register("img",{render:function(e){o.assert(e.src,"image entity should have 'src'!");for(var t=["src","alt","width","height","style","class"],n="<img ",i=0;i<t.length;i++){var r=t[i];r in e&&(n+=" "+r+'="'+e[r]+'"')}return n+=">"},fromElement:function(e){for(var t={},n=0;n<r.length;n++){var i=r[n];e.hasAttribute(i)&&(t[i]=e.getAttribute(i))}return t}})}function y(e,t){if(!(this instanceof y))return new y(e,t);this.type=e,this.info=t||{}}function b(e){if(!(this instanceof b))return new b(e);this.attributes=e||{}}function x(e){if(!(this instanceof x))return new x(e);this.attributes=e||{},this.attributes[c.LINE_SENTINEL]=!0}function F(e){return e===O.ORDERED?"</ol>":"</ul>"}function w(e){if(!(this instanceof w))return new w(e);var t,n;n="string"==typeof e?(t=void 0===window.firebase&&"object"!=typeof t?require("firebase"):window.firebase).database().refFromURL(e):e,this.entityManager_=new f,this.firebaseAdapter_=new h(n),this.ready_=!1,this.zombie_=!1}return null==M&&(M={}),M.ACEAdapter=(_.prototype.ignoreChanges=!1,_.prototype.grabDocumentState=function(){return this.lastDocLines=this.aceDoc.getAllLines(),this.lastCursorRange=this.aceSession.selection.getRange()},_.prototype.detach=function(){return this.ace.removeListener("change",this.onChange),this.ace.removeListener("blur",this.onBlur),this.ace.removeListener("focus",this.onFocus),this.aceSession.selection.removeListener("changeCursor",this.onCursorActivity)},_.prototype.onChange=function(e){var t;if(!this.ignoreChanges)return t=this.operationFromACEChange(e),this.trigger.apply(this,["change"].concat(g.call(t))),this.grabDocumentState()},_.prototype.onBlur=function(){if(this.ace.selection.isEmpty())return this.trigger("blur")},_.prototype.onFocus=function(){return this.trigger("focus")},_.prototype.onCursorActivity=function(){var e=this;return setTimeout(function(){return e.trigger("cursorActivity")},0)},_.prototype.operationFromACEChange=function(e){var t,n,i,r,s,o,a;return s=e.data?("insertLines"===(a=(n=e.data).action)||"removeLines"===a?(o=n.lines.join("\n")+"\n",n.action.replace("Lines","")):(o=n.text.replace(this.aceDoc.getNewLineCharacter(),"\n"),n.action.replace("Text","")),this.indexFromPos(n.range.start)):(o=e.lines.join("\n"),this.indexFromPos(e.start)),r=this.lastDocLines.join("\n").length-s,"remove"===e.action&&(r-=o.length),i=(new M.TextOperation).retain(s).insert(o).retain(r),t=(new M.TextOperation).retain(s).delete(o).retain(r),"remove"===e.action?[t,i]:[i,t]},_.prototype.applyOperationToACE=function(e){var t,n,i,r,s,o,a,l;for(o=n=0,a=(l=e.ops).length;o<a;o++)(i=l[o]).isRetain()?n+=i.chars:i.isInsert()?(this.aceDoc.insert(this.posFromIndex(n),i.text),n+=i.text.length):i.isDelete()&&(t=this.posFromIndex(n),s=this.posFromIndex(n+i.chars),r=this.aceRange.fromPoints(t,s),this.aceDoc.remove(r));return this.grabDocumentState()},_.prototype.posFromIndex=function(e){var t,n,i,r,s;for(n=i=0,r=(s=this.aceDoc.$lines).length;i<r&&!(e<=(t=s[n]).length);n=++i)e-=t.length+1;return{row:n,column:e}},_.prototype.indexFromPos=function(e,t){var n,i,r,s;for(null==t&&(t=this.lastDocLines),n=r=i=0,s=e.row;0<=s?r<s:s<r;n=0<=s?++r:--r)i+=this.lastDocLines[n].length+1;return i+e.column},_.prototype.getValue=function(){return this.aceDoc.getValue()},_.prototype.getCursor=function(){var t,n,i,e;try{n=this.indexFromPos(this.aceSession.selection.getRange().start,this.aceDoc.$lines),t=this.indexFromPos(this.aceSession.selection.getRange().end,this.aceDoc.$lines)}catch(e){try{n=this.indexFromPos(this.lastCursorRange.start),t=this.indexFromPos(this.lastCursorRange.end)}catch(e){n=(i=[0,0])[0],t=i[1]}}return t<n&&(n=(e=[t,n])[0],t=e[1]),new M.Cursor(n,t)},_.prototype.setCursor=function(e){var t,n,i;return n=this.posFromIndex(e.position),t=this.posFromIndex(e.selectionEnd),e.position>e.selectionEnd&&(n=(i=[t,n])[0],t=i[1]),this.aceSession.selection.setSelectionRange(new this.aceRange(n.row,n.column,t.row,t.column))},_.prototype.setOtherCursor=function(e,t,n){var i,r,s,o,a,l,c,d,h=this;return null==this.otherCursors&&(this.otherCursors={}),(s=this.otherCursors[n])&&(s.start.detach(),s.end.detach(),this.aceSession.removeMarker(s.id)),c=this.posFromIndex(e.position),o=this.posFromIndex(e.selectionEnd),e.selectionEnd<e.position&&(c=(d=[o,c])[0],o=d[1]),i="other-client-selection-"+t.replace("#",""),(a=e.position===e.selectionEnd)&&(i=i.replace("selection","cursor")),r="."+i+" {\n  position: absolute;\n  background-color: "+(a?"transparent":t)+";\n  border-left: 2px solid "+t+";\n}",this.addStyleRule(r),this.otherCursors[n]=s=new this.aceRange(c.row,c.column,o.row,o.column),l=this,s.clipRows=function(){var e;return(e=l.aceRange.prototype.clipRows.apply(this,arguments)).isEmpty=function(){return!1},e},s.start=this.aceDoc.createAnchor(s.start),s.end=this.aceDoc.createAnchor(s.end),s.id=this.aceSession.addMarker(s,i,"text"),{clear:function(){return s.start.detach(),s.end.detach(),h.aceSession.removeMarker(s.id)}}},_.prototype.addStyleRule=function(e){var t;if("undefined"!=typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},t=document.createElement("style"),document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet),!this.addedStyleRules[e]))return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)},_.prototype.registerCallbacks=function(e){this.callbacks=e},_.prototype.trigger=function(){var e,t,n,i;return t=arguments[0],e=2<=arguments.length?g.call(arguments,1):[],null!=(n=this.callbacks)&&null!=(i=n[t])?i.apply(this,e):void 0},_.prototype.applyOperation=function(e){return e.isNoop()||(this.ignoreChanges=!0),this.applyOperationToACE(e),this.ignoreChanges=!1},_.prototype.registerUndo=function(e){return this.ace.undo=e},_.prototype.registerRedo=function(e){return this.ace.redo=e},_.prototype.invertOperation=function(e){return e.invert(this.getValue())},_),M.MonacoAdapter=(m.prototype.ignoreChanges=!1,m.prototype.grabDocumentState=function(){this.lastDocLines=this.monacoModel.getLinesContent();var e=this.monaco.getSelection();return this.lastCursorRange=e},m.prototype.onChange=function(e){var t;if(!this.ignoreChanges)return t=this.operationFromMonacoChange(e),this.trigger.apply(this,["change"].concat(g.call(t))),this.grabDocumentState()},m.prototype.onBlur=function(){if(this.monaco.getSelection().isEmpty())return this.trigger("blur")},m.prototype.onFocus=function(){return this.trigger("focus")},m.prototype.onCursorActivity=function(){var e=this;return setTimeout(function(){return e.trigger("cursorActivity")},0)},m.prototype.operationFromMonacoChange=function(e){return text=e.changes[0].text,start=this.indexFromPos(e.changes[0].range,"start"),restLength=this.lastDocLines.join("\n").length-start,text_ins=e.changes[0].text,rangeLen=e.changes[0].rangeLength,0<e.changes[0].rangeLength&&(restLength-=rangeLen,text=this.lastDocLines.join("\n").slice(start,start+rangeLen)),insert_op=(new M.TextOperation).retain(start).insert(text).retain(restLength),delete_op=(new M.TextOperation).retain(start).delete(text).retain(restLength),ins_op_ne=(new M.TextOperation).retain(start).delete(text_ins).insert(text).retain(restLength),del_op_ne=(new M.TextOperation).retain(start).delete(text).insert(text_ins).retain(restLength),""===e.changes[0].text&&0<rangeLen?[delete_op,insert_op]:""!==e.changes[0].text&&0<rangeLen?[del_op_ne,ins_op_ne]:[insert_op,delete_op]},m.prototype.applyOperationToMonaco=function(e){var t,n,i,r,s,o,a,l;for(s=n=0,o=(a=e.ops).length;s<o;s++)(i=a[s]).isRetain()?n+=i.chars:i.isInsert()?(l={identifier:{major:1,minor:1},range:new monaco.Range(this.posFromIndex(n).row,this.posFromIndex(n).column,this.posFromIndex(n).row,this.posFromIndex(n).column),text:i.text,forceMoveMarkers:!0},this.monaco.executeEdits("my-source",[l]),n+=i.text.length):i.isDelete()&&(content=this.monacoModel.getLinesContent(),t=this.posFromIndex(n,content),r=this.posFromIndex(n+i.chars,content),l={identifier:{major:1,minor:2},range:new monaco.Range(t.row,t.column,r.row,r.column),text:"",forceMoveMarkers:!0},this.monaco.executeEdits("my-source",[l]));return this.grabDocumentState()},m.prototype.posFromIndex=function(e,t){var n,i,r,s,o;for(i=r=0,s=(o=null==t?this.lastDocLines:t).length;r<s&&!(e<=(n=o[i]).length);i=++r)e-=n.length+1;return{row:i+1,column:e+1}},m.prototype.indexFromPos=function(e,t,n){var i;if(null==n&&(n=this.lastDocLines),i=0,"start"===t){for(row=1;row<e.startLineNumber;row++)i+=n[row-1].length+1;return i+e.startColumn-1}for(row=1;row<e.endLineNumber;row++)i+=n[row-1].length+1;return i+e.endColumn-1},m.prototype.getValue=function(){return this.monacoModel.getValue()},m.prototype.getCursor=function(){var t,n,i,e;try{selection=this.monaco.getSelection(),n=this.indexFromPos(selection,"start",this.lastDocLines),t=this.indexFromPos(selection,"end",this.lastDocLines)}catch(e){try{n=this.indexFromPos(this.lastCursorRange,"start"),t=this.indexFromPos(this.lastCursorRange,"end")}catch(e){n=(i=[0,0])[0],t=i[1]}}return t<n&&(n=(e=[t,n])[0],t=e[1]),new M.Cursor(n,t)},m.prototype.setCursor=function(e){var t,n,i;return n=this.posFromIndex(e.position),t=this.posFromIndex(e.selectionEnd),e.position>e.selectionEnd&&(n=(i=[t,n])[0],t=i[1]),this.monaco.setSelection(new monaco.Range(n.row,n.column,t.row,t.column))},m.prototype.setOtherCursor=function(e,t,n){if(null==this.otherCursors&&(this.otherCursors={},this.otherCursors[n]=[]),this.otherCursors[n]&&(this.otherCursors[n]=this.monaco.deltaDecorations(this.otherCursors[n],[])),start=this.posFromIndex(e.position),end=this.posFromIndex(e.selectionEnd),clazz="other-client-selection-"+t.replace("#",""),!(start<0||end<0||start>end))return justCursor=e.position===e.selectionEnd,justCursor&&(clazz=clazz.replace("selection","cursor")),css="."+clazz+" {\n  position: relative;\nbackground-color: "+(justCursor?"transparent":t)+";\nborder-left: 2px solid "+t+";\n}",this.addStyleRule(css),this.otherCursors[n]=this.monaco.deltaDecorations(this.otherCursors[n],[{range:new monaco.Range(start.row,start.column,end.row,end.column),options:{className:clazz}}]),_this=this,{clear:function(){return _this.monaco.deltaDecorations(_this.otherCursors[n],[])}}},m.prototype.addStyleRule=function(e){var t;if("undefined"!=typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},t=document.createElement("style"),document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet),!this.addedStyleRules[e]))return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)},m.prototype.registerCallbacks=function(e){this.callbacks=e},m.prototype.trigger=function(e){var t=Array.prototype.slice.call(arguments,1),n=this.callbacks&&this.callbacks[e];n&&n.apply(this,t)},m.prototype.applyOperation=function(e){return e.isNoop()||(this.ignoreChanges=!0),this.applyOperationToMonaco(e),this.ignoreChanges=!1},m.prototype.registerUndo=function(e){return this.monacoModel.undo=e},m.prototype.registerRedo=function(e){return this.monacoModel.redo=e},m.prototype.invertOperation=function(e){return e.invert(this.getValue())},m),(M=M||{}).AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"},M.sentinelConstants={LINE_SENTINEL_CHARACTER:"î€€",ENTITY_SENTINEL_CHARACTER:"î€"},(M=M||{}).EntityManager=(o=M.utils,v.prototype.register=function(e,t){M.utils.assert(t.render,"Entity options should include a 'render' function!"),M.utils.assert(t.fromElement,"Entity options should include a 'fromElement' function!"),this.entities_[e]=t},v.prototype.renderToElement=function(e,t){return this.tryRenderToElement_(e,"render",t)},v.prototype.exportToElement=function(e){var t=this.tryRenderToElement_(e,"export")||this.tryRenderToElement_(e,"getHtml")||this.tryRenderToElement_(e,"render");return t.setAttribute("data-firepad-entity",e.type),t},v.prototype.updateElement=function(e,t){var n=e.type,i=e.info;this.entities_[n]&&void 0!==this.entities_[n].update&&this.entities_[n].update(i,t)},v.prototype.fromElement=function(e){var t=e.getAttribute("data-firepad-entity");if((t=t||e.nodeName.toLowerCase())&&this.entities_[t]){var n=this.entities_[t].fromElement(e);return new M.Entity(t,n)}},v.prototype.tryRenderToElement_=function(e,t,n){var i=e.type,r=e.info;if(this.entities_[i]&&this.entities_[i][t]){var s=M.document||window&&window.document,o=this.entities_[i][t](r,n,s);if(o){if("string"==typeof o){var a=(M.document||document).createElement("div");return a.innerHTML=o,a.childNodes[0]}if("object"==typeof o)return M.utils.assert(void 0!==o.nodeType,"Error rendering "+i+" entity.  render() function must return an html string or a DOM element."),o}}},v.prototype.entitySupportsUpdate=function(e){return this.entities_[e]&&this.entities_[e].update},v),(M=M||{}).Entity=(r=M.AttributeConstants.ENTITY_SENTINEL,a=r+"_",y.prototype.toAttributes=function(){var e={};for(var t in e[r]=this.type,this.info)e[a+t]=this.info[t];return e},y.fromAttributes=function(e){var t=e[r],n={};for(var i in e)0===i.indexOf(a)&&(n[i.substr(a.length)]=e[i]);return new y(t,n)},y),(M=M||{}).RichTextCodeMirror=function(){var r=M.AnnotationList,_=M.Span,s=M.utils,f=M.AttributeConstants,c={c:"color",bc:"background-color",fs:"font-size",li:function(e){return"padding-left: "+40*e+"px"}},d={};function e(e,t,n){this.codeMirror=e,this.options_=n||{},this.entityManager_=t,this.currentAttributes_=null;var i=this;this.annotationList_=new r(function(e,t){i.onAnnotationsChanged_(e,t)}),this.initAnnotationList_(),a(this,"onCodeMirrorBeforeChange_"),a(this,"onCodeMirrorChange_"),a(this,"onCursorActivity_"),4<=parseInt(CodeMirror.version)?this.codeMirror.on("changes",this.onCodeMirrorChange_):this.codeMirror.on("change",this.onCodeMirrorChange_),this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.on("cursorActivity",this.onCursorActivity_),this.changeId_=0,this.outstandingChanges_={},this.dirtyLines_=[]}s.makeEventEmitter(e,["change","attributesChange","newLine"]);var u=M.sentinelConstants.LINE_SENTINEL_CHARACTER,o=M.sentinelConstants.ENTITY_SENTINEL_CHARACTER;function n(e,t){return e.line-t.line||e.ch-t.ch}function h(e,t){return n(e,t)<=0}function p(e){if(0===e.length)return 0;for(var t=0,n=0;n<e.length;n++)t+=e[n].length;return t+e.length-1}function m(e){this.attributes=e||{}}function a(e,t){var n=e[t];e[t]=function(){n.apply(e,arguments)}}return e.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.off("change",this.onCodeMirrorChange_),this.codeMirror.off("changes",this.onCodeMirrorChange_),this.codeMirror.off("cursorActivity",this.onCursorActivity_),this.clearAnnotations_()},e.prototype.toggleAttribute=function(e,t){var n=t||!0;if(this.emptySelection_()){var i=this.getCurrentAttributes_();i[e]===n?delete i[e]:i[e]=n,this.currentAttributes_=i}else{var r=this.getCurrentAttributes_()[e]!==n&&n;this.setAttribute(e,r)}},e.prototype.setAttribute=function(t,n){var e=this.codeMirror;if(this.emptySelection_()){var i=this.getCurrentAttributes_();!1===n?delete i[t]:i[t]=n,this.currentAttributes_=i}else this.updateTextAttributes(e.indexFromPos(e.getCursor("start")),e.indexFromPos(e.getCursor("end")),function(e){!1===n?delete e[t]:e[t]=n}),this.updateCurrentAttributes_()},e.prototype.updateTextAttributes=function(e,t,o,a,l){var c=[],d=e,h=this;this.annotationList_.updateSpan(new _(e,t-e),function(e,t){var n={};for(var i in e.attributes)n[i]=e.attributes[i];n[f.LINE_SENTINEL]&&!l||o(n);var r={},s={};return h.computeChangedAttributes_(e.attributes,n,r,s),function(e){for(var t in e)return;return 1}(r)||c.push({start:d,end:d+t,attributes:r,attributesInverse:s,origin:a}),d+=t,new m(n)}),0<c.length&&this.trigger("attributesChange",this,c)},e.prototype.computeChangedAttributes_=function(e,t,n,i){var r,s={};for(r in e)s[r]=!0;for(r in t)s[r]=!0;for(r in s)r in t?r in e?e[r]!==t[r]&&(n[r]=t[r],i[r]=e[r]):(n[r]=t[r],i[r]=!1):(n[r]=!1,i[r]=e[r])},e.prototype.toggleLineAttribute=function(e,t){var n,i=this.getCurrentLineAttributes_();n=!(e in i&&i[e]===t)&&t,this.setLineAttribute(e,n)},e.prototype.setLineAttribute=function(t,n){this.updateLineAttributesForSelection(function(e){!1===n?delete e[t]:e[t]=n})},e.prototype.updateLineAttributesForSelection=function(e){var t=this.codeMirror,n=t.getCursor("start"),i=t.getCursor("end"),r=n.line,s=i.line,o=t.getLine(s),a=this.areLineSentinelCharacters_(o.substr(0,i.ch));r<s&&a&&s--,this.updateLineAttributes(r,s,e)},e.prototype.updateLineAttributes=function(e,t,n){for(var i=e;i<=t;i++){var r=this.codeMirror.getLine(i),s=this.codeMirror.indexFromPos({line:i,ch:0});if(r[0]!==u){var o={};o[f.LINE_SENTINEL]=!0,n(o),this.insertText(s,u,o)}else this.updateTextAttributes(s,s+1,n,null,!0)}},e.prototype.replaceText=function(e,t,n,i,r){this.changeId_++;var s="cmrt-"+this.changeId_;this.outstandingChanges_[s]={origOrigin:r,attributes:i};var o=this.codeMirror,a=o.posFromIndex(e),l="number"==typeof t?o.posFromIndex(t):null;o.replaceRange(n,a,l,s)},e.prototype.insertText=function(e,t,n,i){var r=this.codeMirror,s=r.getCursor(),o="RTCMADAPTER"==i&&!r.somethingSelected()&&e==r.indexFromPos(s);this.replaceText(e,null,t,n,i),o&&r.setCursor(s)},e.prototype.removeText=function(e,t,n){var i=this.codeMirror;i.replaceRange("",i.posFromIndex(e),i.posFromIndex(t),n)},e.prototype.insertEntityAtCursor=function(e,t,n){var i=this.codeMirror,r=i.indexFromPos(i.getCursor("head"));this.insertEntityAt(r,e,t,n)},e.prototype.insertEntityAt=function(e,t,n,i){this.codeMirror;this.insertEntity_(e,new M.Entity(t,n),i)},e.prototype.insertEntity_=function(e,t,n){this.replaceText(e,null,o,t.toAttributes(),n)},e.prototype.getAttributeSpans=function(e,t){for(var n=[],i=this.annotationList_.getAnnotatedSpansForSpan(new _(e,t-e)),r=0;r<i.length;r++)n.push({length:i[r].length,attributes:i[r].annotation.attributes});return n},e.prototype.end=function(){var e=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:e,ch:this.codeMirror.getLine(e).length})},e.prototype.getRange=function(e,t){var n=this.codeMirror.posFromIndex(e),i=this.codeMirror.posFromIndex(t);return this.codeMirror.getRange(n,i)},e.prototype.initAnnotationList_=function(){var e=this.end();0!==e&&this.annotationList_.insertAnnotatedSpan(new _(0,e),new m)},e.prototype.onAnnotationsChanged_=function(e,t){var n,i={};this.tryToUpdateEntitiesInPlace(e,t);for(var r=0;r<e.length;r++){var s=e[r].annotation.attributes;f.LINE_SENTINEL in s&&(i[this.codeMirror.posFromIndex(e[r].pos).line]=!0),(n=e[r].getAttachedObject())&&n.clear()}for(r=0;r<t.length;r++){var o=t[r].annotation,a=f.LINE_SENTINEL in o.attributes,l=f.ENTITY_SENTINEL in o.attributes,c=this.codeMirror.posFromIndex(t[r].pos);if(a)i[c.line]=!0;else if(l)this.markEntity_(t[r]);else{var d=this.getClassNameForAttributes_(o.attributes);if(""!==d){var h=this.codeMirror.posFromIndex(t[r].pos+t[r].length);n=this.codeMirror.markText(c,h,{className:d}),t[r].attachObject(n)}}}for(var u in i)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(u))),this.queueLineMarking_()},e.prototype.tryToUpdateEntitiesInPlace=function(e,t){for(var n=e.length;n--;)for(var i=e[n],r=t.length;r--;){var s=t[r];if(i.pos==s.pos&&i.length==s.length&&i.annotation.attributes.ent&&i.annotation.attributes.ent==s.annotation.attributes.ent){var o=s.annotation.attributes.ent;if(this.entityManager_.entitySupportsUpdate(o)){e.splice(n,1),t.splice(r,1);var a=i.getAttachedObject();a.update(s.annotation.attributes),s.attachObject(a)}}}},e.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var s=this;this.lineMarkTimeout_=setTimeout(function(){s.lineMarkTimeout_=null;for(var e=[],t=0;t<s.dirtyLines_.length;t++){var n=s.codeMirror.getLineNumber(s.dirtyLines_[t]);e.push(Number(n))}s.dirtyLines_=[],e.sort(function(e,t){return e-t});var i=-1;for(t=0;t<e.length;t++){var r=e[t];i<r&&(i=s.markLineSentinelCharactersForChangedLines_(r,r))}},0)}},e.prototype.addStyleWithCSS_=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)},e.prototype.getClassNameForAttributes_=function(e){var t="";for(var n in e){var i=e[n];if(n===f.LINE_SENTINEL)M.utils.assert(!0===i,"LINE_SENTINEL attribute should be true if it exists.");else{var r=(this.options_.cssPrefix||"cmrt-")+n;if(!0!==i){n===f.FONT_SIZE&&"string"!=typeof i&&(i+="px");var s=i.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");if(r+="-"+s,c[n]&&(d[n]||(d[n]={}),!d[n][s])){d[n][s]=!0;var o=c[n],a="function"==typeof o?o(i):o+": "+i,l=n==f.LINE_INDENT?"pre."+r:"."+r;this.addStyleWithCSS_(l+" { "+a+" }")}}t=t+" "+r}}return t},e.prototype.markEntity_=function(e){for(var t=e.annotation.attributes,n=M.Entity.fromAttributes(t),i=this.codeMirror,r=this,s=[],o=0;o<e.length;o++){var a=i.posFromIndex(e.pos+o),l=i.posFromIndex(e.pos+o+1),c={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},d=this.createEntityHandle_(n,e.pos),h=this.entityManager_.renderToElement(n,d);h&&(c.replacedWith=h);var u=i.markText(a,l,c);s.push(u),d.setMarker(u)}e.attachObject({clear:function(){for(var e=0;e<s.length;e++)s[e].clear()},update:function(e){for(var t=M.Entity.fromAttributes(e),n=0;n<s.length;n++)r.entityManager_.updateElement(t,s[n].replacedWith)}}),this.queueRefresh_()},e.prototype.queueRefresh_=function(){var e=this;this.refreshTimer_||(this.refreshTimer_=setTimeout(function(){e.codeMirror.refresh(),e.refreshTimer_=null},0))},e.prototype.createEntityHandle_=function(o,t){var n=null,a=this;function l(){if(n){var e=n.find();return e?a.codeMirror.indexFromPos(e.from):null}return t}return{find:l,remove:function(){var e=l();null!=e&&(a.codeMirror.focus(),a.removeText(e,e+1))},replace:function(i){var r=M.AttributeConstants.ENTITY_SENTINEL,s=r+"_",e=l();a.updateTextAttributes(e,e+1,function(e){for(var t in e)delete e[t];for(var n in e[r]=o.type,i)e[s+n]=i[n]})},setMarker:function(e){n=e}}},e.prototype.lineClassRemover_=function(e){var t=this.codeMirror,n=t.getLineHandle(e);return{clear:function(){t.removeLineClass(n,"text",".*")}}},e.prototype.emptySelection_=function(){var e=this.codeMirror.getCursor("start"),t=this.codeMirror.getCursor("end");return e.line===t.line&&e.ch===t.ch},e.prototype.onCodeMirrorBeforeChange_=function(e,t){if("+input"===t.origin||"paste"===t.origin){for(var n=[],i=0;i<t.text.length;i++){var r=t.text[i];r=r.replace(new RegExp("["+u+o+"]","g"),""),n.push(r)}t.update(t.from,t.to,n)}},e.prototype.onCodeMirrorChange_=function(e,t){if("object"==typeof t.from){for(var n=[];t;)n.push(t),t=t.next;t=n}for(var i=this.convertCoordinateSystemForChanges_(t),r=[],s=0;s<i.length;s++){var o,a=i[s],l=a.start,c=(a.end,a.text),d=a.removed,h=a.origin;if(0<d.length){for(var u=this.annotationList_.getAnnotatedSpansForSpan(new _(l,d.length)),f=0,p=0;p<u.length;p++){var g=u[p];r.push({start:l,end:l+g.length,removedAttributes:g.annotation.attributes,removed:d.substr(f,g.length),attributes:{},text:"",origin:a.origin}),f+=g.length}this.annotationList_.removeSpan(new _(l,d.length))}if(0<c.length)"+input"===a.origin||"paste"===a.origin?o=this.currentAttributes_||{}:h in this.outstandingChanges_?(o=this.outstandingChanges_[h].attributes,h=this.outstandingChanges_[h].origOrigin,delete this.outstandingChanges_[h]):o={},this.annotationList_.insertAnnotatedSpan(new _(l,c.length),new m(o)),r.push({start:l,end:l,removedAttributes:{},removed:"",text:c,attributes:o,origin:h})}this.markLineSentinelCharactersForChanges_(t),0<r.length&&this.trigger("change",this,r)},e.prototype.convertCoordinateSystemForChanges_=function(e){var t=this,n=function(e){return t.codeMirror.indexFromPos(e)};function i(n,i){return function(e){return h(e,i.from)?n(e):h(i.to,e)?n({line:e.line+i.text.length-1-(i.to.line-i.from.line),ch:i.to.line<e.line?e.ch:i.text.length<=1?e.ch-(i.to.ch-i.from.ch)+p(i.text):e.ch-i.to.ch+(t=i.text)[t.length-1].length})+p(i.removed)-p(i.text):i.from.line===e.line?n(i.from)+e.ch-i.from.ch:n(i.from)+p(i.removed.slice(0,e.line-i.from.line))+1+e.ch;var t}}for(var r=[],s=e.length-1;0<=s;s--){var o=e[s],a=(n=i(n,o))(o.from),l=o.removed.join("\n"),c=o.text.join("\n");r.unshift({start:a,end:a+l.length,removed:l,text:c,origin:o.origin})}return r},e.prototype.markLineSentinelCharactersForChanges_=function(e){for(var t=Number.MAX_VALUE,n=-1,i=0;i<e.length;i++){var r=e[i],s=r.from.line;r.from.ch;(1<r.removed.length||0<=r.removed[0].indexOf(u))&&(t=Math.min(t,s),n=Math.max(n,s)),1<r.text.length?(t=Math.min(t,s),n=Math.max(n,s+r.text.length-1)):0<=r.text[0].indexOf(u)&&(t=Math.min(t,s),n=Math.max(n,s))}n=Math.min(n,this.codeMirror.lineCount()-1),this.markLineSentinelCharactersForChangedLines_(t,n)},e.prototype.markLineSentinelCharactersForChangedLines_=function(e,t){if(e<Number.MAX_VALUE)for(;0<e&&this.lineIsListItemOrIndented_(e-1);)e--;if(-1<t)for(var n=this.codeMirror.lineCount();t+1<n&&this.lineIsListItemOrIndented_(t+1);)t++;for(var i=[],r=this.codeMirror,s=e;s<=t;s++){var o=r.getLine(s),a=r.getLineHandle(s);if(r.removeLineClass(a,"text",".*"),0<o.length)for(var l=o.indexOf(u);0<=l;){for(var c=l;l<o.length&&o[l]===u;){for(var d=r.findMarksAt({line:s,ch:l}),h=0;h<d.length;h++)d[h].isForLineSentinel&&d[h].clear();l++}this.markLineSentinelCharacters_(s,c,l,i),l=o.indexOf(u,l)}else i=[]}return t},e.prototype.markLineSentinelCharacters_=function(e,t,n,i){function r(){var e=a.find();return e?e.from.line:null}var s=this.codeMirror,o=null,a=null;if(0===t){var l=this.getLineAttributes_(e),c=l[f.LIST_TYPE],d=l[f.LINE_INDENT]||0;for(c&&0===d&&(d=1);d>=i.length;)i.push(1);"o"===c?(o=this.makeOrderedListElement_(i[d]),i[d]++):"u"===c?(o=this.makeUnorderedListElement_(),i[d]=1):"t"===c?(o=this.makeTodoListElement_(!1,r),i[d]=1):"tc"===c&&(o=this.makeTodoListElement_(!0,r),i[d]=1);var h=this.getClassNameForAttributes_(l);""!==h&&this.codeMirror.addLineClass(e,"text",h),i=i.slice(0,d+1)}var u={inclusiveLeft:!0,collapsed:!0};o&&(u.replacedWith=o),(a=s.markText({line:e,ch:t},{line:e,ch:n},u)).isForLineSentinel=!0},e.prototype.makeOrderedListElement_=function(e){return s.elt("div",e+".",{class:"firepad-list-left"})},e.prototype.makeUnorderedListElement_=function(){return s.elt("div","â€¢",{class:"firepad-list-left"})},e.prototype.toggleTodo=function(e){var t,n=f.LIST_TYPE,i=this.getCurrentLineAttributes_();n in i&&("t"===i[n]||"tc"===i[n])?"t"===i[n]?t="tc":"tc"===i[n]&&(t=!!e&&"t"):t="t",this.setLineAttribute(n,t)},e.prototype.makeTodoListElement_=function(e,t){var n={type:"checkbox",class:"firepad-todo-left"};e&&(n.checked=!0);var i=s.elt("input",!1,n),r=this;return s.on(i,"click",s.stopEventAnd(function(e){r.codeMirror.setCursor({line:t(),ch:1}),r.toggleTodo(!0)})),i},e.prototype.lineIsListItemOrIndented_=function(e){var t=this.getLineAttributes_(e);return!1!==(t[f.LIST_TYPE]||!1)||0!==(t[f.LINE_INDENT]||0)},e.prototype.onCursorActivity_=function(){var e=this;setTimeout(function(){e.updateCurrentAttributes_()},1)},e.prototype.getCurrentAttributes_=function(){return this.currentAttributes_||this.updateCurrentAttributes_(),this.currentAttributes_},e.prototype.updateCurrentAttributes_=function(){var e=this.codeMirror,t=e.indexFromPos(e.getCursor("anchor")),n=e.indexFromPos(e.getCursor("head")),i=n;if(n<t){for(;i<this.end();){var r=this.getRange(i,i+1);if("\n"!==r&&r!==u)break;i++}i<this.end()&&i++}else for(;0<i&&("\n"===(r=this.getRange(i-1,i))||r===u);)i--;var s=this.annotationList_.getAnnotatedSpansForPos(i);this.currentAttributes_={};var o={};for(var a in 0<s.length&&!(f.LINE_SENTINEL in s[0].annotation.attributes)?o=s[0].annotation.attributes:1<s.length&&(M.utils.assert(!(f.LINE_SENTINEL in s[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),o=s[1].annotation.attributes),o)"l"!==a&&"lt"!==a&&"li"!==a&&0!==a.indexOf(f.ENTITY_SENTINEL)&&(this.currentAttributes_[a]=o[a])},e.prototype.getCurrentLineAttributes_=function(){var e=this.codeMirror,t=e.getCursor("anchor"),n=e.getCursor("head"),i=n.line;return 0===n.ch&&t.line<n.line&&i--,this.getLineAttributes_(i)},e.prototype.getLineAttributes_=function(e){var t={},n=this.codeMirror.getLine(e);if(0<n.length&&n[0]===u){var i=this.codeMirror.indexFromPos({line:e,ch:0}),r=this.annotationList_.getAnnotatedSpansForSpan(new _(i,1));for(var s in M.utils.assert(1===r.length),r[0].annotation.attributes)t[s]=r[0].annotation.attributes[s]}return t},e.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new _(0,this.end()),function(e,t){return new m({})})},e.prototype.newline=function(){var e=this.codeMirror,n=this;if(this.emptySelection_()){var i=e.getCursor("head").line,r=this.getLineAttributes_(i),s=r[f.LIST_TYPE];s&&1===e.getLine(i).length?this.updateLineAttributes(i,i,function(e){delete e[f.LIST_TYPE],delete e[f.LINE_INDENT]}):(e.replaceSelection("\n","end","+input"),this.updateLineAttributes(i+1,i+1,function(e){for(var t in r)e[t]=r[t];"tc"===s&&(e[f.LIST_TYPE]="t"),n.trigger("newLine",{line:i+1,attr:e})}))}else e.replaceSelection("\n","end","+input")},e.prototype.deleteLeft=function(){var e=this.codeMirror,t=e.getCursor("head"),n=this.getLineAttributes_(t.line),i=n[f.LIST_TYPE],r=n[f.LINE_INDENT],s=this.emptySelection_()&&1===t.ch;s&&i?this.updateLineAttributes(t.line,t.line,function(e){delete e[f.LIST_TYPE],delete e[f.LINE_INDENT]}):s&&r&&0<r?this.unindent():e.deleteH(-1,"char")},e.prototype.deleteRight=function(){var e=this.codeMirror,t=e.getCursor("head"),n=e.getLine(t.line),i=this.areLineSentinelCharacters_(n),r=t.line+1<e.lineCount()?e.getLine(t.line+1):"";this.emptySelection_()&&i&&r[0]===u?(e.replaceRange("",{line:t.line,ch:0},{line:t.line+1,ch:0},"+input"),e.setCursor({line:t.line,ch:0})):e.deleteH(1,"char")},e.prototype.indent=function(){this.updateLineAttributesForSelection(function(e){var t=e[f.LINE_INDENT],n=e[f.LIST_TYPE];t?e[f.LINE_INDENT]++:e[f.LINE_INDENT]=n?2:1})},e.prototype.unindent=function(){this.updateLineAttributesForSelection(function(e){var t=e[f.LINE_INDENT];t&&1<t?e[f.LINE_INDENT]=t-1:(delete e[f.LIST_TYPE],delete e[f.LINE_INDENT])})},e.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(u,"g"),"")},e.prototype.areLineSentinelCharacters_=function(e){for(var t=0;t<e.length;t++)if(e[t]!==u)return!1;return!0},m.prototype.equals=function(e){if(!(e instanceof m))return!1;var t;for(t in this.attributes)if(e.attributes[t]!==this.attributes[t])return!1;for(t in e.attributes)if(e.attributes[t]!==this.attributes[t])return!1;return!0},e}(),(M=M||{}).RichTextCodeMirrorAdapter=function(){"use strict";var p=M.TextOperation,g=M.WrappedOperation,o=M.Cursor;function i(e){this.rtcm=e,this.cm=e.codeMirror,t(this,"onChange"),t(this,"onAttributesChange"),t(this,"onCursorActivity"),t(this,"onFocus"),t(this,"onBlur"),this.rtcm.on("change",this.onChange),this.rtcm.on("attributesChange",this.onAttributesChange),this.cm.on("cursorActivity",this.onCursorActivity),this.cm.on("focus",this.onFocus),this.cm.on("blur",this.onBlur)}function a(e,t){return e.line<t.line?-1:e.line>t.line?1:e.ch<t.ch?-1:e.ch>t.ch?1:0}function d(e){var t=e.lineCount()-1;return e.indexFromPos({line:t,ch:e.getLine(t).length})}function h(e,t){if(!e)throw new Error(t||"assertion error")}function t(e,t){var n=e[t];e[t]=function(){n.apply(e,arguments)}}function _(e){for(var t in e)return;return 1}function u(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");3===(e=e.replace(/^#/,"")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var n=parseInt(e,16),i=[n>>16,n>>8&255,255&n],r="rgb";return null!=t&&(r="rgba",i.push(t)),r+"("+i.join(",")+")"}return i.prototype.detach=function(){this.rtcm.off("change",this.onChange),this.rtcm.off("attributesChange",this.onAttributesChange),this.cm.off("cursorActivity",this.onCursorActivity),this.cm.off("focus",this.onFocus),this.cm.off("blur",this.onBlur)},i.operationFromCodeMirrorChanges=function(e,t){for(var n=d(t),i=(new p).retain(n),r=(new p).retain(n),s=e.length-1;0<=s;s--){var o=e[s],a=o.start,l=n-a-o.text.length;i=(new p).retain(a).delete(o.removed.length).insert(o.text,o.attributes).retain(l).compose(i),r=r.compose((new p).retain(a).delete(o.text.length).insert(o.removed,o.removedAttributes).retain(l)),n+=o.removed.length-o.text.length}return[i,r]},i.operationFromAttributesChanges=function(e,t){for(var n=d(t),i=new p,r=new p,s=0,o=0;o<e.length;o++){var a=e[o],l=a.start-s;h(0<=l),i.retain(l),r.retain(l);var c=a.end-a.start;i.retain(c,a.attributes),r.retain(c,a.attributesInverse),s=a.start+c}return i.retain(n-s),r.retain(n-s),[i,r]},i.prototype.registerCallbacks=function(e){this.callbacks=e},i.prototype.onChange=function(e,t){if("RTCMADAPTER"!==t[0].origin){var n=i.operationFromCodeMirrorChanges(t,this.cm);this.trigger("change",n[0],n[1])}},i.prototype.onAttributesChange=function(e,t){if("RTCMADAPTER"!==t[0].origin){var n=i.operationFromAttributesChanges(t,this.cm);this.trigger("change",n[0],n[1])}},i.prototype.onCursorActivity=function(){var e=this;setTimeout(function(){e.trigger("cursorActivity")},1)},i.prototype.onFocus=function(){this.trigger("focus")},i.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")},i.prototype.getValue=function(){return this.cm.getValue()},i.prototype.getCursor=function(){var e,t=this.cm,n=t.getCursor(),i=t.indexFromPos(n);if(t.somethingSelected()){var r=t.getCursor(!0),s=0===a(n,r)?t.getCursor(!1):r;e=t.indexFromPos(s)}else e=i;return new o(i,e)},i.prototype.setCursor=function(e){this.cm.setSelection(this.cm.posFromIndex(e.position),this.cm.posFromIndex(e.selectionEnd))},i.prototype.addStyleRule=function(e){if("undefined"!=typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var t=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet}if(!this.addedStyleRules[e])return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)}},i.prototype.setOtherCursor=function(e,t,n){var i=this.cm.posFromIndex(e.position);if("string"==typeof t&&t.match(/^#[a-fA-F0-9]{3,6}$/)){var r=this.rtcm.end();if("object"==typeof e&&"number"==typeof e.position&&"number"==typeof e.selectionEnd&&!(e.position<0||e.position>r||e.selectionEnd<0||e.selectionEnd>r)){if(e.position===e.selectionEnd){var s=this.cm.cursorCoords(i),o=document.createElement("span");return o.className="other-client",o.style.borderLeftWidth="2px",o.style.borderLeftStyle="solid",o.style.borderLeftColor=t,o.style.marginLeft=o.style.marginRight="-1px",o.style.height=.9*(s.bottom-s.top)+"px",o.setAttribute("data-clientid",n),o.style.zIndex=0,this.cm.setBookmark(i,{widget:o,insertLeft:!0})}var a,l,c="selection-"+t.replace("#",""),d="."+c+" { background: "+u(t)+";\n background: "+u(t,.4)+";}";return this.addStyleRule(d),l=e.selectionEnd>e.position?(a=i,this.cm.posFromIndex(e.selectionEnd)):(a=this.cm.posFromIndex(e.selectionEnd),i),this.cm.markText(a,l,{className:c})}}},i.prototype.trigger=function(e){var t=Array.prototype.slice.call(arguments,1),n=this.callbacks&&this.callbacks[e];n&&n.apply(this,t)},i.prototype.applyOperation=function(e){10<e.ops.length&&this.rtcm.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var t=e.ops,n=0,i=0,r=t.length;i<r;i++){var s=t[i];s.isRetain()?(_(s.attributes)||this.rtcm.updateTextAttributes(n,n+s.chars,function(e){for(var t in s.attributes)!1===s.attributes[t]?delete e[t]:e[t]=s.attributes[t]},"RTCMADAPTER",!0),n+=s.chars):s.isInsert()?(this.rtcm.insertText(n,s.text,s.attributes,"RTCMADAPTER"),n+=s.text.length):s.isDelete()&&this.rtcm.removeText(n,n+s.chars,"RTCMADAPTER")}10<e.ops.length&&(this.rtcm.codeMirror.getWrapperElement().setAttribute("style",""),this.rtcm.codeMirror.refresh())},i.prototype.registerUndo=function(e){this.cm.undo=e},i.prototype.registerRedo=function(e){this.cm.redo=e},i.prototype.invertOperation=function(e){for(var t,n,i=0,r=this.rtcm.codeMirror,s=new p,o=0;o<e.wrapped.ops.length;o++){var a=e.wrapped.ops[o];if(a.isRetain())if(_(a.attributes))s.retain(a.chars),i+=a.chars;else for(t=this.rtcm.getAttributeSpans(i,i+a.chars),n=0;n<t.length;n++){var l={};for(var c in a.attributes){var d=a.attributes[c],h=t[n].attributes[c];!1===d?h&&(l[c]=h):d!==h&&(l[c]=h||!1)}s.retain(t[n].length,l),i+=t[n].length}else if(a.isInsert())s.delete(a.text.length);else if(a.isDelete()){var u=r.getRange(r.posFromIndex(i),r.posFromIndex(i+a.chars));t=this.rtcm.getAttributeSpans(i,i+a.chars);var f=0;for(n=0;n<t.length;n++)s.insert(u.substr(f,t[n].length),t[n].attributes),f+=t[n].length;i+=a.chars}}return new g(s,e.meta.invert())},i}(),(M=M||{}).Formatting=(l=M.AttributeConstants,b.prototype.cloneWithNewAttribute_=function(e,t){var n={};for(var i in this.attributes)n[i]=this.attributes[i];return!1===t?delete n[e]:n[e]=t,new b(n)},b.prototype.bold=function(e){return this.cloneWithNewAttribute_(l.BOLD,e)},b.prototype.italic=function(e){return this.cloneWithNewAttribute_(l.ITALIC,e)},b.prototype.underline=function(e){return this.cloneWithNewAttribute_(l.UNDERLINE,e)},b.prototype.strike=function(e){return this.cloneWithNewAttribute_(l.STRIKE,e)},b.prototype.font=function(e){return this.cloneWithNewAttribute_(l.FONT,e)},b.prototype.fontSize=function(e){return this.cloneWithNewAttribute_(l.FONT_SIZE,e)},b.prototype.color=function(e){return this.cloneWithNewAttribute_(l.COLOR,e)},b.prototype.backgroundColor=function(e){return this.cloneWithNewAttribute_(l.BACKGROUND_COLOR,e)},b),(M=M||{}).Text=function e(t,n){if(!(this instanceof e))return new e(t,n);this.text=t,this.formatting=n||M.Formatting()},(M=M||{}).LineFormatting=(c=M.AttributeConstants,x.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"},x.prototype.cloneWithNewAttribute_=function(e,t){var n={};for(var i in this.attributes)n[i]=this.attributes[i];return!1===t?delete n[e]:n[e]=t,new x(n)},x.prototype.indent=function(e){return this.cloneWithNewAttribute_(c.LINE_INDENT,e)},x.prototype.align=function(e){return this.cloneWithNewAttribute_(c.LINE_ALIGN,e)},x.prototype.listItem=function(e){return M.utils.assert(!1===e||"u"===e||"o"===e||"t"===e||"tc"===e),this.cloneWithNewAttribute_(c.LIST_TYPE,e)},x.prototype.getIndent=function(){return this.attributes[c.LINE_INDENT]||0},x.prototype.getAlign=function(){return this.attributes[c.LINE_ALIGN]||0},x.prototype.getListItem=function(){return this.attributes[c.LIST_TYPE]||!1},x),(M=M||{}).Line=function e(t,n){if(!(this instanceof e))return new e(t,n);"[object Array]"!==Object.prototype.toString.call(t)&&(t=void 0===t?[]:[t]),this.textPieces=t,this.formatting=n||M.LineFormatting()},(M=M||{}).ParseHtml=function(){var c,d=M.LineFormatting.LIST_TYPE;function r(e,t,n){this.listType=e||d.UNORDERED,this.lineFormatting=t||M.LineFormatting(),this.textFormatting=n||M.Formatting()}function s(){this.lines=[],this.currentLine=[],this.currentLineListItemType=null}r.prototype.withTextFormatting=function(e){return new r(this.listType,this.lineFormatting,e)},r.prototype.withLineFormatting=function(e){return new r(this.listType,e,this.textFormatting)},r.prototype.withListType=function(e){return new r(e,this.lineFormatting,this.textFormatting)},r.prototype.withIncreasedIndent=function(){var e=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new r(this.listType,e,this.textFormatting)},r.prototype.withAlign=function(e){var t=this.lineFormatting.align(e);return new r(this.listType,t,this.textFormatting)},s.prototype.newlineIfNonEmpty=function(e){this.cleanLine_(),0<this.currentLine.length&&this.newline(e)},s.prototype.newlineIfNonEmptyOrListItem=function(e){this.cleanLine_(),(0<this.currentLine.length||null!==this.currentLineListItemType)&&this.newline(e)},s.prototype.newline=function(e){this.cleanLine_();var t=e.lineFormatting;null!==this.currentLineListItemType&&(t=t.listItem(this.currentLineListItemType),this.currentLineListItemType=null),this.lines.push(M.Line(this.currentLine,t)),this.currentLine=[]},s.prototype.makeListItem=function(e){this.currentLineListItemType=e},s.prototype.cleanLine_=function(){if(0<this.currentLine.length){var e=this.currentLine.length-1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,""),this.currentLine[e].text=this.currentLine[e].text.replace(/ +$/g,"");for(var t=0;t<this.currentLine.length;t++)this.currentLine[t].text=this.currentLine[t].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var h=h||{ELEMENT_NODE:1,TEXT_NODE:3};function o(e,t,n){if(e.nodeType===h.ELEMENT_NODE){var i=c.fromElement(e);if(i)return void n.currentLine.push(new M.Text(M.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new M.Formatting(i.toAttributes())))}switch(e.nodeType){case h.TEXT_NODE:var r=e.nodeValue.replace(/[ \n\t]+/g," ");n.currentLine.push(M.Text(r,t.textFormatting));break;case h.ELEMENT_NODE:switch(t=function(e,t){for(var n=e.textFormatting,i=e.lineFormatting,r=t.split(";"),s=0;s<r.length;s++){var o=r[s].split(":");if(2===o.length){var a=M.utils.trim(o[0]).toLowerCase(),l=M.utils.trim(o[1]).toLowerCase();switch(a){case"text-decoration":var c=0<=l.indexOf("underline"),d=0<=l.indexOf("line-through");n=n.underline(c).strike(d);break;case"font-weight":var h="bold"===l||600<=parseInt(l);n=n.bold(h);break;case"font-style":var u="italic"===l||"oblique"===l;n=n.italic(u);break;case"color":n=n.color(l);break;case"background-color":n=n.backgroundColor(l);break;case"text-align":i=i.align(l);break;case"font-size":var f=null;M.utils.stringEndsWith(l,["px","pt","%","em","xx-small","x-small","small","medium","large","x-large","xx-large","smaller","larger"])?f=l:parseInt(l)&&(f=parseInt(l)+"px"),f&&(n=n.fontSize(f));break;case"font-family":var p=M.utils.trim(l.split(",")[0]);p=(p=p.replace(/['"]/g,"")).replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),n=n.font(p)}}}return e.withLineFormatting(i).withTextFormatting(n)}(t,e.getAttribute("style")||""),e.nodeName.toLowerCase()){case"div":case"h1":case"h2":case"h3":case"p":n.newlineIfNonEmpty(t),u(e,t,n),n.newlineIfNonEmpty(t);break;case"center":t=t.withAlign("center"),n.newlineIfNonEmpty(t),u(e,t.withAlign("center"),n),n.newlineIfNonEmpty(t);break;case"b":case"strong":u(e,t.withTextFormatting(t.textFormatting.bold(!0)),n);break;case"u":u(e,t.withTextFormatting(t.textFormatting.underline(!0)),n);break;case"i":case"em":u(e,t.withTextFormatting(t.textFormatting.italic(!0)),n);break;case"s":u(e,t.withTextFormatting(t.textFormatting.strike(!0)),n);break;case"font":var s=e.getAttribute("face"),o=e.getAttribute("color"),a=parseInt(e.getAttribute("size"));s&&(t=t.withTextFormatting(t.textFormatting.font(s))),o&&(t=t.withTextFormatting(t.textFormatting.color(o))),a&&(t=t.withTextFormatting(t.textFormatting.fontSize(a))),u(e,t,n);break;case"br":n.newline(t);break;case"ul":n.newlineIfNonEmptyOrListItem(t);var l="firepad-todo"===e.getAttribute("class")?d.TODO:d.UNORDERED;u(e,t.withListType(l).withIncreasedIndent(),n),n.newlineIfNonEmpty(t);break;case"ol":n.newlineIfNonEmptyOrListItem(t),u(e,t.withListType(d.ORDERED).withIncreasedIndent(),n),n.newlineIfNonEmpty(t);break;case"li":!function(e,t,n){n.newlineIfNonEmptyOrListItem(t);var i="firepad-checked"===e.getAttribute("class")?d.TODOCHECKED:t.listType;n.makeListItem(i);var r=n.currentLine;u(e,t,n),(r===n.currentLine||0<n.currentLine.length)&&n.newline(t)}(e,t,n);break;case"style":break;default:u(e,t,n)}}}function u(e,t,n){if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++)o(e.childNodes[i],t,n)}return function(e,t){var n=(M.document||document).createElement("div");n.innerHTML=e,c=t;var i=new s;return o(n,new r,i),i.lines}}(),(M=M||{}).SerializeHtml=(I=M.utils,N=M.AttributeConstants,O=M.LineFormatting.LIST_TYPE,function(e,t){for(var n,i,r,s="",o=!0,a=[],l=!1,c=!0,d=!0,h=0,u=e.ops[h],f=!1;u;){I.assert(u.isInsert());var p=u.attributes;if(o){o=!1;var g=0,_=null,m="left";N.LINE_SENTINEL in p&&(g=p[N.LINE_INDENT]||0,_=p[N.LIST_TYPE]||null,m=p[N.LINE_ALIGN]||"left"),_&&(g=g||1),l?(s+="</li>",l=!1):c||(d&&(s+="<br/>"),s+="</div>"),c=!1,I.assert(0<=g,"Indent must not be negative.");for(;a.length>g||g===a.length&&null!==_&&(i=_,r=a[a.length-1],!(i===r||i===O.TODO&&r===O.TODOCHECKED||i===O.TODOCHECKED&&r===O.TODO));)s+=F(a.pop());for(;a.length<g;){var v=_||O.UNORDERED;f=_==O.TODO||_==O.TODOCHECKED||f,s+=(n=v)===O.ORDERED?"<ol>":n===O.UNORDERED?"<ul>":'<ul class="firepad-todo">',a.push(v)}var y="left"!==m?' style="text-align:'+m+'"':"";if(_){var b="";switch(_){case O.TODOCHECKED:b=' class="firepad-checked"';break;case O.TODO:b=' class="firepad-unchecked"'}s+="<li"+b+y+">",l=!0}else s+="<div"+y+">";d=!0}if(N.LINE_SENTINEL in p)u=e.ops[++h];else if(N.ENTITY_SENTINEL in p){for(var x=0;x<u.text.length;x++){var w=M.Entity.fromAttributes(p);s+=t.exportToElement(w).outerHTML}u=e.ops[++h]}else{var j="",k="";for(var C in p){var A,E,S=p[C];C===N.BOLD||C===N.ITALIC||C===N.UNDERLINE||C===N.STRIKE?(I.assert(!0===S),A=E=C):C===N.FONT_SIZE?(A='span style="font-size: '+S,A+="string"!=typeof S||-1===S.indexOf("px",S.length-2)?'px"':'"',E="span"):C===N.FONT?(A='span style="font-family: '+S+'"',E="span"):C===N.COLOR?(A='span style="color: '+S+'"',E="span"):C===N.BACKGROUND_COLOR?(A='span style="background-color: '+S+'"',E="span"):I.log(!1,"Encountered unknown attribute while rendering html: "+C),A&&(j+="<"+A+">"),E&&(k="</"+E+">"+k)}var T=u.text,L=T.indexOf("\n");0<=L?(o=!0,u=L<T.length-1?new M.TextOp("insert",T.substr(L+1),p):e.ops[++h],T=T.substr(0,L)):u=e.ops[++h],0<(T=T.replace(/  +/g,function(e){return new Array(e.length+1).join("Â ")}).replace(/^ /,"Â ").replace(/ $/,"Â ")).length&&(d=!1),s+=j+T.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+k}}for(l?s+="</li>":c||(d&&(s+="&nbsp;"),s+="</div>");0<a.length;)s+=F(a.pop());return f&&(s='<style>ul.firepad-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.firepad-todo > li { padding-left: 1em; text-indent: -1em; } ul.firepad-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.firepad-todo > li.firepad-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+s),s}),(M=M||{}).textPiecesToInserts=function(i,e){var n=[];function r(e,t){e instanceof M.Text&&(t=e.formatting.attributes,e=e.text),n.push({string:e,attributes:t}),i="\n"===e[e.length-1]}function t(e,t){i&&r(M.sentinelConstants.LINE_SENTINEL_CHARACTER,e.formatting.attributes);for(var n=0;n<e.textPieces.length;n++)r(e.textPieces[n]);t&&r("\n")}for(var s=0;s<e.length;s++)e[s]instanceof M.Line?t(e[s],s<e.length-1):r(e[s]);return n},(M=M||{}).Headless=(d=M.TextOperation,h=M.FirebaseAdapter,f=M.EntityManager,p=M.ParseHtml,w.prototype.getDocument=function(e){var t=this;if(t.ready_)return e(t.firebaseAdapter_.getDocument());t.firebaseAdapter_.on("ready",function(){t.ready_=!0,e(t.firebaseAdapter_.getDocument())})},w.prototype.getText=function(n){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");this.getDocument(function(e){var t=e.apply("");for(key in M.sentinelConstants)t=t.replace(new RegExp(M.sentinelConstants[key],"g"),"");n(t)})},w.prototype.setText=function(e,t){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");var n=d().insert(e);this.sendOperationWithRetry(n,t)},w.prototype.initializeFakeDom=function(n){"object"==typeof document||"object"==typeof M.document?n():require("jsdom").env("<head></head><body></body>",function(e,t){if(M.document)return t.close(),n();M.document=t.document,n()})},w.prototype.getHtml=function(t){var n=this;if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");n.initializeFakeDom(function(){n.getDocument(function(e){t(M.SerializeHtml(e,n.entityManager_))})})},w.prototype.setHtml=function(r,s){var o=this;if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");o.initializeFakeDom(function(){for(var e=p(r,o.entityManager_),t=M.textPiecesToInserts(!0,e),n=new d,i=0;i<t.length;i++)n.insert(t[i].string,t[i].attributes);o.sendOperationWithRetry(n,s)})},w.prototype.sendOperationWithRetry=function(n,i){var r=this;r.getDocument(function(e){var t=n.clone().delete(e.targetLength);r.firebaseAdapter_.sendOperation(t,function(e,t){t?void 0!==i&&i(null,t):r.sendOperationWithRetry(n,i)})})},w.prototype.dispose=function(){this.zombie_=!0,this.firebaseAdapter_.dispose()},w),(M=M||{}).Firepad=function(l){if(!M.RichTextCodeMirrorAdapter)throw new Error("Oops! It looks like you're trying to include lib/firepad.js directly.  This is actually one of many source files that make up firepad.  You want dist/firepad.js instead.");var c=M.RichTextCodeMirrorAdapter,d=M.RichTextCodeMirror,e=M.RichTextToolbar,h=M.ACEAdapter,u=M.MonacoAdapter,f=M.FirebaseAdapter,p=M.EditorClient,g=M.EntityManager,t=M.AttributeConstants,_=M.utils,m=(M.LineFormatting.LIST_TYPE,l.CodeMirror),v=l.ace;l.monaco;function y(e,t,n){if(!(this instanceof y))return new y(e,t,n);if(!m&&!v&&!l.monaco)throw new Error("Couldn't find CodeMirror, ACE or Monaco.  Did you forget to include codemirror.js/ace.js or import monaco?");if(this.zombie_=!1,m&&t instanceof m){this.codeMirror_=this.editor_=t;var i=this.codeMirror_.getValue();if(""!==i)throw new Error("Can't initialize Firepad with a CodeMirror instance that already contains text.")}else if(v&&t&&t.session instanceof v.EditSession){if(this.ace_=this.editor_=t,""!==(i=this.ace_.getValue()))throw new Error("Can't initialize Firepad with an ACE instance that already contains text.")}else if(l.monaco&&t&&t instanceof l.monaco.constructor){if(l.monaco,this.monaco_=this.editor_=t,""!==(i=this.monaco_.getValue()))throw new Error("Can't initialize Firepad with a Monaco instance that already contains text.")}else this.codeMirror_=this.editor_=new m(t);var r;r=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_?this.ace_.container:this.monaco_.getDomNode(),this.firepadWrapper_=_.elt("div",null,{class:"firepad"}),r.parentNode.replaceChild(this.firepadWrapper_,r),this.firepadWrapper_.appendChild(r),_.on(r,"dragstart",_.stopEvent),(this.editor_.firepad=this).options_=n||{},this.getOption("richTextShortcuts",!1)&&(m.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.firepadWrapper_.className+=" firepad-richtext"),this.imageInsertionUI=this.getOption("imageInsertionUI",!0),this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.firepadWrapper_.className+=" firepad-richtext firepad-with-toolbar"),this.addPoweredByLogo_(),this.codeMirror_&&this.codeMirror_.refresh();var s=this.getOption("userId",e.push().key),o=this.getOption("userColor",function(e){for(var t=1,n=0;n<e.length;n++)t=17*(t+e.charCodeAt(n))%360;return function(e,t,n){if(0===t)return b(n,n,n);function i(e){return e<0&&(e+=1),1<e&&--e,6*e<1?s+6*(r-s)*e:2*e<1?r:3*e<2?s+6*(r-s)*(2/3-e):s}var r=n<.5?n*(1+t):n+t-t*n,s=2*n-r;return b(i(e+1/3),i(e),i(e-1/3))}(t/360,1,.75)}(s));this.entityManager_=new g,this.firebaseAdapter_=new f(e,s,o),this.codeMirror_?(this.richTextCodeMirror_=new d(this.codeMirror_,this.entityManager_,{cssPrefix:"firepad-"}),this.editorAdapter_=new c(this.richTextCodeMirror_)):this.ace_?this.editorAdapter_=new h(this.ace_):this.editorAdapter_=new u(this.monaco_),this.client_=new p(this.firebaseAdapter_,this.editorAdapter_);var a=this;this.firebaseAdapter_.on("cursor",function(){a.trigger.apply(a,["cursor"].concat([].slice.call(arguments)))}),this.codeMirror_&&this.richTextCodeMirror_.on("newLine",function(){a.trigger.apply(a,["newLine"].concat([].slice.call(arguments)))}),this.firebaseAdapter_.on("ready",function(){a.ready_=!0,this.ace_&&this.editorAdapter_.grabDocumentState(),this.monaco_&&this.editorAdapter_.grabDocumentState();var e=a.getOption("defaultText",null);e&&a.isHistoryEmpty()&&a.setText(e),a.trigger("ready")}),this.client_.on("synced",function(e){a.trigger("synced",e)}),"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet.cssText=":before,:after{content:none !important;}",e.appendChild(t),setTimeout(function(){e.removeChild(t)},0)})}function b(e,t,n){function i(e){var t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t}return"#"+i(e)+i(t)+i(n)}return _.makeEventEmitter(y),(((y.fromCodeMirror=y).fromACE=y).fromMonaco=y).prototype.dispose=function(){this.zombie_=!0,editorWrapper=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_?this.ace_.container:this.monaco_.getDomNode(),this.firepadWrapper_.removeChild(editorWrapper),this.firepadWrapper_.parentNode.replaceChild(editorWrapper,this.firepadWrapper_),this.editor_.firepad=null,this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default"),this.firebaseAdapter_.dispose(),this.editorAdapter_.detach(),this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()},y.prototype.setUserId=function(e){this.firebaseAdapter_.setUserId(e)},y.prototype.setUserColor=function(e){this.firebaseAdapter_.setColor(e)},y.prototype.getText=function(){return this.assertReady_("getText"),this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_?this.ace_.getSession().getDocument().getValue():this.monaco_.getModel().getValue()},y.prototype.setText=function(e){return this.assertReady_("setText"),this.monaco_?this.monaco_.getModel().setValue(e):this.ace_?this.ace_.getSession().getDocument().setValue(e):(this.codeMirror_.getWrapperElement().setAttribute("style","display: none"),this.codeMirror_.setValue(""),this.insertText(0,e),this.codeMirror_.getWrapperElement().setAttribute("style",""),this.codeMirror_.refresh(),void this.editorAdapter_.setCursor({position:0,selectionEnd:0}))},y.prototype.insertTextAtCursor=function(e){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),e)},y.prototype.insertText=function(s,o){_.assert(!this.ace_,"Not supported for ace yet."),_.assert(!this.monaco_,"Not supported for monaco yet."),this.assertReady_("insertText"),"[object Array]"!==Object.prototype.toString.call(o)&&(o=[o]);var a=this;a.codeMirror_.operation(function(){for(var e=0===s,t=M.textPiecesToInserts(e,o),n=0;n<t.length;n++){var i=t[n].string,r=t[n].attributes;a.richTextCodeMirror_.insertText(s,i,r),s+=i.length}})},y.prototype.getOperationForSpan=function(e,t){for(var n=this.richTextCodeMirror_.getRange(e,t),i=this.richTextCodeMirror_.getAttributeSpans(e,t),r=0,s=new M.TextOperation,o=0;o<i.length;o++)s.insert(n.substr(r,i[o].length),i[o].attributes),r+=i[o].length;return s},y.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)},y.prototype.getHtmlFromSelection=function(){var e=this.codeMirror_.getCursor("start"),t=this.codeMirror_.getCursor("end"),n=this.codeMirror_.indexFromPos(e),i=this.codeMirror_.indexFromPos(t);return this.getHtmlFromRange(n,i)},y.prototype.getHtmlFromRange=function(e,t){this.assertReady_("getHtmlFromRange");var n=null!=e&&null!=t?this.getOperationForSpan(e,t):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return M.SerializeHtml(n,this.entityManager_)},y.prototype.insertHtml=function(e,t){var n=M.ParseHtml(t,this.entityManager_);this.insertText(e,n)},y.prototype.insertHtmlAtCursor=function(e){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),e)},y.prototype.setHtml=function(e){var t=M.ParseHtml(e,this.entityManager_);this.setText(t)},y.prototype.isHistoryEmpty=function(){return this.assertReady_("isHistoryEmpty"),this.firebaseAdapter_.isHistoryEmpty()},y.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(t.BOLD),this.codeMirror_.focus()},y.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(t.ITALIC),this.codeMirror_.focus()},y.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(t.UNDERLINE),this.codeMirror_.focus()},y.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(t.STRIKE),this.codeMirror_.focus()},y.prototype.fontSize=function(e){this.richTextCodeMirror_.setAttribute(t.FONT_SIZE,e),this.codeMirror_.focus()},y.prototype.font=function(e){this.richTextCodeMirror_.setAttribute(t.FONT,e),this.codeMirror_.focus()},y.prototype.color=function(e){this.richTextCodeMirror_.setAttribute(t.COLOR,e),this.codeMirror_.focus()},y.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(t.BACKGROUND_COLOR,"rgba(255,255,0,.65)"),this.codeMirror_.focus()},y.prototype.align=function(e){if("left"!==e&&"center"!==e&&"right"!==e)throw new Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(t.LINE_ALIGN,e),this.codeMirror_.focus()},y.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"o"),this.codeMirror_.focus()},y.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(t.LIST_TYPE,"u"),this.codeMirror_.focus()},y.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo(),this.codeMirror_.focus()},y.prototype.newline=function(){this.richTextCodeMirror_.newline()},y.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()},y.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()},y.prototype.indent=function(){this.richTextCodeMirror_.indent(),this.codeMirror_.focus()},y.prototype.unindent=function(){this.richTextCodeMirror_.unindent(),this.codeMirror_.focus()},y.prototype.undo=function(){this.codeMirror_.undo()},y.prototype.redo=function(){this.codeMirror_.redo()},y.prototype.insertEntity=function(e,t,n){this.richTextCodeMirror_.insertEntityAtCursor(e,t,n)},y.prototype.insertEntityAt=function(e,t,n,i){this.richTextCodeMirror_.insertEntityAt(e,t,n,i)},y.prototype.registerEntity=function(e,t){this.entityManager_.register(e,t)},y.prototype.getOption=function(e,t){return e in this.options_?this.options_[e]:t},y.prototype.assertReady_=function(e){if(!this.ready_)throw new Error('You must wait for the "ready" event before calling '+e+".");if(this.zombie_)throw new Error("You can't use a Firepad after calling dispose()!  [called "+e+"]")},y.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")},y.prototype.makeDialog_=function(n,e){var i=this,t=_.elt("input",null,{class:"firepad-dialog-input",id:n,type:"text",placeholder:e,autofocus:"autofocus"}),r=_.elt("a","Submit",{class:"firepad-btn",id:"submitbtn"});_.on(r,"click",_.stopEventAnd(function(){var e=document.getElementById("overlay");e.style.visibility="hidden";var t=document.getElementById(n).value;null!==t&&i.insertEntity(n,{src:t}),i.firepadWrapper_.removeChild(e)}));var s=_.elt("a","Cancel",{class:"firepad-btn"});_.on(s,"click",_.stopEventAnd(function(){var e=document.getElementById("overlay");e.style.visibility="hidden",i.firepadWrapper_.removeChild(e)}));var o=_.elt("div",[r,s],{class:"firepad-btn-group"}),a=_.elt("div",[t,o],{class:"firepad-dialog-div"}),l=_.elt("div",[a],{class:"firepad-dialog",id:"overlay"});this.firepadWrapper_.appendChild(l)},y.prototype.addToolbar_=function(){this.toolbar=new e(this.imageInsertionUI),this.toolbar.on("undo",this.undo,this),this.toolbar.on("redo",this.redo,this),this.toolbar.on("bold",this.bold,this),this.toolbar.on("italic",this.italic,this),this.toolbar.on("underline",this.underline,this),this.toolbar.on("strike",this.strike,this),this.toolbar.on("font-size",this.fontSize,this),this.toolbar.on("font",this.font,this),this.toolbar.on("color",this.color,this),this.toolbar.on("left",function(){this.align("left")},this),this.toolbar.on("center",function(){this.align("center")},this),this.toolbar.on("right",function(){this.align("right")},this),this.toolbar.on("ordered-list",this.orderedList,this),this.toolbar.on("unordered-list",this.unorderedList,this),this.toolbar.on("todo-list",this.todo,this),this.toolbar.on("indent-increase",this.indent,this),this.toolbar.on("indent-decrease",this.unindent,this),this.toolbar.on("insert-image",this.makeImageDialog_,this),this.firepadWrapper_.insertBefore(this.toolbar.element(),this.firepadWrapper_.firstChild)},y.prototype.addPoweredByLogo_=function(){var e=_.elt("a",null,{class:"powered-by-firepad"});e.setAttribute("href","http://www.firepad.io/"),e.setAttribute("target","_blank"),this.firepadWrapper_.appendChild(e)},y.prototype.initializeKeyMap_=function(){function e(t){return function(e){setTimeout(function(){t.call(e.firepad)},0)}}m.keyMap.richtext={"Ctrl-B":e(this.bold),"Cmd-B":e(this.bold),"Ctrl-I":e(this.italic),"Cmd-I":e(this.italic),"Ctrl-U":e(this.underline),"Cmd-U":e(this.underline),"Ctrl-H":e(this.highlight),"Cmd-H":e(this.highlight),Enter:e(this.newline),Delete:e(this.deleteRight),Backspace:e(this.deleteLeft),Tab:e(this.indent),"Shift-Tab":e(this.unindent),fallthrough:["default"]}},y}(this),M.Firepad.Formatting=M.Formatting,M.Firepad.Text=M.Text,M.Firepad.Entity=M.Entity,M.Firepad.LineFormatting=M.LineFormatting,M.Firepad.Line=M.Line,M.Firepad.TextOperation=M.TextOperation,M.Firepad.Headless=M.Headless,M.Firepad.RichTextCodeMirrorAdapter=M.RichTextCodeMirrorAdapter,M.Firepad.ACEAdapter=M.ACEAdapter,M.Firepad.MonacoAdapter=M.MonacoAdapter,M.Firepad},i=this,void 0!==e&&e.exports?e.exports=n():"function"==typeof i.define&&i.define.amd?define(n):i.Firepad=n()},"./node_modules/intro.js/intro.js":function(e,y,t){(function(i){function n(e){this._targetElement=e,this._introItems=[],this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",hidePrev:!1,hideNext:!1,tooltipPosition:"bottom",tooltipClass:"",highlightClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,showProgress:!1,scrollToElement:!0,overlayOpacity:.8,scrollPadding:30,positionPrecedence:["bottom","top","right","left"],disableInteraction:!1,hintPosition:"top-middle",hintButtonLabel:"Got it",hintAnimation:!0}}function p(e){if(null==e||"object"!=typeof e||void 0!==e.nodeType)return e;var t={};for(var n in e)void 0!==i&&e[n]instanceof i?t[n]=e[n]:t[n]=p(e[n]);return t}function F(){if(this._direction="forward",void 0!==this._currentStepNumber)for(var e=0,t=this._introItems.length;e<t;e++){this._introItems[e].step===this._currentStepNumber&&(this._currentStep=e-1,this._currentStepNumber=void 0)}if(void 0===this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep)return"function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),void D.call(this,this._targetElement);var n=this._introItems[this._currentStep];void 0!==this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,n.element),r.call(this,n)}function R(){if(this._direction="backward",0===this._currentStep)return!1;var e=this._introItems[--this._currentStep];void 0!==this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,e.element),r.call(this,e)}function D(e){var t=e.querySelectorAll(".introjs-overlay");if(t&&0<t.length)for(var n=t.length-1;0<=n;n--){var i=t[n];i.style.opacity=0,setTimeout(function(){this.parentNode&&this.parentNode.removeChild(this)}.bind(i),500)}var r=e.querySelector(".introjs-helperLayer");r&&r.parentNode.removeChild(r);var s=e.querySelector(".introjs-tooltipReferenceLayer");s&&s.parentNode.removeChild(s);var o=e.querySelector(".introjs-disableInteraction");o&&o.parentNode.removeChild(o);var a=document.querySelector(".introjsFloatingElement");a&&a.parentNode.removeChild(a),H();var l=document.querySelectorAll(".introjs-fixParent");if(l&&0<l.length)for(n=l.length-1;0<=n;n--)l[n].className=l[n].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),null!=this._introExitCallback&&this._introExitCallback.call(self),this._currentStep=void 0}function P(e,t,n,i,r){var s,o,a,l,c,d="";if(r=r||!1,t.style.top=null,t.style.right=null,t.style.bottom=null,t.style.left=null,t.style.marginLeft=null,t.style.marginTop=null,n.style.display="inherit",void 0!==i&&null!=i&&(i.style.top=null,i.style.left=null),this._introItems[this._currentStep])switch(d="string"==typeof(s=this._introItems[this._currentStep]).tooltipClass?s.tooltipClass:this._options.tooltipClass,t.className=("introjs-tooltip "+d).replace(/^\s+|\s+$/g,""),"auto"!=(c=this._introItems[this._currentStep].position)&&"auto"!=this._options.tooltipPosition||"floating"!=c&&(c=function(e,t,n){var i=this._options.positionPrecedence.slice(),r=q(),s=W(t).height+10,o=W(t).width+20,a=W(e),l="floating";a.left+o>r.width||a.left+a.width/2-o<0?(_(i,"bottom"),_(i,"top")):(a.height+a.top+s>r.height&&_(i,"bottom"),a.top-s<0&&_(i,"top"));a.width+a.left+o>r.width&&_(i,"right");a.left-o<0&&_(i,"left");0<i.length&&(l=i[0]);n&&"auto"!=n&&-1<i.indexOf(n)&&(l=n);return l}.call(this,e,t,c)),a=W(e),o=W(t),l=q(),c){case"top":if(n.className="introjs-arrow bottom",r)var h=0;else h=15;f(a,h,o,l,t),t.style.bottom=a.height+20+"px";break;case"right":t.style.left=a.width+20+"px",a.top+o.height>l.height?(n.className="introjs-arrow left-bottom",t.style.top="-"+(o.height-a.height-20)+"px"):n.className="introjs-arrow left";break;case"left":r||1!=this._options.showStepNumbers||(t.style.top="15px"),a.top+o.height>l.height?(t.style.top="-"+(o.height-a.height-20)+"px",n.className="introjs-arrow right-bottom"):n.className="introjs-arrow right",t.style.right=a.width+20+"px";break;case"floating":n.style.display="none",t.style.left="50%",t.style.top="50%",t.style.marginLeft="-"+o.width/2+"px",t.style.marginTop="-"+o.height/2+"px",void 0!==i&&null!=i&&(i.style.left="-"+(o.width/2+18)+"px",i.style.top="-"+(o.height/2+18)+"px");break;case"bottom-right-aligned":n.className="introjs-arrow top-right";g(a,0,o,t),t.style.top=a.height+20+"px";break;case"bottom-middle-aligned":n.className="introjs-arrow top-middle";var u=a.width/2-o.width/2;r&&(u+=5),g(a,u,o,t)&&(t.style.right=null,f(a,u,o,l,t)),t.style.top=a.height+20+"px";break;case"bottom-left-aligned":case"bottom":default:n.className="introjs-arrow top",f(a,h=0,o,l,t),t.style.top=a.height+20+"px"}}function f(e,t,n,i,r){if(!(e.left+t+n.width>i.width))return r.style.left=t+"px",1;r.style.left=i.width-n.width-e.left+"px"}function g(e,t,n,i){if(!(e.left+e.width-t-n.width<0))return i.style.right=t+"px",1;i.style.left=-e.left+"px"}function _(e,t){-1<e.indexOf(t)&&e.splice(e.indexOf(t),1)}function $(e){if(e){if(!this._introItems[this._currentStep])return;var t=this._introItems[this._currentStep],n=W(t.element),i=10;c(t.element)?e.className+=" introjs-fixedTooltip":e.className=e.className.replace(" introjs-fixedTooltip",""),"floating"==t.position&&(i=0),e.setAttribute("style","width: "+(n.width+i)+"px; height:"+(n.height+i)+"px; top:"+(n.top-5)+"px;left: "+(n.left-5)+"px;")}}function z(e){e.setAttribute("role","button"),e.tabIndex=0}function r(e){void 0!==this._introChangeCallback&&this._introChangeCallback.call(this,e.element);var t,n,i=this,r=document.querySelector(".introjs-helperLayer"),s=document.querySelector(".introjs-tooltipReferenceLayer"),o="introjs-helperLayer";W(e.element);if("string"==typeof e.highlightClass&&(o+=" "+e.highlightClass),"string"==typeof this._options.highlightClass&&(o+=" "+this._options.highlightClass),null!=r){var a=s.querySelector(".introjs-helperNumberLayer"),l=s.querySelector(".introjs-tooltiptext"),c=s.querySelector(".introjs-arrow"),d=s.querySelector(".introjs-tooltip"),h=s.querySelector(".introjs-skipbutton"),u=s.querySelector(".introjs-prevbutton"),f=s.querySelector(".introjs-nextbutton");if(r.className=o,d.style.opacity=0,d.style.display="none",null!=a){var p=this._introItems[0<=e.step-2?e.step-2:0];(null!=p&&"forward"==this._direction&&"floating"==p.position||"backward"==this._direction&&"floating"==e.position)&&(a.style.opacity=0)}$.call(i,r),$.call(i,s);var g=document.querySelectorAll(".introjs-fixParent");if(g&&0<g.length)for(var _=g.length-1;0<=_;_--)g[_].className=g[_].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");H(),i._lastShowElementTimer&&clearTimeout(i._lastShowElementTimer),i._lastShowElementTimer=setTimeout(function(){null!=a&&(a.innerHTML=e.step),l.innerHTML=e.intro,d.style.display="block",P.call(i,e.element,d,c,a),i._options.showBullets&&(s.querySelector(".introjs-bullets li > a.active").className="",s.querySelector('.introjs-bullets li > a[data-stepnumber="'+e.step+'"]').className="active"),s.querySelector(".introjs-progress .introjs-progressbar").setAttribute("style","width:"+K.call(i)+"%;"),d.style.opacity=1,a&&(a.style.opacity=1),-1===f.tabIndex?h.focus():f.focus()},350)}else{var m=document.createElement("div"),v=document.createElement("div"),y=document.createElement("div"),b=document.createElement("div"),x=document.createElement("div"),w=document.createElement("div"),j=document.createElement("div"),k=document.createElement("div");m.className=o,v.className="introjs-tooltipReferenceLayer",$.call(i,m),$.call(i,v),this._targetElement.appendChild(m),this._targetElement.appendChild(v),y.className="introjs-arrow",x.className="introjs-tooltiptext",x.innerHTML=e.intro,!(w.className="introjs-bullets")===this._options.showBullets&&(w.style.display="none");for(var C=document.createElement("ul"),A=(_=0,this._introItems.length);_<A;_++){var E=document.createElement("li"),S=document.createElement("a");S.onclick=function(){i.goToStep(this.getAttribute("data-stepnumber"))},_===e.step-1&&(S.className="active"),z(S),S.innerHTML="&nbsp;",S.setAttribute("data-stepnumber",this._introItems[_].step),E.appendChild(S),C.appendChild(E)}w.appendChild(C),!(j.className="introjs-progress")===this._options.showProgress&&(j.style.display="none");var T=document.createElement("div");if(T.className="introjs-progressbar",T.setAttribute("style","width:"+K.call(this)+"%;"),j.appendChild(T),!(k.className="introjs-tooltipbuttons")===this._options.showButtons&&(k.style.display="none"),b.className="introjs-tooltip",b.appendChild(x),b.appendChild(w),b.appendChild(j),1==this._options.showStepNumbers){var L=document.createElement("span");L.className="introjs-helperNumberLayer",L.innerHTML=e.step,v.appendChild(L)}b.appendChild(y),v.appendChild(b),(f=document.createElement("a")).onclick=function(){i._introItems.length-1!=i._currentStep&&F.call(i)},z(f),f.innerHTML=this._options.nextLabel,(u=document.createElement("a")).onclick=function(){0!=i._currentStep&&R.call(i)},z(u),u.innerHTML=this._options.prevLabel,(h=document.createElement("a")).className="introjs-button introjs-skipbutton",z(h),h.innerHTML=this._options.skipLabel,h.onclick=function(){i._introItems.length-1==i._currentStep&&"function"==typeof i._introCompleteCallback&&i._introCompleteCallback.call(i),D.call(i,i._targetElement)},k.appendChild(h),1<this._introItems.length&&(k.appendChild(u),k.appendChild(f)),b.appendChild(k),P.call(i,e.element,b,y,L)}if(!0===this._options.disableInteraction&&function(){var e=document.querySelector(".introjs-disableInteraction");null===e&&((e=document.createElement("div")).className="introjs-disableInteraction",this._targetElement.appendChild(e)),$.call(this,e)}.call(i),u.removeAttribute("tabIndex"),f.removeAttribute("tabIndex"),0==this._currentStep&&1<this._introItems.length?(h.className="introjs-button introjs-skipbutton",f.className="introjs-button introjs-nextbutton",1==this._options.hidePrev?(u.className="introjs-button introjs-prevbutton introjs-hidden",f.className+=" introjs-fullbutton"):u.className="introjs-button introjs-prevbutton introjs-disabled",u.tabIndex="-1",h.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(h.innerHTML=this._options.doneLabel,h.className+=" introjs-donebutton",u.className="introjs-button introjs-prevbutton",1==this._options.hideNext?(f.className="introjs-button introjs-nextbutton introjs-hidden",u.className+=" introjs-fullbutton"):f.className="introjs-button introjs-nextbutton introjs-disabled",f.tabIndex="-1"):(h.className="introjs-button introjs-skipbutton",u.className="introjs-button introjs-prevbutton",f.className="introjs-button introjs-nextbutton",h.innerHTML=this._options.skipLabel),f.focus(),function(e){if(e.element instanceof SVGElement)for(var t=e.element.parentNode;null!=e.element.parentNode&&t.tagName&&"body"!==t.tagName.toLowerCase();)"svg"===t.tagName.toLowerCase()&&U(t,"introjs-showElement introjs-relativePosition"),t=t.parentNode;U(e.element,"introjs-showElement");var n=B(e.element,"position");"absolute"!==n&&"relative"!==n&&"fixed"!==n&&U(e.element,"introjs-relativePosition");t=e.element.parentNode;for(;null!=t&&t.tagName&&"body"!==t.tagName.toLowerCase();){var i=B(t,"z-index"),r=parseFloat(B(t,"opacity")),s=B(t,"transform")||B(t,"-webkit-transform")||B(t,"-moz-transform")||B(t,"-ms-transform")||B(t,"-o-transform");(/[0-9]+/.test(i)||r<1||"none"!==s&&void 0!==s)&&(t.className+=" introjs-fixParent"),t=t.parentNode}}(e),t=e.element,!(0<=(n=t.getBoundingClientRect()).top&&0<=n.left&&n.bottom+80<=window.innerHeight&&n.right<=window.innerWidth)&&!0===this._options.scrollToElement){var I=e.element.getBoundingClientRect(),N=q().height,O=I.bottom-(I.bottom-I.top),M=I.bottom-N;O<0||e.element.clientHeight>N?window.scrollBy(0,O-this._options.scrollPadding):window.scrollBy(0,70+M+this._options.scrollPadding)}void 0!==this._introAfterChangeCallback&&this._introAfterChangeCallback.call(this,e.element)}function H(){for(var e=document.querySelectorAll(".introjs-showElement"),t=0,n=e.length;t<n;t++){s(e[t],/introjs-[a-zA-Z]+/g)}}function U(e,t){if(e instanceof SVGElement){var n=e.getAttribute("class")||"";e.setAttribute("class",n+" "+t)}else e.className+=" "+t}function s(e,t){if(e instanceof SVGElement){var n=e.getAttribute("class")||"";e.setAttribute("class",n.replace(t,"").replace(/^\s+|\s+$/g,""))}else e.className=e.className.replace(t,"").replace(/^\s+|\s+$/g,"")}function B(e,t){var n="";return e.currentStyle?n=e.currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t)),n&&n.toLowerCase?n.toLowerCase():n}function c(e){var t=e.parentNode;return!(!t||"HTML"===t.nodeName)&&("fixed"==B(e,"position")||c(t))}function q(){if(null!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var e=document.documentElement;return{width:e.clientWidth,height:e.clientHeight}}function d(){var e=this._targetElement.querySelector(".introjs-hintReference");if(e){var t=e.getAttribute("data-step");return e.parentNode.removeChild(e),t}}function o(e){if(this._introItems=[],this._options.hints)for(var t=0,n=this._options.hints.length;t<n;t++){var i=p(this._options.hints[t]);"string"==typeof i.element&&(i.element=document.querySelector(i.element)),i.hintPosition=i.hintPosition||this._options.hintPosition,i.hintAnimation=i.hintAnimation||this._options.hintAnimation,null!=i.element&&this._introItems.push(i)}else{var r=e.querySelectorAll("*[data-hint]");if(r.length<1)return!1;for(t=0,n=r.length;t<n;t++){var s=r[t],o=s.getAttribute("data-hintAnimation");o=o?"true"==o:this._options.hintAnimation,this._introItems.push({element:s,hint:s.getAttribute("data-hint"),hintPosition:s.getAttribute("data-hintPosition")||this._options.hintPosition,hintAnimation:o,tooltipClass:s.getAttribute("data-tooltipClass"),position:s.getAttribute("data-position")||this._options.tooltipPosition})}}(function(){var s=this,e=document.querySelector(".introjs-hints");if(null!=e)t=e;else{var t=document.createElement("div");t.className="introjs-hints"}for(var n=0,i=this._introItems.length;n<i;n++){var r=this._introItems[n];if(!document.querySelector('.introjs-hint[data-step="'+n+'"]')){var o=document.createElement("a");z(o),function(n,i,r){n.onclick=function(e){var t=e||window.event;t.stopPropagation&&t.stopPropagation(),null!=t.cancelBubble&&(t.cancelBubble=!0),v.call(s,n,i,r)}}(o,r,n),o.className="introjs-hint",r.hintAnimation||(o.className+=" introjs-hint-no-anim"),c(r.element)&&(o.className+=" introjs-fixedhint");var a=document.createElement("div");a.className="introjs-hint-dot";var l=document.createElement("div");l.className="introjs-hint-pulse",o.appendChild(a),o.appendChild(l),o.setAttribute("data-step",n),r.targetElement=r.element,r.element=o,m.call(this,r.hintPosition,o,r.targetElement),t.appendChild(o)}}document.body.appendChild(t),void 0!==this._hintsAddedCallback&&this._hintsAddedCallback.call(this)}).call(this),document.addEventListener?(document.addEventListener("click",d.bind(this),!1),window.addEventListener("resize",a.bind(this),!0)):document.attachEvent&&(document.attachEvent("onclick",d.bind(this)),document.attachEvent("onresize",a.bind(this)))}function a(){for(var e=0,t=this._introItems.length;e<t;e++){var n=this._introItems[e];void 0!==n.targetElement&&m.call(this,n.hintPosition,n.element,n.targetElement)}}function h(e){d.call(this);var t=this._targetElement.querySelector('.introjs-hint[data-step="'+e+'"]');t&&(t.className+=" introjs-hidehint"),void 0!==this._hintCloseCallback&&this._hintCloseCallback.call(this,e)}function l(e){var t=this._targetElement.querySelector('.introjs-hint[data-step="'+e+'"]');t&&(t.className=t.className.replace(/introjs\-hidehint/g,""))}function u(e){var t=this._targetElement.querySelector('.introjs-hint[data-step="'+e+'"]');t&&t.parentNode.removeChild(t)}function m(e,t,n){var i=W.call(this,n);switch(e){default:case"top-left":t.style.left=i.left+"px",t.style.top=i.top+"px";break;case"top-right":t.style.left=i.left+i.width-20+"px",t.style.top=i.top+"px";break;case"bottom-left":t.style.left=i.left+"px",t.style.top=i.top+i.height-20+"px";break;case"bottom-right":t.style.left=i.left+i.width-20+"px",t.style.top=i.top+i.height-20+"px";break;case"middle-left":t.style.left=i.left+"px",t.style.top=i.top+(i.height-20)/2+"px";break;case"middle-right":t.style.left=i.left+i.width-20+"px",t.style.top=i.top+(i.height-20)/2+"px";break;case"middle-middle":t.style.left=i.left+(i.width-20)/2+"px",t.style.top=i.top+(i.height-20)/2+"px";break;case"bottom-middle":t.style.left=i.left+(i.width-20)/2+"px",t.style.top=i.top+i.height-20+"px";break;case"top-middle":t.style.left=i.left+(i.width-20)/2+"px",t.style.top=i.top+"px"}}function v(e,t,n){void 0!==this._hintClickCallback&&this._hintClickCallback.call(this,e,t,n);var i=d.call(this);if(parseInt(i,10)!=n){var r=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div");r.className="introjs-tooltip",r.onclick=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},s.className="introjs-tooltiptext";var l=document.createElement("p");l.innerHTML=t.hint;var c=document.createElement("a");c.className="introjs-button",c.innerHTML=this._options.hintButtonLabel,c.onclick=h.bind(this,n),s.appendChild(l),s.appendChild(c),o.className="introjs-arrow",r.appendChild(o),r.appendChild(s),this._currentStep=e.getAttribute("data-step"),a.className="introjs-tooltipReferenceLayer introjs-hintReference",a.setAttribute("data-step",e.getAttribute("data-step")),$.call(this,a),a.appendChild(r),document.body.appendChild(a),P.call(this,e,r,o,null,!0)}}function W(e){var t={},n=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft;if(e instanceof SVGElement){var o=e.getBoundingClientRect();t.top=o.top+r,t.width=o.width,t.height=o.height,t.left=o.left+s}else{t.width=e.offsetWidth,t.height=e.offsetHeight;for(var a=0,l=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)a+=e.offsetLeft,l+=e.offsetTop,e=e.offsetParent;t.top=l,t.left=a}return t}function K(){return parseInt(this._currentStep+1,10)/this._introItems.length*100}var e,t;e=y,(t=function(e){if("object"==typeof e)return new n(e);if("string"!=typeof e)return new n(document.body);var t=document.querySelector(e);if(t)return new n(t);throw new Error("There is no element with given selector.")}).version="2.5.0",t.fn=n.prototype={clone:function(){return new n(this)},setOption:function(e,t){return this._options[e]=t,this},setOptions:function(e){return this._options=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n}(this._options,e),this},start:function(){return function(n){var e=[],i=this;if(this._options.steps)for(var t=0,r=this._options.steps.length;t<r;t++){var s=p(this._options.steps[t]);if(s.step=e.length+1,"string"==typeof s.element&&(s.element=document.querySelector(s.element)),void 0===s.element||null==s.element){var o=document.querySelector(".introjsFloatingElement");null==o&&((o=document.createElement("div")).className="introjsFloatingElement",document.body.appendChild(o)),s.element=o,s.position="floating"}null!=s.element&&e.push(s)}else{var a=n.querySelectorAll("*[data-intro]");if(a.length<1)return!1;t=0;for(var l=a.length;t<l;t++)if("none"!=(h=a[t]).style.display){var c=parseInt(h.getAttribute("data-step"),10);0<c&&(e[c-1]={element:h,intro:h.getAttribute("data-intro"),step:parseInt(h.getAttribute("data-step"),10),tooltipClass:h.getAttribute("data-tooltipClass"),highlightClass:h.getAttribute("data-highlightClass"),position:h.getAttribute("data-position")||this._options.tooltipPosition})}var d=0;for(t=0,l=a.length;t<l;t++){var h;if(null==(h=a[t]).getAttribute("data-step")){for(;void 0!==e[d];)d++;e[d]={element:h,intro:h.getAttribute("data-intro"),step:d+1,tooltipClass:h.getAttribute("data-tooltipClass"),highlightClass:h.getAttribute("data-highlightClass"),position:h.getAttribute("data-position")||this._options.tooltipPosition}}}}for(var u=[],f=0;f<e.length;f++)e[f]&&u.push(e[f]);return(e=u).sort(function(e,t){return e.step-t.step}),i._introItems=e,function(e){var t=document.createElement("div"),n="",i=this;if(t.className="introjs-overlay",e.tagName&&"body"!==e.tagName.toLowerCase()){var r=W(e);r&&(n+="width: "+r.width+"px; height:"+r.height+"px; top:"+r.top+"px;left: "+r.left+"px;",t.setAttribute("style",n))}else n+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",t.setAttribute("style",n);return e.appendChild(t),t.onclick=function(){1==i._options.exitOnOverlayClick&&D.call(i,e)},setTimeout(function(){n+="opacity: "+i._options.overlayOpacity.toString()+";",t.setAttribute("style",n)},10),!0}.call(i,n)&&(F.call(i),n.querySelector(".introjs-skipbutton"),n.querySelector(".introjs-nextbutton"),i._onKeyDown=function(e){if(27===e.keyCode&&1==i._options.exitOnEsc)D.call(i,n);else if(37===e.keyCode)R.call(i);else if(39===e.keyCode)F.call(i);else if(13===e.keyCode){var t=e.target||e.srcElement;t&&0<t.className.indexOf("introjs-prevbutton")?R.call(i):t&&0<t.className.indexOf("introjs-skipbutton")?(i._introItems.length-1==i._currentStep&&"function"==typeof i._introCompleteCallback&&i._introCompleteCallback.call(i),D.call(i,n)):F.call(i),e.preventDefault?e.preventDefault():e.returnValue=!1}},i._onResize=function(e){$.call(i,document.querySelector(".introjs-helperLayer")),$.call(i,document.querySelector(".introjs-tooltipReferenceLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",i._onKeyDown,!0),window.addEventListener("resize",i._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",i._onKeyDown),document.attachEvent("onresize",i._onResize))),!1}.call(this,this._targetElement),this},goToStep:function(e){return function(e){this._currentStep=e-2,void 0!==this._introItems&&F.call(this)}.call(this,e),this},addStep:function(e){return this._options.steps||(this._options.steps=[]),this._options.steps.push(e),this},addSteps:function(e){if(e.length){for(var t=0;t<e.length;t++)this.addStep(e[t]);return this}},goToStepNumber:function(e){return function(e){this._currentStepNumber=e,void 0!==this._introItems&&F.call(this)}.call(this,e),this},nextStep:function(){return F.call(this),this},previousStep:function(){return R.call(this),this},exit:function(){return D.call(this,this._targetElement),this},refresh:function(){return $.call(this,document.querySelector(".introjs-helperLayer")),$.call(this,document.querySelector(".introjs-tooltipReferenceLayer")),a.call(this),this},onbeforechange:function(e){if("function"!=typeof e)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=e,this},onchange:function(e){if("function"!=typeof e)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=e,this},onafterchange:function(e){if("function"!=typeof e)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=e,this},oncomplete:function(e){if("function"!=typeof e)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=e,this},onhintsadded:function(e){if("function"!=typeof e)throw new Error("Provided callback for onhintsadded was not a function.");return this._hintsAddedCallback=e,this},onhintclick:function(e){if("function"!=typeof e)throw new Error("Provided callback for onhintclick was not a function.");return this._hintClickCallback=e,this},onhintclose:function(e){if("function"!=typeof e)throw new Error("Provided callback for onhintclose was not a function.");return this._hintCloseCallback=e,this},onexit:function(e){if("function"!=typeof e)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=e,this},addHints:function(){return o.call(this,this._targetElement),this},hideHint:function(e){return h.call(this,e),this},hideHints:function(){return function(){var e=this._targetElement.querySelectorAll(".introjs-hint");if(e&&0<e.length)for(var t=0;t<e.length;t++)h.call(this,e[t].getAttribute("data-step"))}.call(this),this},showHint:function(e){return l.call(this,e),this},showHints:function(){return function(){var e=this._targetElement.querySelectorAll(".introjs-hint");if(e&&0<e.length)for(var t=0;t<e.length;t++)l.call(this,e[t].getAttribute("data-step"));else o.call(this,this._targetElement)}.call(this),this},removeHints:function(){return function(){var e=this._targetElement.querySelectorAll(".introjs-hint");if(e&&0<e.length)for(var t=0;t<e.length;t++)u.call(this,e[t].getAttribute("data-step"))}.call(this),this},removeHint:function(e){return u.call(this,e),this}},e.introJs=t}).call(this,t("./node_modules/jquery/dist/jquery.js"))},"./node_modules/intro.js/introjs.css":function(e,t,n){},"./node_modules/jstree/dist/jstree.js":function(e,t,n){var i,r,s;!function(){"use strict";r=[n("./node_modules/jquery/dist/jquery.js")],void 0===(s="function"==typeof(i=function(C,x){"use strict";if(C.jstree){return}var r=0,s=false,o=false,a=false,i=[],e=C("script:last").attr("src"),y=window.document,b=y.createElement("LI"),t,n;b.setAttribute("role","treeitem"),(t=y.createElement("I")).className="jstree-icon jstree-ocl",t.setAttribute("role","presentation"),b.appendChild(t),(t=y.createElement("A")).className="jstree-anchor",t.setAttribute("href","#"),t.setAttribute("tabindex","-1"),(n=y.createElement("I")).className="jstree-icon jstree-themeicon",n.setAttribute("role","presentation"),t.appendChild(n),b.appendChild(t),t=n=null,C.jstree={version:"3.1.1",defaults:{plugins:[]},plugins:{},path:e&&e.indexOf("/")!==-1?e.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g},C.jstree.create=function(e,n){var i=new C.jstree.core(++r),t=n;n=C.extend(true,{},C.jstree.defaults,n);if(t&&t.plugins){n.plugins=t.plugins}C.each(n.plugins,function(e,t){if(e!=="core"){i=i.plugin(t,n[t])}});C(e).data("jstree",i);i.init(e,n);return i},C.jstree.destroy=function(){C(".jstree:jstree").jstree("destroy");C(y).off(".jstree")},C.jstree.core=function(e){this._id=e;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:false,dots:false,icons:false},selected:[],last_error:{},working:false,worker_queue:[],focused:null}}},C.jstree.reference=function(t){var n=null,e=null;if(t&&t.id&&(!t.tagName||!t.nodeType)){t=t.id}if(!e||!e.length){try{e=C(t)}catch(e){}}if(!e||!e.length){try{e=C("#"+t.replace(C.jstree.idregex,"\\$&"))}catch(e){}}if(e&&e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))){n=e}else{C(".jstree").each(function(){var e=C(this).data("jstree");if(e&&e._model.data[t]){n=e;return false}})}return n},C.fn.jstree=function(n){var i=typeof n==="string",r=Array.prototype.slice.call(arguments,1),s=null;if(n===true&&!this.length){return false}this.each(function(){var e=C.jstree.reference(this),t=i&&e?e[n]:null;s=i&&t?t.apply(e,r):null;if(!e&&!i&&(n===x||C.isPlainObject(n))){C.jstree.create(this,n)}if(e&&!i||n===true){s=e||false}if(s!==null&&s!==x){return false}});return s!==null&&s!==x?s:this},C.expr[":"].jstree=C.expr.createPseudo(function(e){return function(e){return C(e).hasClass("jstree")&&C(e).data("jstree")!==x}}),C.jstree.defaults.core={data:false,strings:false,check_callback:false,error:C.noop,animation:200,multiple:true,themes:{name:false,url:false,dir:false,dots:true,icons:true,stripes:false,variant:false,responsive:false},expand_selected_onload:true,worker:true,force_text:false,dblclick_toggle:true},C.jstree.core.prototype={plugin:function(e,t){var n=C.jstree.plugins[e];if(n){this._data[e]={};n.prototype=this;return new n(t,this)}return this},init:function(e,t){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}},changed:[],force_full_redraw:false,redraw_timeout:false,default_state:{loaded:true,opened:false,selected:false,disabled:false}};this.element=C(e).addClass("jstree jstree-"+this._id);this.settings=t;this._data.core.ready=false;this._data.core.loaded=false;this._data.core.rtl=this.element.css("direction")==="rtl";this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");if(this.settings.core.multiple){this.element.attr("aria-multiselectable",true)}if(!this.element.attr("tabindex")){this.element.attr("tabindex","0")}this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(true);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<"+"ul class='jstree-container-ul jstree-children' role='group'><"+"li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||24;this.trigger("loading");this.load_node("#")},destroy:function(e){if(this._wrk){try{window.URL.revokeObjectURL(this._wrk);this._wrk=null}catch(e){}}if(!e){this.element.empty()}this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")});this.element=null},bind:function(){var s="",o=null,t=0;this.element.on("dblclick.jstree",function(){if(y.selection&&y.selection.empty){y.selection.empty()}else{if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges();e.collapse()}catch(e){}}}}).on("mousedown.jstree",C.proxy(function(e){if(e.target===this.element[0]){e.preventDefault();t=+new Date}},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",C.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",C.proxy(function(e){if(this.settings.core.dblclick_toggle){this.toggle_node(e.target)}},this)).on("click.jstree",".jstree-anchor",C.proxy(function(e){e.preventDefault();if(e.currentTarget!==y.activeElement){C(e.currentTarget).focus()}this.activate_node(e.currentTarget,e)},this)).on("keydown.jstree",".jstree-anchor",C.proxy(function(e){if(e.target.tagName==="INPUT"){return true}if(e.which!==32&&e.which!==13&&(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey)){return true}var t=null;if(this._data.core.rtl){if(e.which===37){e.which=39}else if(e.which===39){e.which=37}}switch(e.which){case 32:if(e.ctrlKey){e.type="click";C(e.currentTarget).trigger(e)}break;case 13:e.type="click";C(e.currentTarget).trigger(e);break;case 37:e.preventDefault();if(this.is_open(e.currentTarget)){this.close_node(e.currentTarget)}else{t=this.get_parent(e.currentTarget);if(t&&t.id!=="#"){this.get_node(t,true).children(".jstree-anchor").focus()}}break;case 38:e.preventDefault();t=this.get_prev_dom(e.currentTarget);if(t&&t.length){t.children(".jstree-anchor").focus()}break;case 39:e.preventDefault();if(this.is_closed(e.currentTarget)){this.open_node(e.currentTarget,function(e){this.get_node(e,true).children(".jstree-anchor").focus()})}else if(this.is_open(e.currentTarget)){t=this.get_node(e.currentTarget,true).children(".jstree-children")[0];if(t){C(this._firstChild(t)).children(".jstree-anchor").focus()}}break;case 40:e.preventDefault();t=this.get_next_dom(e.currentTarget);if(t&&t.length){t.children(".jstree-anchor").focus()}break;case 106:this.open_all();break;case 36:e.preventDefault();t=this._firstChild(this.get_container_ul()[0]);if(t){C(t).children(".jstree-anchor").filter(":visible").focus()}break;case 35:e.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().focus();break}},this)).on("load_node.jstree",C.proxy(function(e,t){if(t.status){if(t.node.id==="#"&&!this._data.core.loaded){this._data.core.loaded=true;if(this._firstChild(this.get_container_ul()[0])){this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id)}this.trigger("loaded")}if(!this._data.core.ready){setTimeout(C.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=true;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var e=[],t,n;for(t=0,n=this._data.core.selected.length;t<n;t++){e=e.concat(this._model.data[this._data.core.selected[t]].parents)}e=C.vakata.array_unique(e);for(t=0,n=e.length;t<n;t++){this.open_node(e[t],false,0)}}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0)}}},this)).on("keypress.jstree",C.proxy(function(e){if(e.target.tagName==="INPUT"){return true}if(o){clearTimeout(o)}o=setTimeout(function(){s=""},500);var n=String.fromCharCode(e.which).toLowerCase(),t=this.element.find(".jstree-anchor").filter(":visible"),i=t.index(y.activeElement)||0,r=false;s+=n;if(s.length>1){t.slice(i).each(C.proxy(function(e,t){if(C(t).text().toLowerCase().indexOf(s)===0){C(t).focus();r=true;return false}},this));if(r){return}t.slice(0,i).each(C.proxy(function(e,t){if(C(t).text().toLowerCase().indexOf(s)===0){C(t).focus();r=true;return false}},this));if(r){return}}if(new RegExp("^"+n+"+$").test(s)){t.slice(i+1).each(C.proxy(function(e,t){if(C(t).text().toLowerCase().charAt(0)===n){C(t).focus();r=true;return false}},this));if(r){return}t.slice(0,i+1).each(C.proxy(function(e,t){if(C(t).text().toLowerCase().charAt(0)===n){C(t).focus();r=true;return false}},this));if(r){return}}},this)).on("init.jstree",C.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots;this._data.core.themes.stripes=e.stripes;this._data.core.themes.icons=e.icons;this.set_theme(e.name||"default",e.url);this.set_theme_variant(e.variant)},this)).on("loading.jstree",C.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",C.proxy(function(e){this._data.core.focused=null;C(e.currentTarget).filter(".jstree-hovered").mouseleave();this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",C.proxy(function(e){var t=this.get_node(e.currentTarget);if(t&&t.id){this._data.core.focused=t.id}this.element.find(".jstree-hovered").not(e.currentTarget).mouseleave();C(e.currentTarget).mouseenter();this.element.attr("tabindex","-1")},this)).on("focus.jstree",C.proxy(function(){if(+new Date-t>500&&!this._data.core.focused){t=0;var e=this.get_node(this.element.attr("aria-activedescendant"),true);if(e){e.find("> .jstree-anchor").focus()}}},this)).on("mouseenter.jstree",".jstree-anchor",C.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",C.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree");C(y).off(".jstree-"+this._id)},trigger:function(e,t){if(!t){t={}}t.instance=this;this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(e){var t=this.settings.core.strings;if(C.isFunction(t)){return t.call(this,e)}if(t&&t[e]){return t[e]}return e},_firstChild:function(e){e=e?e.firstChild:null;while(e!==null&&e.nodeType!==1){e=e.nextSibling}return e},_nextSibling:function(e){e=e?e.nextSibling:null;while(e!==null&&e.nodeType!==1){e=e.nextSibling}return e},_previousSibling:function(e){e=e?e.previousSibling:null;while(e!==null&&e.nodeType!==1){e=e.previousSibling}return e},get_node:function(e,t){if(e&&e.id){e=e.id}var n;try{if(this._model.data[e]){e=this._model.data[e]}else if(typeof e==="string"&&this._model.data[e.replace(/^#/,"")]){e=this._model.data[e.replace(/^#/,"")]}else if(typeof e==="string"&&(n=C("#"+e.replace(C.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[n.closest(".jstree-node").attr("id")]){e=this._model.data[n.closest(".jstree-node").attr("id")]}else if((n=C(e,this.element)).length&&this._model.data[n.closest(".jstree-node").attr("id")]){e=this._model.data[n.closest(".jstree-node").attr("id")]}else if((n=C(e,this.element)).length&&n.hasClass("jstree")){e=this._model.data["#"]}else{return false}if(t){e=e.id==="#"?this.element:C("#"+e.id.replace(C.jstree.idregex,"\\$&"),this.element)}return e}catch(e){return false}},get_path:function(e,t,n){e=e.parents?e:this.get_node(e);if(!e||e.id==="#"||!e.parents){return false}var i,r,s=[];s.push(n?e.id:e.text);for(i=0,r=e.parents.length;i<r;i++){s.push(n?e.parents[i]:this.get_text(e.parents[i]))}s=s.reverse().slice(1);return t?s.join(t):s},get_next_dom:function(e,t){var n;e=this.get_node(e,true);if(e[0]===this.element[0]){n=this._firstChild(this.get_container_ul()[0]);while(n&&n.offsetHeight===0){n=this._nextSibling(n)}return n?C(n):false}if(!e||!e.length){return false}if(t){n=e[0];do{n=this._nextSibling(n)}while(n&&n.offsetHeight===0);return n?C(n):false}if(e.hasClass("jstree-open")){n=this._firstChild(e.children(".jstree-children")[0]);while(n&&n.offsetHeight===0){n=this._nextSibling(n)}if(n!==null){return C(n)}}n=e[0];do{n=this._nextSibling(n)}while(n&&n.offsetHeight===0);if(n!==null){return C(n)}return e.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(e,t){var n;e=this.get_node(e,true);if(e[0]===this.element[0]){n=this.get_container_ul()[0].lastChild;while(n&&n.offsetHeight===0){n=this._previousSibling(n)}return n?C(n):false}if(!e||!e.length){return false}if(t){n=e[0];do{n=this._previousSibling(n)}while(n&&n.offsetHeight===0);return n?C(n):false}n=e[0];do{n=this._previousSibling(n)}while(n&&n.offsetHeight===0);if(n!==null){e=C(n);while(e.hasClass("jstree-open")){e=e.children(".jstree-children").first().children(".jstree-node:visible:last")}return e}n=e[0].parentNode.parentNode;return n&&n.className&&n.className.indexOf("jstree-node")!==-1?C(n):false},get_parent:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}return e.parent},get_children_dom:function(e){e=this.get_node(e,true);if(e[0]===this.element[0]){return this.get_container_ul().children(".jstree-node")}if(!e||!e.length){return false}return e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){e=this.get_node(e);return e&&(e.state.loaded===false||e.children.length>0)},is_loaded:function(e){e=this.get_node(e);return e&&e.state.loaded},is_loading:function(e){e=this.get_node(e);return e&&e.state&&e.state.loading},is_open:function(e){e=this.get_node(e);return e&&e.state.opened},is_closed:function(e){e=this.get_node(e);return e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(n,i){var e,t,r,s,o;if(C.isArray(n)){this._load_nodes(n.slice(),i);return true}n=this.get_node(n);if(!n){if(i){i.call(this,n,false)}return false}if(n.state.loaded){n.state.loaded=false;for(e=0,t=n.children_d.length;e<t;e++){for(r=0,s=n.parents.length;r<s;r++){this._model.data[n.parents[r]].children_d=C.vakata.array_remove_item(this._model.data[n.parents[r]].children_d,n.children_d[e])}if(this._model.data[n.children_d[e]].state.selected){o=true;this._data.core.selected=C.vakata.array_remove_item(this._data.core.selected,n.children_d[e])}delete this._model.data[n.children_d[e]]}n.children=[];n.children_d=[];if(o){this.trigger("changed",{action:"load_node",node:n,selected:this._data.core.selected})}}n.state.failed=false;n.state.loading=true;this.get_node(n,true).addClass("jstree-loading").attr("aria-busy",true);this._load_node(n,C.proxy(function(e){n=this._model.data[n.id];n.state.loading=false;n.state.loaded=e;n.state.failed=!n.state.loaded;var t=this.get_node(n,true);if(n.state.loaded&&!n.children.length&&t&&t.length&&!t.hasClass("jstree-leaf")){t.removeClass("jstree-closed jstree-open").addClass("jstree-leaf")}t.removeClass("jstree-loading").attr("aria-busy",false);this.trigger("load_node",{node:n,status:e});if(i){i.call(this,n,e)}},this));return true},_load_nodes:function(e,t,n){var i=true,r=function(){this._load_nodes(e,t,true)},s=this._model.data,o,a,l=[];for(o=0,a=e.length;o<a;o++){if(s[e[o]]&&(!s[e[o]].state.loaded&&!s[e[o]].state.failed||!n)){if(!this.is_loading(e[o])){this.load_node(e[o],r)}i=false}}if(i){for(o=0,a=e.length;o<a;o++){if(s[e[o]]&&s[e[o]].state.loaded){l.push(e[o])}}if(t&&!t.done){t.call(this,l);t.done=true}}},load_all:function(e,t){if(!e){e="#"}e=this.get_node(e);if(!e){return false}var n=[],i=this._model.data,r=i[e.id].children_d,s,o;if(e.state&&!e.state.loaded){n.push(e.id)}for(s=0,o=r.length;s<o;s++){if(i[r[s]]&&i[r[s]].state&&!i[r[s]].state.loaded){n.push(r[s])}}if(n.length){this._load_nodes(n,function(){this.load_all(e,t)})}else{if(t){t.call(this,e)}this.trigger("load_all",{node:e})}},_load_node:function(r,s){var e=this.settings.core.data,t;if(!e){if(r.id==="#"){return this._append_html_data(r,this._data.core.original_container_html.clone(true),function(e){s.call(this,e)})}else{return s.call(this,false)}}if(C.isFunction(e)){return e.call(this,r,C.proxy(function(e){if(e===false){s.call(this,false)}this[typeof e==="string"?"_append_html_data":"_append_json_data"](r,typeof e==="string"?C(C.parseHTML(e)).filter(function(){return this.nodeType!==3}):e,function(e){s.call(this,e)})},this))}if(typeof e==="object"){if(e.url){e=C.extend(true,{},e);if(C.isFunction(e.url)){e.url=e.url.call(this,r)}if(C.isFunction(e.data)){e.data=e.data.call(this,r)}return C.ajax(e).done(C.proxy(function(e,t,n){var i=n.getResponseHeader("Content-Type");if(i&&i.indexOf("json")!==-1||typeof e==="object"){return this._append_json_data(r,e,function(e){s.call(this,e)})}if(i&&i.indexOf("html")!==-1||typeof e==="string"){return this._append_html_data(r,C(C.parseHTML(e)).filter(function(){return this.nodeType!==3}),function(e){s.call(this,e)})}this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:r.id,xhr:n})};this.settings.core.error.call(this,this._data.core.last_error);return s.call(this,false)},this)).fail(C.proxy(function(e){s.call(this,false);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:r.id,xhr:e})};this.settings.core.error.call(this,this._data.core.last_error)},this))}t=C.isArray(e)||C.isPlainObject(e)?JSON.parse(JSON.stringify(e)):e;if(r.id==="#"){return this._append_json_data(r,t,function(e){s.call(this,e)})}else{this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:r.id})};this.settings.core.error.call(this,this._data.core.last_error);return s.call(this,false)}}if(typeof e==="string"){if(r.id==="#"){return this._append_html_data(r,C(C.parseHTML(e)).filter(function(){return this.nodeType!==3}),function(e){s.call(this,e)})}else{this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:r.id})};this.settings.core.error.call(this,this._data.core.last_error);return s.call(this,false)}}return s.call(this,false)},_node_changed:function(e){e=this.get_node(e);if(e){this._model.changed.push(e.id)}},_append_html_data:function(e,t,n){e=this.get_node(e);e.children=[];e.children_d=[];var i=t.is("ul")?t.children():t,r=e.id,s=[],o=[],a=this._model.data,l=a[r],c=this._data.core.selected.length,d,h,u;i.each(C.proxy(function(e,t){d=this._parse_model_from_html(C(t),r,l.parents.concat());if(d){s.push(d);o.push(d);if(a[d].children_d.length){o=o.concat(a[d].children_d)}}},this));l.children=s;l.children_d=o;for(h=0,u=l.parents.length;h<u;h++){a[l.parents[h]].children_d=a[l.parents[h]].children_d.concat(o)}this.trigger("model",{nodes:o,parent:r});if(r!=="#"){this._node_changed(r);this.redraw()}else{this.get_container_ul().children(".jstree-initial-node").remove();this.redraw(true)}if(this._data.core.selected.length!==c){this.trigger("changed",{action:"model",selected:this._data.core.selected})}n.call(this,true)},_append_json_data:function(e,t,l,n){if(this.element===null){return}e=this.get_node(e);e.children=[];e.children_d=[];if(t.d){t=t.d;if(typeof t==="string"){t=JSON.parse(t)}}if(!C.isArray(t)){t=[t]}var i=null,r={df:this._model.default_state,dat:t,par:e.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},s=function(e,c){if(e.data){e=e.data}var t=e.dat,n=e.par,i=[],r=[],d=[],h=e.df,u=e.t_id,f=e.t_cnt,p=e.m,s=p[n],o=e.sel,a,l,g,_,m=function(e,t,n){if(!n){n=[]}else{n=n.concat()}if(t){n.unshift(t)}var i=e.id.toString(),r,s,o,a,l={id:i,text:e.text||"",icon:e.icon!==c?e.icon:true,parent:t,parents:n,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(r in h){if(h.hasOwnProperty(r)){l.state[r]=h[r]}}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){l.icon=e.data.jstree.icon}if(l.icon===c||l.icon===null||l.icon===""){l.icon=true}if(e&&e.data){l.data=e.data;if(e.data.jstree){for(r in e.data.jstree){if(e.data.jstree.hasOwnProperty(r)){l.state[r]=e.data.jstree[r]}}}}if(e&&typeof e.state==="object"){for(r in e.state){if(e.state.hasOwnProperty(r)){l.state[r]=e.state[r]}}}if(e&&typeof e.li_attr==="object"){for(r in e.li_attr){if(e.li_attr.hasOwnProperty(r)){l.li_attr[r]=e.li_attr[r]}}}if(!l.li_attr.id){l.li_attr.id=i}if(e&&typeof e.a_attr==="object"){for(r in e.a_attr){if(e.a_attr.hasOwnProperty(r)){l.a_attr[r]=e.a_attr[r]}}}if(e&&e.children&&e.children===true){l.state.loaded=false;l.children=[];l.children_d=[]}p[l.id]=l;for(r=0,s=l.children.length;r<s;r++){o=m(p[l.children[r]],l.id,n);a=p[o];l.children_d.push(o);if(a.children_d.length){l.children_d=l.children_d.concat(a.children_d)}}delete e.data;delete e.children;p[l.id].original=e;if(l.state.selected){d.push(l.id)}return l.id},v=function(e,t,n){if(!n){n=[]}else{n=n.concat()}if(t){n.unshift(t)}var i=false,r,s,o,a,l;do{i="j"+u+"_"+ ++f}while(p[i]);l={id:false,text:typeof e==="string"?e:"",icon:typeof e==="object"&&e.icon!==c?e.icon:true,parent:t,parents:n,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(r in h){if(h.hasOwnProperty(r)){l.state[r]=h[r]}}if(e&&e.id){l.id=e.id.toString()}if(e&&e.text){l.text=e.text}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){l.icon=e.data.jstree.icon}if(l.icon===c||l.icon===null||l.icon===""){l.icon=true}if(e&&e.data){l.data=e.data;if(e.data.jstree){for(r in e.data.jstree){if(e.data.jstree.hasOwnProperty(r)){l.state[r]=e.data.jstree[r]}}}}if(e&&typeof e.state==="object"){for(r in e.state){if(e.state.hasOwnProperty(r)){l.state[r]=e.state[r]}}}if(e&&typeof e.li_attr==="object"){for(r in e.li_attr){if(e.li_attr.hasOwnProperty(r)){l.li_attr[r]=e.li_attr[r]}}}if(l.li_attr.id&&!l.id){l.id=l.li_attr.id.toString()}if(!l.id){l.id=i}if(!l.li_attr.id){l.li_attr.id=l.id}if(e&&typeof e.a_attr==="object"){for(r in e.a_attr){if(e.a_attr.hasOwnProperty(r)){l.a_attr[r]=e.a_attr[r]}}}if(e&&e.children&&e.children.length){for(r=0,s=e.children.length;r<s;r++){o=v(e.children[r],l.id,n);a=p[o];l.children.push(o);if(a.children_d.length){l.children_d=l.children_d.concat(a.children_d)}}l.children_d=l.children_d.concat(l.children)}if(e&&e.children&&e.children===true){l.state.loaded=false;l.children=[];l.children_d=[]}delete e.data;delete e.children;l.original=e;p[l.id]=l;if(l.state.selected){d.push(l.id)}return l.id};if(t.length&&t[0].id!==c&&t[0].parent!==c){for(l=0,g=t.length;l<g;l++){if(!t[l].children){t[l].children=[]}p[t[l].id.toString()]=t[l]}for(l=0,g=t.length;l<g;l++){p[t[l].parent.toString()].children.push(t[l].id.toString());s.children_d.push(t[l].id.toString())}for(l=0,g=s.children.length;l<g;l++){a=m(p[s.children[l]],n,s.parents.concat());r.push(a);if(p[a].children_d.length){r=r.concat(p[a].children_d)}}for(l=0,g=s.parents.length;l<g;l++){p[s.parents[l]].children_d=p[s.parents[l]].children_d.concat(r)}_={cnt:f,mod:p,sel:o,par:n,dpc:r,add:d}}else{for(l=0,g=t.length;l<g;l++){a=v(t[l],n,s.parents.concat());if(a){i.push(a);r.push(a);if(p[a].children_d.length){r=r.concat(p[a].children_d)}}}s.children=i;s.children_d=r;for(l=0,g=s.parents.length;l<g;l++){p[s.parents[l]].children_d=p[s.parents[l]].children_d.concat(r)}_={cnt:f,mod:p,sel:o,par:n,dpc:r,add:d}}if(typeof window==="undefined"||typeof window.document==="undefined"){postMessage(_)}else{return _}},o=function(e,t){if(this.element===null){return}this._cnt=e.cnt;this._model.data=e.mod;if(t){var n,i,r=e.add,s=e.sel,o=this._data.core.selected.slice(),a=this._model.data;if(s.length!==o.length||C.vakata.array_unique(s.concat(o)).length!==s.length){for(n=0,i=s.length;n<i;n++){if(C.inArray(s[n],r)===-1&&C.inArray(s[n],o)===-1){a[s[n]].state.selected=false}}for(n=0,i=o.length;n<i;n++){if(C.inArray(o[n],s)===-1){a[o[n]].state.selected=true}}}}if(e.add.length){this._data.core.selected=this._data.core.selected.concat(e.add)}this.trigger("model",{nodes:e.dpc,parent:e.par});if(e.par!=="#"){this._node_changed(e.par);this.redraw()}else{this.redraw(true)}if(e.add.length){this.trigger("changed",{action:"model",selected:this._data.core.selected})}l.call(this,true)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker){try{if(this._wrk===null){this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+s.toString()],{type:"text/javascript"}))}if(!this._data.core.working||n){this._data.core.working=true;i=new window.Worker(this._wrk);i.onmessage=C.proxy(function(e){o.call(this,e.data,true);try{i.terminate();i=null}catch(e){}if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}},this);if(!r.par){if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}}else{i.postMessage(r)}}else{this._data.core.worker_queue.push([e,t,l,true])}}catch(e){o.call(this,s(r),false);if(this._data.core.worker_queue.length){this._append_json_data.apply(this,this._data.core.worker_queue.shift())}else{this._data.core.working=false}}}else{o.call(this,s(r),false)}},_parse_model_from_html:function(e,t,n){if(!n){n=[]}else{n=[].concat(n)}if(t){n.unshift(t)}var i,r,s=this._model.data,o={id:false,text:false,icon:true,parent:t,parents:n,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false},a,l,c;for(a in this._model.default_state){if(this._model.default_state.hasOwnProperty(a)){o.state[a]=this._model.default_state[a]}}l=C.vakata.attributes(e,true);C.each(l,function(e,t){t=C.trim(t);if(!t.length){return true}o.li_attr[e]=t;if(e==="id"){o.id=t.toString()}});l=e.children("a").first();if(l.length){l=C.vakata.attributes(l,true);C.each(l,function(e,t){t=C.trim(t);if(t.length){o.a_attr[e]=t}})}l=e.children("a").first().length?e.children("a").first().clone():e.clone();l.children("ins, i, ul").remove();l=l.html();l=C("<div />").html(l);o.text=this.settings.core.force_text?l.text():l.html();l=e.data();o.data=l?C.extend(true,{},l):null;o.state.opened=e.hasClass("jstree-open");o.state.selected=e.children("a").hasClass("jstree-clicked");o.state.disabled=e.children("a").hasClass("jstree-disabled");if(o.data&&o.data.jstree){for(a in o.data.jstree){if(o.data.jstree.hasOwnProperty(a)){o.state[a]=o.data.jstree[a]}}}l=e.children("a").children(".jstree-themeicon");if(l.length){o.icon=l.hasClass("jstree-themeicon-hidden")?false:l.attr("rel")}if(o.state.icon!==x){o.icon=o.state.icon}if(o.icon===x||o.icon===null||o.icon===""){o.icon=true}l=e.children("ul").children("li");do{c="j"+this._id+"_"+ ++this._cnt}while(s[c]);o.id=o.li_attr.id?o.li_attr.id.toString():c;if(l.length){l.each(C.proxy(function(e,t){i=this._parse_model_from_html(C(t),o.id,n);r=this._model.data[i];o.children.push(i);if(r.children_d.length){o.children_d=o.children_d.concat(r.children_d)}},this));o.children_d=o.children_d.concat(o.children)}else{if(e.hasClass("jstree-closed")){o.state.loaded=false}}if(o.li_attr["class"]){o.li_attr["class"]=o.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")}if(o.a_attr["class"]){o.a_attr["class"]=o.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")}s[o.id]=o;if(o.state.selected){this._data.core.selected.push(o.id)}return o.id},_parse_model_from_flat_json:function(e,t,n){if(!n){n=[]}else{n=n.concat()}if(t){n.unshift(t)}var i=e.id.toString(),r=this._model.data,s=this._model.default_state,o,a,l,c,d={id:i,text:e.text||"",icon:e.icon!==x?e.icon:true,parent:t,parents:n,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(o in s){if(s.hasOwnProperty(o)){d.state[o]=s[o]}}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){d.icon=e.data.jstree.icon}if(d.icon===x||d.icon===null||d.icon===""){d.icon=true}if(e&&e.data){d.data=e.data;if(e.data.jstree){for(o in e.data.jstree){if(e.data.jstree.hasOwnProperty(o)){d.state[o]=e.data.jstree[o]}}}}if(e&&typeof e.state==="object"){for(o in e.state){if(e.state.hasOwnProperty(o)){d.state[o]=e.state[o]}}}if(e&&typeof e.li_attr==="object"){for(o in e.li_attr){if(e.li_attr.hasOwnProperty(o)){d.li_attr[o]=e.li_attr[o]}}}if(!d.li_attr.id){d.li_attr.id=i}if(e&&typeof e.a_attr==="object"){for(o in e.a_attr){if(e.a_attr.hasOwnProperty(o)){d.a_attr[o]=e.a_attr[o]}}}if(e&&e.children&&e.children===true){d.state.loaded=false;d.children=[];d.children_d=[]}r[d.id]=d;for(o=0,a=d.children.length;o<a;o++){l=this._parse_model_from_flat_json(r[d.children[o]],d.id,n);c=r[l];d.children_d.push(l);if(c.children_d.length){d.children_d=d.children_d.concat(c.children_d)}}delete e.data;delete e.children;r[d.id].original=e;if(d.state.selected){this._data.core.selected.push(d.id)}return d.id},_parse_model_from_json:function(e,t,n){if(!n){n=[]}else{n=n.concat()}if(t){n.unshift(t)}var i=false,r,s,o,a,l=this._model.data,c=this._model.default_state,d;do{i="j"+this._id+"_"+ ++this._cnt}while(l[i]);d={id:false,text:typeof e==="string"?e:"",icon:typeof e==="object"&&e.icon!==x?e.icon:true,parent:t,parents:n,children:[],children_d:[],data:null,state:{},li_attr:{id:false},a_attr:{href:"#"},original:false};for(r in c){if(c.hasOwnProperty(r)){d.state[r]=c[r]}}if(e&&e.id){d.id=e.id.toString()}if(e&&e.text){d.text=e.text}if(e&&e.data&&e.data.jstree&&e.data.jstree.icon){d.icon=e.data.jstree.icon}if(d.icon===x||d.icon===null||d.icon===""){d.icon=true}if(e&&e.data){d.data=e.data;if(e.data.jstree){for(r in e.data.jstree){if(e.data.jstree.hasOwnProperty(r)){d.state[r]=e.data.jstree[r]}}}}if(e&&typeof e.state==="object"){for(r in e.state){if(e.state.hasOwnProperty(r)){d.state[r]=e.state[r]}}}if(e&&typeof e.li_attr==="object"){for(r in e.li_attr){if(e.li_attr.hasOwnProperty(r)){d.li_attr[r]=e.li_attr[r]}}}if(d.li_attr.id&&!d.id){d.id=d.li_attr.id.toString()}if(!d.id){d.id=i}if(!d.li_attr.id){d.li_attr.id=d.id}if(e&&typeof e.a_attr==="object"){for(r in e.a_attr){if(e.a_attr.hasOwnProperty(r)){d.a_attr[r]=e.a_attr[r]}}}if(e&&e.children&&e.children.length){for(r=0,s=e.children.length;r<s;r++){o=this._parse_model_from_json(e.children[r],d.id,n);a=l[o];d.children.push(o);if(a.children_d.length){d.children_d=d.children_d.concat(a.children_d)}}d.children_d=d.children_d.concat(d.children)}if(e&&e.children&&e.children===true){d.state.loaded=false;d.children=[];d.children_d=[]}delete e.data;delete e.children;d.original=e;l[d.id]=d;if(d.state.selected){this._data.core.selected.push(d.id)}return d.id},_redraw:function(){var e=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),t=y.createElement("UL"),n,i,r,s=this._data.core.focused;for(i=0,r=e.length;i<r;i++){n=this.redraw_node(e[i],true,this._model.force_full_redraw);if(n&&this._model.force_full_redraw){t.appendChild(n)}}if(this._model.force_full_redraw){t.className=this.get_container_ul()[0].className;t.setAttribute("role","group");this.element.empty().append(t)}if(s!==null){n=this.get_node(s,true);if(n&&n.length&&n.children(".jstree-anchor")[0]!==y.activeElement){n.children(".jstree-anchor").focus()}else{this._data.core.focused=null}}this._model.force_full_redraw=false;this._model.changed=[];this.trigger("redraw",{nodes:e})},redraw:function(e){if(e){this._model.force_full_redraw=true}this._redraw()},draw_children:function(e){var t=this.get_node(e),n=false,i=false,r=false,s=y;if(!t){return false}if(t.id==="#"){return this.redraw(true)}e=this.get_node(e,true);if(!e||!e.length){return false}e.children(".jstree-children").remove();e=e[0];if(t.children.length&&t.state.loaded){r=s.createElement("UL");r.setAttribute("role","group");r.className="jstree-children";for(n=0,i=t.children.length;n<i;n++){r.appendChild(this.redraw_node(t.children[n],true,true))}e.appendChild(r)}},redraw_node:function(e,t,n,i){var r=this.get_node(e),s=false,o=false,a=false,l=false,c=false,d=false,h="",u=y,f=this._model.data,p=false,g=false,_=null,m=0,v=0;if(!r){return false}if(r.id==="#"){return this.redraw(true)}t=t||r.children.length===0;e=!y.querySelector?y.getElementById(r.id):this.element[0].querySelector("#"+("0123456789".indexOf(r.id[0])!==-1?"\\3"+r.id[0]+" "+r.id.substr(1).replace(C.jstree.idregex,"\\$&"):r.id.replace(C.jstree.idregex,"\\$&")));if(!e){t=true;if(!n){s=r.parent!=="#"?C("#"+r.parent.replace(C.jstree.idregex,"\\$&"),this.element)[0]:null;if(s!==null&&(!s||!f[r.parent].state.opened)){return false}o=C.inArray(r.id,s===null?f["#"].children:f[r.parent].children)}}else{e=C(e);if(!n){s=e.parent().parent()[0];if(s===this.element[0]){s=null}o=e.index()}if(!t&&r.children.length&&!e.children(".jstree-children").length){t=true}if(!t){a=e.children(".jstree-children")[0]}p=e.children(".jstree-anchor")[0]===y.activeElement;e.remove()}e=b.cloneNode(true);h="jstree-node ";for(l in r.li_attr){if(r.li_attr.hasOwnProperty(l)){if(l==="id"){continue}if(l!=="class"){e.setAttribute(l,r.li_attr[l])}else{h+=r.li_attr[l]}}}if(!r.a_attr.id){r.a_attr.id=r.id+"_anchor"}e.setAttribute("aria-selected",!!r.state.selected);e.setAttribute("aria-level",r.parents.length);e.setAttribute("aria-labelledby",r.a_attr.id);if(r.state.disabled){e.setAttribute("aria-disabled",true)}if(r.state.loaded&&!r.children.length){h+=" jstree-leaf"}else{h+=r.state.opened&&r.state.loaded?" jstree-open":" jstree-closed";e.setAttribute("aria-expanded",r.state.opened&&r.state.loaded)}if(r.parent!==null&&f[r.parent].children[f[r.parent].children.length-1]===r.id){h+=" jstree-last"}e.id=r.id;e.className=h;h=(r.state.selected?" jstree-clicked":"")+(r.state.disabled?" jstree-disabled":"");for(c in r.a_attr){if(r.a_attr.hasOwnProperty(c)){if(c==="href"&&r.a_attr[c]==="#"){continue}if(c!=="class"){e.childNodes[1].setAttribute(c,r.a_attr[c])}else{h+=" "+r.a_attr[c]}}}if(h.length){e.childNodes[1].className="jstree-anchor "+h}if(r.icon&&r.icon!==true||r.icon===false){if(r.icon===false){e.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden"}else if(r.icon.indexOf("/")===-1&&r.icon.indexOf(".")===-1){e.childNodes[1].childNodes[0].className+=" "+r.icon+" jstree-themeicon-custom"}else{e.childNodes[1].childNodes[0].style.backgroundImage="url("+r.icon+")";e.childNodes[1].childNodes[0].style.backgroundPosition="center center";e.childNodes[1].childNodes[0].style.backgroundSize="auto";e.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom"}}if(this.settings.core.force_text){e.childNodes[1].appendChild(u.createTextNode(r.text))}else{e.childNodes[1].innerHTML+=r.text}if(t&&r.children.length&&(r.state.opened||i)&&r.state.loaded){d=u.createElement("UL");d.setAttribute("role","group");d.className="jstree-children";for(l=0,c=r.children.length;l<c;l++){d.appendChild(this.redraw_node(r.children[l],t,true))}e.appendChild(d)}if(a){e.appendChild(a)}if(!n){if(!s){s=this.element[0]}for(l=0,c=s.childNodes.length;l<c;l++){if(s.childNodes[l]&&s.childNodes[l].className&&s.childNodes[l].className.indexOf("jstree-children")!==-1){_=s.childNodes[l];break}}if(!_){_=u.createElement("UL");_.setAttribute("role","group");_.className="jstree-children";s.appendChild(_)}s=_;if(o<s.childNodes.length){s.insertBefore(e,s.childNodes[o])}else{s.appendChild(e)}if(p){m=this.element[0].scrollTop;v=this.element[0].scrollLeft;e.childNodes[1].focus();this.element[0].scrollTop=m;this.element[0].scrollLeft=v}}if(r.state.opened&&!r.state.loaded){r.state.opened=false;setTimeout(C.proxy(function(){this.open_node(r.id,false,0)},this),0)}return e},open_node:function(e,n,i){var t,r,s,o;if(C.isArray(e)){e=e.slice();for(t=0,r=e.length;t<r;t++){this.open_node(e[t],n,i)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}i=i===x?this.settings.core.animation:i;if(!this.is_closed(e)){if(n){n.call(this,e,false)}return false}if(!this.is_loaded(e)){if(this.is_loading(e)){return setTimeout(C.proxy(function(){this.open_node(e,n,i)},this),500)}this.load_node(e,function(e,t){return t?this.open_node(e,n,i):n?n.call(this,e,false):false})}else{s=this.get_node(e,true);o=this;if(s.length){if(i&&s.children(".jstree-children").length){s.children(".jstree-children").stop(true,true)}if(e.children.length&&!this._firstChild(s.children(".jstree-children")[0])){this.draw_children(e)}if(!i){this.trigger("before_open",{node:e});s[0].className=s[0].className.replace("jstree-closed","jstree-open");s[0].setAttribute("aria-expanded",true)}else{this.trigger("before_open",{node:e});s.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",true).children(".jstree-children").stop(true,true).slideDown(i,function(){this.style.display="";o.trigger("after_open",{node:e})})}}e.state.opened=true;if(n){n.call(this,e,true)}if(!s.length){this.trigger("before_open",{node:e})}this.trigger("open_node",{node:e});if(!i||!s.length){this.trigger("after_open",{node:e})}}},_open_to:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}var t,n,i=e.parents;for(t=0,n=i.length;t<n;t+=1){if(t!=="#"){this.open_node(i[t],false,0)}}return C("#"+e.id.replace(C.jstree.idregex,"\\$&"),this.element)},close_node:function(e,t){var n,i,r,s;if(C.isArray(e)){e=e.slice();for(n=0,i=e.length;n<i;n++){this.close_node(e[n],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}if(this.is_closed(e)){return false}t=t===x?this.settings.core.animation:t;r=this;s=this.get_node(e,true);if(s.length){if(!t){s[0].className=s[0].className.replace("jstree-open","jstree-closed");s.attr("aria-expanded",false).children(".jstree-children").remove()}else{s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",false).children(".jstree-children").stop(true,true).slideUp(t,function(){this.style.display="";s.children(".jstree-children").remove();r.trigger("after_close",{node:e})})}}e.state.opened=false;this.trigger("close_node",{node:e});if(!t||!s.length){this.trigger("after_close",{node:e})}},toggle_node:function(e){var t,n;if(C.isArray(e)){e=e.slice();for(t=0,n=e.length;t<n;t++){this.toggle_node(e[t])}return true}if(this.is_closed(e)){return this.open_node(e)}if(this.is_open(e)){return this.close_node(e)}},open_all:function(e,n,i){if(!e){e="#"}e=this.get_node(e);if(!e){return false}var t=e.id==="#"?this.get_container_ul():this.get_node(e,true),r,s,o;if(!t.length){for(r=0,s=e.children_d.length;r<s;r++){if(this.is_closed(this._model.data[e.children_d[r]])){this._model.data[e.children_d[r]].state.opened=true}}return this.trigger("open_all",{node:e})}i=i||t;o=this;t=this.is_closed(e)?t.find(".jstree-closed").addBack():t.find(".jstree-closed");t.each(function(){o.open_node(this,function(e,t){if(t&&this.is_parent(e)){this.open_all(e,n,i)}},n||0)});if(i.find(".jstree-closed").length===0){this.trigger("open_all",{node:this.get_node(i)})}},close_all:function(e,t){if(!e){e="#"}e=this.get_node(e);if(!e){return false}var n=e.id==="#"?this.get_container_ul():this.get_node(e,true),i=this,r,s;if(!n.length){for(r=0,s=e.children_d.length;r<s;r++){this._model.data[e.children_d[r]].state.opened=false}return this.trigger("close_all",{node:e})}n=this.is_open(e)?n.find(".jstree-open").addBack():n.find(".jstree-open");C(n.get().reverse()).each(function(){i.close_node(this,t||0)});this.trigger("close_all",{node:e})},is_disabled:function(e){e=this.get_node(e);return e&&e.state&&e.state.disabled},enable_node:function(e){var t,n;if(C.isArray(e)){e=e.slice();for(t=0,n=e.length;t<n;t++){this.enable_node(e[t])}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}e.state.disabled=false;this.get_node(e,true).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",false);this.trigger("enable_node",{node:e})},disable_node:function(e){var t,n;if(C.isArray(e)){e=e.slice();for(t=0,n=e.length;t<n;t++){this.disable_node(e[t])}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}e.state.disabled=true;this.get_node(e,true).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",true);this.trigger("disable_node",{node:e})},activate_node:function(e,t){if(this.is_disabled(e)){return false}this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==x?this.get_node(this._data.core.last_clicked.id):null;if(this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected){this._data.core.last_clicked=null}if(!this._data.core.last_clicked&&this._data.core.selected.length){this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])}if(!this.settings.core.multiple||!t.metaKey&&!t.ctrlKey&&!t.shiftKey||t.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(e)||this.get_parent(e)!==this._data.core.last_clicked.parent)){if(!this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&this.is_selected(e)){this.deselect_node(e,false,t)}else{this.deselect_all(true);this.select_node(e,false,false,t);this._data.core.last_clicked=this.get_node(e)}}else{if(t.shiftKey){var n=this.get_node(e).id,i=this._data.core.last_clicked.id,r=this.get_node(this._data.core.last_clicked.parent).children,s=false,o,a;for(o=0,a=r.length;o<a;o+=1){if(r[o]===n){s=!s}if(r[o]===i){s=!s}if(!this.is_disabled(r[o])&&(s||r[o]===n||r[o]===i)){this.select_node(r[o],true,false,t)}else{this.deselect_node(r[o],true,t)}}this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:t})}else{if(!this.is_selected(e)){this.select_node(e,false,false,t)}else{this.deselect_node(e,false,t)}}}this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){e=this.get_node(e,true);if(!e||!e.length||e.children(".jstree-hovered").length){return false}var t=this.element.find(".jstree-hovered"),n=this.element;if(t&&t.length){this.dehover_node(t)}e.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(e)});setTimeout(function(){n.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){e=this.get_node(e,true);if(!e||!e.length||!e.children(".jstree-hovered").length){return false}e.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(e,t,n,i){var r,s,o,a;if(C.isArray(e)){e=e.slice();for(s=0,o=e.length;s<o;s++){this.select_node(e[s],t,n,i)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}r=this.get_node(e,true);if(!e.state.selected){e.state.selected=true;this._data.core.selected.push(e.id);if(!n){r=this._open_to(e)}if(r&&r.length){r.attr("aria-selected",true).children(".jstree-anchor").addClass("jstree-clicked")}this.trigger("select_node",{node:e,selected:this._data.core.selected,event:i});if(!t){this.trigger("changed",{action:"select_node",node:e,selected:this._data.core.selected,event:i})}}},deselect_node:function(e,t,n){var i,r,s;if(C.isArray(e)){e=e.slice();for(i=0,r=e.length;i<r;i++){this.deselect_node(e[i],t,n)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}s=this.get_node(e,true);if(e.state.selected){e.state.selected=false;this._data.core.selected=C.vakata.array_remove_item(this._data.core.selected,e.id);if(s.length){s.attr("aria-selected",false).children(".jstree-anchor").removeClass("jstree-clicked")}this.trigger("deselect_node",{node:e,selected:this._data.core.selected,event:n});if(!t){this.trigger("changed",{action:"deselect_node",node:e,selected:this._data.core.selected,event:n})}}},select_all:function(e){var t=this._data.core.selected.concat([]),n,i;this._data.core.selected=this._model.data["#"].children_d.concat();for(n=0,i=this._data.core.selected.length;n<i;n++){if(this._model.data[this._data.core.selected[n]]){this._model.data[this._data.core.selected[n]].state.selected=true}}this.redraw(true);this.trigger("select_all",{selected:this._data.core.selected});if(!e){this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:t})}},deselect_all:function(e){var t=this._data.core.selected.concat([]),n,i;for(n=0,i=this._data.core.selected.length;n<i;n++){if(this._model.data[this._data.core.selected[n]]){this._model.data[this._data.core.selected[n]].state.selected=false}}this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",false);this.trigger("deselect_all",{selected:this._data.core.selected,node:t});if(!e){this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})}},is_selected:function(e){e=this.get_node(e);if(!e||e.id==="#"){return false}return e.state.selected},get_selected:function(e){return e?C.map(this._data.core.selected,C.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(e){var t=this.get_selected(true),n={},i,r,s,o;for(i=0,r=t.length;i<r;i++){n[t[i].id]=t[i]}for(i=0,r=t.length;i<r;i++){for(s=0,o=t[i].children_d.length;s<o;s++){if(n[t[i].children_d[s]]){delete n[t[i].children_d[s]]}}}t=[];for(i in n){if(n.hasOwnProperty(i)){t.push(i)}}return e?C.map(t,C.proxy(function(e){return this.get_node(e)},this)):t},get_bottom_selected:function(e){var t=this.get_selected(true),n=[],i,r;for(i=0,r=t.length;i<r;i++){if(!t[i].children.length){n.push(t[i].id)}}return e?C.map(n,C.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var e={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},t;for(t in this._model.data){if(this._model.data.hasOwnProperty(t)){if(t!=="#"){if(this._model.data[t].state.opened){e.core.open.push(t)}if(this._model.data[t].state.selected){e.core.selected.push(t)}}}}return e},set_state:function(t,n){if(t){if(t.core){var e,i,r,s,o;if(t.core.open){if(!C.isArray(t.core.open)||!t.core.open.length){delete t.core.open;this.set_state(t,n)}else{this._load_nodes(t.core.open,function(e){this.open_node(e,false,0);delete t.core.open;this.set_state(t,n)},true)}return false}if(t.core.scroll){if(t.core.scroll&&t.core.scroll.left!==x){this.element.scrollLeft(t.core.scroll.left)}if(t.core.scroll&&t.core.scroll.top!==x){this.element.scrollTop(t.core.scroll.top)}delete t.core.scroll;this.set_state(t,n);return false}if(t.core.selected){s=this;this.deselect_all();C.each(t.core.selected,function(e,t){s.select_node(t,false,true)});delete t.core.selected;this.set_state(t,n);return false}for(o in t){if(t.hasOwnProperty(o)&&o!=="core"&&C.inArray(o,this.settings.plugins)===-1){delete t[o]}}if(C.isEmptyObject(t.core)){delete t.core;this.set_state(t,n);return false}}if(C.isEmptyObject(t)){t=null;if(n){n.call(this)}this.trigger("set_state");return false}return true}return false},refresh:function(e,t){this._data.core.state=t===true?{}:this.get_state();if(t&&C.isFunction(t)){this._data.core.state=t.call(this,this._data.core.state)}this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:false}}};var n=this.get_container_ul()[0].className;if(!e){this.element.html("<"+"ul class='"+n+"' role='group'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading")}this.load_node("#",function(e,t){if(t){this.get_container_ul()[0].className=n;if(this._firstChild(this.get_container_ul()[0])){this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id)}this.set_state(C.extend(true,{},this._data.core.state),function(){this.trigger("refresh")})}this._data.core.state=null})},refresh_node:function(t){t=this.get_node(t);if(!t||t.id==="#"){return false}var n=[],e=[],i=this._data.core.selected.concat([]);e.push(t.id);if(t.state.opened===true){n.push(t.id)}this.get_node(t,true).find(".jstree-open").each(function(){n.push(this.id)});this._load_nodes(e,C.proxy(function(e){this.open_node(n,false,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(e,t){e=this.get_node(e);if(!e||e.id==="#"){return false}var n,i,r=this._model.data;t=t.toString();r[e.parent].children[C.inArray(e.id,r[e.parent].children)]=t;for(n=0,i=e.parents.length;n<i;n++){r[e.parents[n]].children_d[C.inArray(e.id,r[e.parents[n]].children_d)]=t}for(n=0,i=e.children.length;n<i;n++){r[e.children[n]].parent=t}for(n=0,i=e.children_d.length;n<i;n++){r[e.children_d[n]].parents[C.inArray(e.id,r[e.children_d[n]].parents)]=t}n=C.inArray(e.id,this._data.core.selected);if(n!==-1){this._data.core.selected[n]=t}n=this.get_node(e.id,true);if(n){n.attr("id",t).children(".jstree-anchor").attr("id",t+"_anchor").end().attr("aria-labelledby",t+"_anchor");if(this.element.attr("aria-activedescendant")===e.id){this.element.attr("aria-activedescendant",t)}}delete r[e.id];e.id=t;e.li_attr.id=t;r[t]=e;return true},get_text:function(e){e=this.get_node(e);return!e||e.id==="#"?false:e.text},set_text:function(e,t){var n,i;if(C.isArray(e)){e=e.slice();for(n=0,i=e.length;n<i;n++){this.set_text(e[n],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}e.text=t;if(this.get_node(e,true).length){this.redraw_node(e.id)}this.trigger("set_text",{obj:e,text:t});return true},get_json:function(e,t,n){e=this.get_node(e||"#");if(!e){return false}if(t&&t.flat&&!n){n=[]}var i={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:C.extend(true,{},e.li_attr),a_attr:C.extend(true,{},e.a_attr),state:{},data:t&&t.no_data?false:C.extend(true,{},e.data)},r,s;if(t&&t.flat){i.parent=e.parent}else{i.children=[]}if(!t||!t.no_state){for(r in e.state){if(e.state.hasOwnProperty(r)){i.state[r]=e.state[r]}}}if(t&&t.no_id){delete i.id;if(i.li_attr&&i.li_attr.id){delete i.li_attr.id}if(i.a_attr&&i.a_attr.id){delete i.a_attr.id}}if(t&&t.flat&&e.id!=="#"){n.push(i)}if(!t||!t.no_children){for(r=0,s=e.children.length;r<s;r++){if(t&&t.flat){this.get_json(e.children[r],t,n)}else{i.children.push(this.get_json(e.children[r],t))}}}return t&&t.flat?n:e.id==="#"?i.children:i},create_node:function(e,t,n,i,r){if(e===null){e="#"}e=this.get_node(e);if(!e){return false}n=n===x?"last":n;if(!n.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(e)){return this.load_node(e,function(){this.create_node(e,t,n,i,true)})}if(!t){t={text:this.get_string("New node")}}if(typeof t==="string"){t={text:t}}if(t.text===x){t.text=this.get_string("New node")}var s,o,a,l;if(e.id==="#"){if(n==="before"){n="first"}if(n==="after"){n="last"}}switch(n){case"before":s=this.get_node(e.parent);n=C.inArray(e.id,s.children);e=s;break;case"after":s=this.get_node(e.parent);n=C.inArray(e.id,s.children)+1;e=s;break;case"inside":case"first":n=0;break;case"last":n=e.children.length;break;default:if(!n){n=0}break}if(n>e.children.length){n=e.children.length}if(!t.id){t.id=true}if(!this.check("create_node",t,e,n)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(t.id===true){delete t.id}t=this._parse_model_from_json(t,e.id,e.parents.concat());if(!t){return false}s=this.get_node(t);o=[];o.push(t);o=o.concat(s.children_d);this.trigger("model",{nodes:o,parent:e.id});e.children_d=e.children_d.concat(o);for(a=0,l=e.parents.length;a<l;a++){this._model.data[e.parents[a]].children_d=this._model.data[e.parents[a]].children_d.concat(o)}t=s;s=[];for(a=0,l=e.children.length;a<l;a++){s[a>=n?a+1:a]=e.children[a]}s[n]=t.id;e.children=s;this.redraw_node(e,true);if(i){i.call(this,this.get_node(t))}this.trigger("create_node",{node:this.get_node(t),parent:e.id,position:n});return t.id},rename_node:function(e,t){var n,i,r;if(C.isArray(e)){e=e.slice();for(n=0,i=e.length;n<i;n++){this.rename_node(e[n],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}r=e.text;if(!this.check("rename_node",e,this.get_parent(e),t)){this.settings.core.error.call(this,this._data.core.last_error);return false}this.set_text(e,t);this.trigger("rename_node",{node:e,text:t,old:r});return true},delete_node:function(e){var t,n,i,r,s,o,a,l,c,d;if(C.isArray(e)){e=e.slice();for(t=0,n=e.length;t<n;t++){this.delete_node(e[t])}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}i=this.get_node(e.parent);r=C.inArray(e.id,i.children);d=false;if(!this.check("delete_node",e,i,r)){this.settings.core.error.call(this,this._data.core.last_error);return false}if(r!==-1){i.children=C.vakata.array_remove(i.children,r)}s=e.children_d.concat([]);s.push(e.id);for(l=0,c=s.length;l<c;l++){for(o=0,a=e.parents.length;o<a;o++){r=C.inArray(s[l],this._model.data[e.parents[o]].children_d);if(r!==-1){this._model.data[e.parents[o]].children_d=C.vakata.array_remove(this._model.data[e.parents[o]].children_d,r)}}if(this._model.data[s[l]].state.selected){d=true;r=C.inArray(s[l],this._data.core.selected);if(r!==-1){this._data.core.selected=C.vakata.array_remove(this._data.core.selected,r)}}}this.trigger("delete_node",{node:e,parent:i.id});if(d){this.trigger("changed",{action:"delete_node",node:e,selected:this._data.core.selected,parent:i.id})}for(l=0,c=s.length;l<c;l++){delete this._model.data[s[l]]}this.redraw_node(i,true);return true},check:function(e,t,n,i,r){t=t&&t.id?t:this.get_node(t);n=n&&n.id?n:this.get_node(n);var s=e.match(/^move_node|copy_node|create_node$/i)?n:t,o=this.settings.core.check_callback;if(e==="move_node"||e==="copy_node"){if((!r||!r.is_multi)&&(t.id===n.id||C.inArray(t.id,n.children)===i||C.inArray(n.id,t.children_d)!==-1)){this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})};return false}}if(s&&s.data){s=s.data}if(s&&s.functions&&(s.functions[e]===false||s.functions[e]===true)){if(s.functions[e]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})}}return s.functions[e]}if(o===false||C.isFunction(o)&&o.call(this,e,t,n,i,r)===false||o&&o[e]===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})};return false}return true},last_error:function(){return this._data.core.last_error},move_node:function(e,t,n,i,r,s,o){var a,l,c,d,h,u,f,p,g,_,m,v,y,b;t=this.get_node(t);n=n===x?0:n;if(!t){return false}if(!n.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(t)){return this.load_node(t,function(){this.move_node(e,t,n,i,true,false,o)})}if(C.isArray(e)){if(e.length===1){e=e[0]}else{for(a=0,l=e.length;a<l;a++){if(g=this.move_node(e[a],t,n,i,r,false,o)){t=g;n="after"}}this.redraw();return true}}e=e&&e.id?e:this.get_node(e);if(!e||e.id==="#"){return false}c=(e.parent||"#").toString();h=!n.toString().match(/^(before|after)$/)||t.id==="#"?t:this.get_node(t.parent);u=o?o:this._model.data[e.id]?this:C.jstree.reference(e.id);f=!u||!u._id||this._id!==u._id;d=u&&u._id&&c&&u._model.data[c]&&u._model.data[c].children?C.inArray(e.id,u._model.data[c].children):-1;if(u&&u._id){e=u._model.data[e.id]}if(f){if(g=this.copy_node(e,t,n,i,r,false,o)){if(u){u.delete_node(e)}return g}return false}if(t.id==="#"){if(n==="before"){n="first"}if(n==="after"){n="last"}}switch(n){case"before":n=C.inArray(t.id,h.children);break;case"after":n=C.inArray(t.id,h.children)+1;break;case"inside":case"first":n=0;break;case"last":n=h.children.length;break;default:if(!n){n=0}break}if(n>h.children.length){n=h.children.length}if(!this.check("move_node",e,h,n,{core:true,origin:o,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id})){this.settings.core.error.call(this,this._data.core.last_error);return false}if(e.parent===h.id){p=h.children.concat();g=C.inArray(e.id,p);if(g!==-1){p=C.vakata.array_remove(p,g);if(n>g){n--}}g=[];for(_=0,m=p.length;_<m;_++){g[_>=n?_+1:_]=p[_]}g[n]=e.id;h.children=g;this._node_changed(h.id);this.redraw(h.id==="#")}else{g=e.children_d.concat();g.push(e.id);for(_=0,m=e.parents.length;_<m;_++){p=[];b=u._model.data[e.parents[_]].children_d;for(v=0,y=b.length;v<y;v++){if(C.inArray(b[v],g)===-1){p.push(b[v])}}u._model.data[e.parents[_]].children_d=p}u._model.data[c].children=C.vakata.array_remove_item(u._model.data[c].children,e.id);for(_=0,m=h.parents.length;_<m;_++){this._model.data[h.parents[_]].children_d=this._model.data[h.parents[_]].children_d.concat(g)}p=[];for(_=0,m=h.children.length;_<m;_++){p[_>=n?_+1:_]=h.children[_]}p[n]=e.id;h.children=p;h.children_d.push(e.id);h.children_d=h.children_d.concat(e.children_d);e.parent=h.id;g=h.parents.concat();g.unshift(h.id);b=e.parents.length;e.parents=g;g=g.concat();for(_=0,m=e.children_d.length;_<m;_++){this._model.data[e.children_d[_]].parents=this._model.data[e.children_d[_]].parents.slice(0,b*-1);Array.prototype.push.apply(this._model.data[e.children_d[_]].parents,g)}if(c==="#"||h.id==="#"){this._model.force_full_redraw=true}if(!this._model.force_full_redraw){this._node_changed(c);this._node_changed(h.id)}if(!s){this.redraw()}}if(i){i.call(this,e,h,n)}this.trigger("move_node",{node:e,parent:h.id,position:n,old_parent:c,old_position:d,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id,old_instance:u,new_instance:this});return e.id},copy_node:function(e,t,n,i,r,s,o){var a,l,c,d,h,u,f,p,g,_,m;t=this.get_node(t);n=n===x?0:n;if(!t){return false}if(!n.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(t)){return this.load_node(t,function(){this.copy_node(e,t,n,i,true,false,o)})}if(C.isArray(e)){if(e.length===1){e=e[0]}else{for(a=0,l=e.length;a<l;a++){if(d=this.copy_node(e[a],t,n,i,r,true,o)){t=d;n="after"}}this.redraw();return true}}e=e&&e.id?e:this.get_node(e);if(!e||e.id==="#"){return false}p=(e.parent||"#").toString();g=!n.toString().match(/^(before|after)$/)||t.id==="#"?t:this.get_node(t.parent);_=o?o:this._model.data[e.id]?this:C.jstree.reference(e.id);m=!_||!_._id||this._id!==_._id;if(_&&_._id){e=_._model.data[e.id]}if(t.id==="#"){if(n==="before"){n="first"}if(n==="after"){n="last"}}switch(n){case"before":n=C.inArray(t.id,g.children);break;case"after":n=C.inArray(t.id,g.children)+1;break;case"inside":case"first":n=0;break;case"last":n=g.children.length;break;default:if(!n){n=0}break}if(n>g.children.length){n=g.children.length}if(!this.check("copy_node",e,g,n,{core:true,origin:o,is_multi:_&&_._id&&_._id!==this._id,is_foreign:!_||!_._id})){this.settings.core.error.call(this,this._data.core.last_error);return false}f=_?_.get_json(e,{no_id:true,no_data:true,no_state:true}):e;if(!f){return false}if(f.id===true){delete f.id}f=this._parse_model_from_json(f,g.id,g.parents.concat());if(!f){return false}d=this.get_node(f);if(e&&e.state&&e.state.loaded===false){d.state.loaded=false}c=[];c.push(f);c=c.concat(d.children_d);this.trigger("model",{nodes:c,parent:g.id});for(h=0,u=g.parents.length;h<u;h++){this._model.data[g.parents[h]].children_d=this._model.data[g.parents[h]].children_d.concat(c)}c=[];for(h=0,u=g.children.length;h<u;h++){c[h>=n?h+1:h]=g.children[h]}c[n]=d.id;g.children=c;g.children_d.push(d.id);g.children_d=g.children_d.concat(d.children_d);if(g.id==="#"){this._model.force_full_redraw=true}if(!this._model.force_full_redraw){this._node_changed(g.id)}if(!s){this.redraw(g.id==="#")}if(i){i.call(this,d,g,n)}this.trigger("copy_node",{node:d,original:e,parent:g.id,position:n,old_parent:p,old_position:_&&_._id&&p&&_._model.data[p]&&_._model.data[p].children?C.inArray(e.id,_._model.data[p].children):-1,is_multi:_&&_._id&&_._id!==this._id,is_foreign:!_||!_._id,old_instance:_,new_instance:this});return d.id},cut:function(e){if(!e){e=this._data.core.selected.concat()}if(!C.isArray(e)){e=[e]}if(!e.length){return false}var t=[],n,i,r;for(i=0,r=e.length;i<r;i++){n=this.get_node(e[i]);if(n&&n.id&&n.id!=="#"){t.push(n)}}if(!t.length){return false}s=t;a=this;o="move_node";this.trigger("cut",{node:e})},copy:function(e){if(!e){e=this._data.core.selected.concat()}if(!C.isArray(e)){e=[e]}if(!e.length){return false}var t=[],n,i,r;for(i=0,r=e.length;i<r;i++){n=this.get_node(e[i]);if(n&&n.id&&n.id!=="#"){t.push(n)}}if(!t.length){return false}s=t;a=this;o="copy_node";this.trigger("copy",{node:e})},get_buffer:function(){return{mode:o,node:s,inst:a}},can_paste:function(){return o!==false&&s!==false},paste:function(e,t){e=this.get_node(e);if(!e||!o||!o.match(/^(copy_node|move_node)$/)||!s){return false}if(this[o](s,e,t,false,false,false,a)){this.trigger("paste",{parent:e.id,node:s,mode:o})}s=false;o=false;a=false},clear_buffer:function(){s=false;o=false;a=false;this.trigger("clear_buffer")},edit:function(r,e,s){var t,n,o,a,l,c,i,d,h;r=this.get_node(r);if(!r){return false}if(this.settings.core.check_callback===false){this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"};this.settings.core.error.call(this,this._data.core.last_error);return false}h=r;e=typeof e==="string"?e:r.text;this.set_text(r,"");r=this._open_to(r);h.text=e;t=this._data.core.rtl;n=this.element.width();o=r.children(".jstree-anchor");a=C("<span>");l=e;c=C("<"+"div />",{css:{position:"absolute",top:"-200px",left:t?"0px":"-1000px",visibility:"hidden"}}).appendTo("body");i=C("<"+"input />",{value:l,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:C.proxy(function(){var e=a.children(".jstree-rename-input"),t=e.val(),n=this.settings.core.force_text,i;if(t===""){t=l}c.remove();a.replaceWith(o);a.remove();l=n?l:C("<div></div>").append(C.parseHTML(l)).html();this.set_text(r,l);i=!!this.rename_node(r,n?C("<div></div>").text(t).text():C("<div></div>").append(C.parseHTML(t)).html());if(!i){this.set_text(r,l)}if(s){s.call(this,h,i)}},this),keydown:function(e){var t=e.which;if(t===27){this.value=l}if(t===27||t===13||t===37||t===38||t===39||t===40||t===32){e.stopImmediatePropagation()}if(t===27||t===13){e.preventDefault();this.blur()}},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){i.width(Math.min(c.text("pW"+this.value).width(),n))},keypress:function(e){if(e.which===13){return false}}});d={fontFamily:o.css("fontFamily")||"",fontSize:o.css("fontSize")||"",fontWeight:o.css("fontWeight")||"",fontStyle:o.css("fontStyle")||"",fontStretch:o.css("fontStretch")||"",fontVariant:o.css("fontVariant")||"",letterSpacing:o.css("letterSpacing")||"",wordSpacing:o.css("wordSpacing")||""};a.attr("class",o.attr("class")).append(o.contents().clone()).append(i);o.replaceWith(a);c.css(d);i.css(d).width(Math.min(c.text("pW"+i[0].value).width(),n))[0].select()},set_theme:function(e,t){if(!e){return false}if(t===true){var n=this.settings.core.themes.dir;if(!n){n=C.jstree.path+"/themes"}t=n+"/"+e+"/style.css"}if(t&&C.inArray(t,i)===-1){C("head").append("<"+'link rel="stylesheet" href="'+t+'" type="text/css" />');i.push(t)}if(this._data.core.themes.name){this.element.removeClass("jstree-"+this._data.core.themes.name)}this._data.core.themes.name=e;this.element.addClass("jstree-"+e);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+e+"-responsive");this.trigger("set_theme",{theme:e})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){if(this._data.core.themes.variant){this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}this._data.core.themes.variant=e;if(e){this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)}},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=true;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=false;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){if(this._data.core.themes.stripes){this.hide_stripes()}else{this.show_stripes()}},show_dots:function(){this._data.core.themes.dots=true;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=false;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){if(this._data.core.themes.dots){this.hide_dots()}else{this.show_dots()}},show_icons:function(){this._data.core.themes.icons=true;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=false;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){if(this._data.core.themes.icons){this.hide_icons()}else{this.show_icons()}},set_icon:function(e,t){var n,i,r,s;if(C.isArray(e)){e=e.slice();for(n=0,i=e.length;n<i;n++){this.set_icon(e[n],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}s=e.icon;e.icon=t===true||t===null||t===x||t===""?true:t;r=this.get_node(e,true).children(".jstree-anchor").children(".jstree-themeicon");if(t===false){this.hide_icon(e)}else if(t===true||t===null||t===x||t===""){r.removeClass("jstree-themeicon-custom "+s).css("background","").removeAttr("rel");if(s===false){this.show_icon(e)}}else if(t.indexOf("/")===-1&&t.indexOf(".")===-1){r.removeClass(s).css("background","");r.addClass(t+" jstree-themeicon-custom").attr("rel",t);if(s===false){this.show_icon(e)}}else{r.removeClass(s).css("background","");r.addClass("jstree-themeicon-custom").css("background","url('"+t+"') center center no-repeat").attr("rel",t);if(s===false){this.show_icon(e)}}return true},get_icon:function(e){e=this.get_node(e);return!e||e.id==="#"?false:e.icon},hide_icon:function(e){var t,n;if(C.isArray(e)){e=e.slice();for(t=0,n=e.length;t<n;t++){this.hide_icon(e[t])}return true}e=this.get_node(e);if(!e||e==="#"){return false}e.icon=false;this.get_node(e,true).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return true},show_icon:function(e){var t,n,i;if(C.isArray(e)){e=e.slice();for(t=0,n=e.length;t<n;t++){this.show_icon(e[t])}return true}e=this.get_node(e);if(!e||e==="#"){return false}i=this.get_node(e,true);e.icon=i.length?i.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):true;if(!e.icon){e.icon=true}i.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return true}},C.vakata={},C.vakata.attributes=function(e,n){e=C(e)[0];var i=n?{}:[];if(e&&e.attributes){C.each(e.attributes,function(e,t){if(C.inArray(t.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1){return}if(t.value!==null&&C.trim(t.value)!==""){if(n){i[t.name]=t.value}else{i.push(t.name)}}})}return i},C.vakata.array_unique=function(e){var t=[],n,i,r,s={};for(n=0,r=e.length;n<r;n++){if(s[e[n]]===x){t.push(e[n]);s[e[n]]=true}}return t},C.vakata.array_remove=function(e,t,n){var i=e.slice((n||t)+1||e.length);e.length=t<0?e.length+t:t;e.push.apply(e,i);return e},C.vakata.array_remove_item=function(e,t){var n=C.inArray(t,e);return n!==-1?C.vakata.array_remove(e,n):e};var c=y.createElement("I");c.className="jstree-icon jstree-checkbox",c.setAttribute("role","presentation"),C.jstree.defaults.checkbox={visible:true,three_state:true,whole_node:true,keep_selected_style:true,cascade:"",tie_selection:true},C.jstree.plugins.checkbox=function(e,l){this.bind=function(){l.bind.call(this);this._data.checkbox.uto=false;this._data.checkbox.selected=[];if(this.settings.checkbox.three_state){this.settings.checkbox.cascade="up+down+undetermined"}this.element.on("init.jstree",C.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;if(!this.settings.checkbox.keep_selected_style){this.element.addClass("jstree-checkbox-no-clicked")}if(this.settings.checkbox.tie_selection){this.element.addClass("jstree-checkbox-selection")}},this)).on("loading.jstree",C.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1){this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",C.proxy(function(){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(C.proxy(this._undetermined,this),50)},this))}if(!this.settings.checkbox.tie_selection){this.element.on("model.jstree",C.proxy(function(e,t){var n=this._model.data,i=n[t.parent],r=t.nodes,s,o;for(s=0,o=r.length;s<o;s++){n[r[s]].state.checked=n[r[s]].original&&n[r[s]].original.state&&n[r[s]].original.state.checked;if(n[r[s]].state.checked){this._data.checkbox.selected.push(r[s])}}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1){this.element.on("model.jstree",C.proxy(function(e,t){var n=this._model.data,i=n[t.parent],r=t.nodes,s=[],o,a,l,c,d,h,u=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection;if(u.indexOf("down")!==-1){if(i.state[f?"selected":"checked"]){for(a=0,l=r.length;a<l;a++){n[r[a]].state[f?"selected":"checked"]=true}this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(r)}else{for(a=0,l=r.length;a<l;a++){if(n[r[a]].state[f?"selected":"checked"]){for(c=0,d=n[r[a]].children_d.length;c<d;c++){n[n[r[a]].children_d[c]].state[f?"selected":"checked"]=true}this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(n[r[a]].children_d)}}}}if(u.indexOf("up")!==-1){for(a=0,l=i.children_d.length;a<l;a++){if(!n[i.children_d[a]].children.length){s.push(n[i.children_d[a]].parent)}}s=C.vakata.array_unique(s);for(c=0,d=s.length;c<d;c++){i=n[s[c]];while(i&&i.id!=="#"){o=0;for(a=0,l=i.children.length;a<l;a++){o+=n[i.children[a]].state[f?"selected":"checked"]}if(o===l){i.state[f?"selected":"checked"]=true;this._data[f?"core":"checkbox"].selected.push(i.id);h=this.get_node(i,true);if(h&&h.length){h.attr("aria-selected",true).children(".jstree-anchor").addClass(f?"jstree-clicked":"jstree-checked")}}else{break}i=this.get_node(i.parent)}}}this._data[f?"core":"checkbox"].selected=C.vakata.array_unique(this._data[f?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",C.proxy(function(e,t){var n=t.node,i=this._model.data,r=this.get_node(n.parent),s=this.get_node(n,true),o,a,l,c,d=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;if(d.indexOf("down")!==-1){this._data[h?"core":"checkbox"].selected=C.vakata.array_unique(this._data[h?"core":"checkbox"].selected.concat(n.children_d));for(o=0,a=n.children_d.length;o<a;o++){c=i[n.children_d[o]];c.state[h?"selected":"checked"]=true;if(c&&c.original&&c.original.state&&c.original.state.undetermined){c.original.state.undetermined=false}}}if(d.indexOf("up")!==-1){while(r&&r.id!=="#"){l=0;for(o=0,a=r.children.length;o<a;o++){l+=i[r.children[o]].state[h?"selected":"checked"]}if(l===a){r.state[h?"selected":"checked"]=true;this._data[h?"core":"checkbox"].selected.push(r.id);c=this.get_node(r,true);if(c&&c.length){c.attr("aria-selected",true).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}}else{break}r=this.get_node(r.parent)}}if(d.indexOf("down")!==-1&&s.length){s.find(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",true)}},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",C.proxy(function(e,t){var n=this.get_node("#"),i=this._model.data,r,s,o;for(r=0,s=n.children_d.length;r<s;r++){o=i[n.children_d[r]];if(o&&o.original&&o.original.state&&o.original.state.undetermined){o.original.state.undetermined=false}}},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",C.proxy(function(e,t){var n=t.node,i=this.get_node(n,true),r,s,o,a=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection;if(n&&n.original&&n.original.state&&n.original.state.undetermined){n.original.state.undetermined=false}if(a.indexOf("down")!==-1){for(r=0,s=n.children_d.length;r<s;r++){o=this._model.data[n.children_d[r]];o.state[l?"selected":"checked"]=false;if(o&&o.original&&o.original.state&&o.original.state.undetermined){o.original.state.undetermined=false}}}if(a.indexOf("up")!==-1){for(r=0,s=n.parents.length;r<s;r++){o=this._model.data[n.parents[r]];o.state[l?"selected":"checked"]=false;if(o&&o.original&&o.original.state&&o.original.state.undetermined){o.original.state.undetermined=false}o=this.get_node(n.parents[r],true);if(o&&o.length){o.attr("aria-selected",false).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked")}}}o=[];for(r=0,s=this._data[l?"core":"checkbox"].selected.length;r<s;r++){if((a.indexOf("down")===-1||C.inArray(this._data[l?"core":"checkbox"].selected[r],n.children_d)===-1)&&(a.indexOf("up")===-1||C.inArray(this._data[l?"core":"checkbox"].selected[r],n.parents)===-1)){o.push(this._data[l?"core":"checkbox"].selected[r])}}this._data[l?"core":"checkbox"].selected=C.vakata.array_unique(o);if(a.indexOf("down")!==-1&&i.length){i.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",false)}},this))}if(this.settings.checkbox.cascade.indexOf("up")!==-1){this.element.on("delete_node.jstree",C.proxy(function(e,t){var n=this.get_node(t.parent),i=this._model.data,r,s,o,a,l=this.settings.checkbox.tie_selection;while(n&&n.id!=="#"){o=0;for(r=0,s=n.children.length;r<s;r++){o+=i[n.children[r]].state[l?"selected":"checked"]}if(o===s){n.state[l?"selected":"checked"]=true;this._data[l?"core":"checkbox"].selected.push(n.id);a=this.get_node(n,true);if(a&&a.length){a.attr("aria-selected",true).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked")}}else{break}n=this.get_node(n.parent)}},this)).on("move_node.jstree",C.proxy(function(e,t){var n=t.is_multi,i=t.old_parent,r=this.get_node(t.parent),s=this._model.data,o,a,l,c,d,h=this.settings.checkbox.tie_selection;if(!n){o=this.get_node(i);while(o&&o.id!=="#"){a=0;for(l=0,c=o.children.length;l<c;l++){a+=s[o.children[l]].state[h?"selected":"checked"]}if(a===c){o.state[h?"selected":"checked"]=true;this._data[h?"core":"checkbox"].selected.push(o.id);d=this.get_node(o,true);if(d&&d.length){d.attr("aria-selected",true).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}}else{break}o=this.get_node(o.parent)}}o=r;while(o&&o.id!=="#"){a=0;for(l=0,c=o.children.length;l<c;l++){a+=s[o.children[l]].state[h?"selected":"checked"]}if(a===c){if(!o.state[h?"selected":"checked"]){o.state[h?"selected":"checked"]=true;this._data[h?"core":"checkbox"].selected.push(o.id);d=this.get_node(o,true);if(d&&d.length){d.attr("aria-selected",true).children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")}}}else{if(o.state[h?"selected":"checked"]){o.state[h?"selected":"checked"]=false;this._data[h?"core":"checkbox"].selected=C.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,o.id);d=this.get_node(o,true);if(d&&d.length){d.attr("aria-selected",false).children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked")}}else{break}}o=this.get_node(o.parent)}},this))}};this._undetermined=function(){if(this.element===null){return}var n,i,r,s,o={},a=this._model.data,e=this.settings.checkbox.tie_selection,t=this._data[e?"core":"checkbox"].selected,l=[],c=this;for(n=0,i=t.length;n<i;n++){if(a[t[n]]&&a[t[n]].parents){for(r=0,s=a[t[n]].parents.length;r<s;r++){if(o[a[t[n]].parents[r]]===x&&a[t[n]].parents[r]!=="#"){o[a[t[n]].parents[r]]=true;l.push(a[t[n]].parents[r])}}}}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e=c.get_node(this),t;if(!e.state.loaded){if(e.original&&e.original.state&&e.original.state.undetermined&&e.original.state.undetermined===true){if(o[e.id]===x&&e.id!=="#"){o[e.id]=true;l.push(e.id)}for(r=0,s=e.parents.length;r<s;r++){if(o[e.parents[r]]===x&&e.parents[r]!=="#"){o[e.parents[r]]=true;l.push(e.parents[r])}}}}else{for(n=0,i=e.children_d.length;n<i;n++){t=a[e.children_d[n]];if(!t.state.loaded&&t.original&&t.original.state&&t.original.state.undetermined&&t.original.state.undetermined===true){if(o[t.id]===x&&t.id!=="#"){o[t.id]=true;l.push(t.id)}for(r=0,s=t.parents.length;r<s;r++){if(o[t.parents[r]]===x&&t.parents[r]!=="#"){o[t.parents[r]]=true;l.push(t.parents[r])}}}}}});this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(n=0,i=l.length;n<i;n++){if(!a[l[n]].state[e?"selected":"checked"]){t=this.get_node(l[n],true);if(t&&t.length){t.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}}}};this.redraw_node=function(e,t,n,i){e=l.redraw_node.apply(this,arguments);if(e){var r,s,o=null;for(r=0,s=e.childNodes.length;r<s;r++){if(e.childNodes[r]&&e.childNodes[r].className&&e.childNodes[r].className.indexOf("jstree-anchor")!==-1){o=e.childNodes[r];break}}if(o){if(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked){o.className+=" jstree-checked"}o.insertBefore(c.cloneNode(false),o.childNodes[0])}}if(!n&&this.settings.checkbox.cascade.indexOf("undetermined")!==-1){if(this._data.checkbox.uto){clearTimeout(this._data.checkbox.uto)}this._data.checkbox.uto=setTimeout(C.proxy(this._undetermined,this),50)}return e};this.show_checkboxes=function(){this._data.core.themes.checkboxes=true;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=false;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){if(this._data.core.themes.checkboxes){this.hide_checkboxes()}else{this.show_checkboxes()}};this.is_undetermined=function(e){e=this.get_node(e);var t=this.settings.checkbox.cascade,n,i,r=this.settings.checkbox.tie_selection,s=this._data[r?"core":"checkbox"].selected,o=this._model.data;if(!e||e.state[r?"selected":"checked"]===true||t.indexOf("undetermined")===-1||t.indexOf("down")===-1&&t.indexOf("up")===-1){return false}if(!e.state.loaded&&e.original.state.undetermined===true){return true}for(n=0,i=e.children_d.length;n<i;n++){if(C.inArray(e.children_d[n],s)!==-1||!o[e.children_d[n]].state.loaded&&o[e.children_d[n]].original.state.undetermined){return true}}return false};this.activate_node=function(e,t){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||C(t.target).hasClass("jstree-checkbox"))){t.ctrlKey=true}if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!C(t.target).hasClass("jstree-checkbox")){return l.activate_node.call(this,e,t)}if(this.is_disabled(e)){return false}if(this.is_checked(e)){this.uncheck_node(e,t)}else{this.check_node(e,t)}this.trigger("activate_node",{node:this.get_node(e)})};this.check_node=function(e,t){if(this.settings.checkbox.tie_selection){return this.select_node(e,false,true,t)}var n,i,r,s;if(C.isArray(e)){e=e.slice();for(i=0,r=e.length;i<r;i++){this.check_node(e[i],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}n=this.get_node(e,true);if(!e.state.checked){e.state.checked=true;this._data.checkbox.selected.push(e.id);if(n&&n.length){n.children(".jstree-anchor").addClass("jstree-checked")}this.trigger("check_node",{node:e,selected:this._data.checkbox.selected,event:t})}};this.uncheck_node=function(e,t){if(this.settings.checkbox.tie_selection){return this.deselect_node(e,false,t)}var n,i,r;if(C.isArray(e)){e=e.slice();for(n=0,i=e.length;n<i;n++){this.uncheck_node(e[n],t)}return true}e=this.get_node(e);if(!e||e.id==="#"){return false}r=this.get_node(e,true);if(e.state.checked){e.state.checked=false;this._data.checkbox.selected=C.vakata.array_remove_item(this._data.checkbox.selected,e.id);if(r.length){r.children(".jstree-anchor").removeClass("jstree-checked")}this.trigger("uncheck_node",{node:e,selected:this._data.checkbox.selected,event:t})}};this.check_all=function(){if(this.settings.checkbox.tie_selection){return this.select_all()}var e=this._data.checkbox.selected.concat([]),t,n;this._data.checkbox.selected=this._model.data["#"].children_d.concat();for(t=0,n=this._data.checkbox.selected.length;t<n;t++){if(this._model.data[this._data.checkbox.selected[t]]){this._model.data[this._data.checkbox.selected[t]].state.checked=true}}this.redraw(true);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection){return this.deselect_all()}var e=this._data.checkbox.selected.concat([]),t,n;for(t=0,n=this._data.checkbox.selected.length;t<n;t++){if(this._model.data[this._data.checkbox.selected[t]]){this._model.data[this._data.checkbox.selected[t]].state.checked=false}}this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:e})};this.is_checked=function(e){if(this.settings.checkbox.tie_selection){return this.is_selected(e)}e=this.get_node(e);if(!e||e.id==="#"){return false}return e.state.checked};this.get_checked=function(e){if(this.settings.checkbox.tie_selection){return this.get_selected(e)}return e?C.map(this._data.checkbox.selected,C.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected};this.get_top_checked=function(e){if(this.settings.checkbox.tie_selection){return this.get_top_selected(e)}var t=this.get_checked(true),n={},i,r,s,o;for(i=0,r=t.length;i<r;i++){n[t[i].id]=t[i]}for(i=0,r=t.length;i<r;i++){for(s=0,o=t[i].children_d.length;s<o;s++){if(n[t[i].children_d[s]]){delete n[t[i].children_d[s]]}}}t=[];for(i in n){if(n.hasOwnProperty(i)){t.push(i)}}return e?C.map(t,C.proxy(function(e){return this.get_node(e)},this)):t};this.get_bottom_checked=function(e){if(this.settings.checkbox.tie_selection){return this.get_bottom_selected(e)}var t=this.get_checked(true),n=[],i,r;for(i=0,r=t.length;i<r;i++){if(!t[i].children.length){n.push(t[i].id)}}return e?C.map(n,C.proxy(function(e){return this.get_node(e)},this)):n};this.load_node=function(e,t){var n,i,r,s,o,a;if(!C.isArray(e)&&!this.settings.checkbox.tie_selection){a=this.get_node(e);if(a&&a.state.loaded){for(n=0,i=a.children_d.length;n<i;n++){if(this._model.data[a.children_d[n]].state.checked){o=true;this._data.checkbox.selected=C.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[n])}}}}return l.load_node.apply(this,arguments)};this.get_state=function(){var e=l.get_state.apply(this,arguments);if(this.settings.checkbox.tie_selection){return e}e.checkbox=this._data.checkbox.selected.slice();return e};this.set_state=function(e,t){var n=l.set_state.apply(this,arguments);if(n&&e.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var i=this;C.each(e.checkbox,function(e,t){i.check_node(t)})}delete e.checkbox;this.set_state(e,t);return false}return n}},C.jstree.defaults.contextmenu={select_node:true,show_at_node:true,items:function(e,t){return{create:{separator_before:false,separator_after:true,_disabled:false,label:"Create",action:function(e){var t=C.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},rename:{separator_before:false,separator_after:false,_disabled:false,label:"Rename",action:function(e){var t=C.jstree.reference(e.reference),n=t.get_node(e.reference);t.edit(n)}},remove:{separator_before:false,icon:false,separator_after:false,_disabled:false,label:"Delete",action:function(e){var t=C.jstree.reference(e.reference),n=t.get_node(e.reference);if(t.is_selected(n)){t.delete_node(t.get_selected())}else{t.delete_node(n)}}},ccp:{separator_before:true,icon:false,separator_after:false,label:"Edit",action:false,submenu:{cut:{separator_before:false,separator_after:false,label:"Cut",action:function(e){var t=C.jstree.reference(e.reference),n=t.get_node(e.reference);if(t.is_selected(n)){t.cut(t.get_top_selected())}else{t.cut(n)}}},copy:{separator_before:false,icon:false,separator_after:false,label:"Copy",action:function(e){var t=C.jstree.reference(e.reference),n=t.get_node(e.reference);if(t.is_selected(n)){t.copy(t.get_top_selected())}else{t.copy(n)}}},paste:{separator_before:false,icon:false,_disabled:function(e){return!C.jstree.reference(e.reference).can_paste()},separator_after:false,label:"Paste",action:function(e){var t=C.jstree.reference(e.reference),n=t.get_node(e.reference);t.paste(n)}}}}}}},C.jstree.plugins.contextmenu=function(e,s){this.bind=function(){s.bind.call(this);var n=0,i=null,t,r;this.element.on("contextmenu.jstree",".jstree-anchor",C.proxy(function(e,t){e.preventDefault();n=e.ctrlKey?+new Date:0;if(t||i){n=+new Date+1e4}if(i){clearTimeout(i)}if(!this.is_loading(e.currentTarget)){this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)}},this)).on("click.jstree",".jstree-anchor",C.proxy(function(e){if(this._data.contextmenu.visible&&(!n||+new Date-n>250)){C.vakata.context.hide()}n=0},this)).on("touchstart.jstree",".jstree-anchor",function(e){if(!e.originalEvent||!e.originalEvent.changedTouches||!e.originalEvent.changedTouches[0]){return}t=e.pageX;r=e.pageY;i=setTimeout(function(){C(e.currentTarget).trigger("contextmenu",true)},750)}).on("touchmove.vakata.jstree",function(e){if(i&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(r-e.pageY)>50)){clearTimeout(i)}}).on("touchend.vakata.jstree",function(e){if(i){clearTimeout(i)}});C(y).on("context_hide.vakata.jstree",C.proxy(function(){this._data.contextmenu.visible=false},this))};this.teardown=function(){if(this._data.contextmenu.visible){C.vakata.context.hide()}s.teardown.call(this)};this.show_contextmenu=function(t,n,i,e){t=this.get_node(t);if(!t||t.id==="#"){return false}var r=this.settings.contextmenu,s=this.get_node(t,true),o=s.children(".jstree-anchor"),a=false,l=false;if(r.show_at_node||n===x||i===x){a=o.offset();n=a.left;i=a.top+this._data.core.li_height}if(this.settings.contextmenu.select_node&&!this.is_selected(t)){this.activate_node(t,e)}l=r.items;if(C.isFunction(l)){l=l.call(this,t,C.proxy(function(e){this._show_contextmenu(t,n,i,e)},this))}if(C.isPlainObject(l)){this._show_contextmenu(t,n,i,l)}};this._show_contextmenu=function(e,t,n,i){var r=this.get_node(e,true),s=r.children(".jstree-anchor");C(y).one("context_show.vakata.jstree",C.proxy(function(e,t){var n="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";C(t.element).addClass(n)},this));this._data.contextmenu.visible=true;C.vakata.context.show(s,{x:t,y:n},i);this.trigger("show_contextmenu",{node:e,x:t,y:n})}},function(u){var f=false,p={element:false,reference:false,position_x:0,position_y:0,items:[],html:"",is_visible:false};u.vakata.context={settings:{hide_onmouseleave:0,icons:true},_trigger:function(e){u(y).triggerHandler("context_"+e+".vakata",{reference:p.reference,element:p.element,position:{x:p.position_x,y:p.position_y}})},_execute:function(e){e=p.items[e];return e&&(!e._disabled||u.isFunction(e._disabled)&&!e._disabled({item:e,reference:p.reference,element:p.element}))&&e.action?e.action.call(null,{item:e,reference:p.reference,element:p.element,position:{x:p.position_x,y:p.position_y}}):false},_parse:function(e,t){if(!e){return false}if(!t){p.html="";p.items=[]}var n="",i=false,r;if(t){n+="<"+"ul>"}u.each(e,function(e,t){if(!t){return true}p.items.push(t);if(!i&&t.separator_before){n+="<"+"li class='vakata-context-separator'><"+"a href='#' "+(u.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>"}i=false;n+="<"+"li class='"+(t._class||"")+(t._disabled===true||u.isFunction(t._disabled)&&t._disabled({item:t,reference:p.reference,element:p.element})?" vakata-contextmenu-disabled ":"")+"' "+(t.shortcut?" data-shortcut='"+t.shortcut+"' ":"")+">";n+="<"+"a href='#' rel='"+(p.items.length-1)+"'>";if(u.vakata.context.settings.icons){n+="<"+"i ";if(t.icon){if(t.icon.indexOf("/")!==-1||t.icon.indexOf(".")!==-1){n+=" style='background:url(\""+t.icon+"\") center center no-repeat' "}else{n+=" class='"+t.icon+"' "}}n+="><"+"/i><"+"span class='vakata-contextmenu-sep'>&#160;<"+"/span>"}n+=(u.isFunction(t.label)?t.label({item:e,reference:p.reference,element:p.element}):t.label)+(t.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+t.shortcut+'">'+(t.shortcut_label||"")+"</span>":"")+"<"+"/a>";if(t.submenu){r=u.vakata.context._parse(t.submenu,true);if(r){n+=r}}n+="<"+"/li>";if(t.separator_after){n+="<"+"li class='vakata-context-separator'><"+"a href='#' "+(u.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<"+"/a><"+"/li>";i=true}});n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");if(t){n+="</ul>"}if(!t){p.html=n;u.vakata.context._trigger("parse")}return n.length>10?n:false},_show_submenu:function(e){e=u(e);if(!e.length||!e.children("ul").length){return}var t=e.children("ul"),n=e.offset().left+e.outerWidth(),i=e.offset().top,r=t.width(),s=t.height(),o=u(window).width()+u(window).scrollLeft(),a=u(window).height()+u(window).scrollTop();if(f){e[n-(r+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left")}else{e[n+r+10>o?"addClass":"removeClass"]("vakata-context-right")}if(i+s+10>a){t.css("bottom","-1px")}t.show()},show:function(e,t,n){var i,r,s,o,a,l,c,d,h=true;if(p.element&&p.element.length){p.element.width("")}switch(h){case!t&&!e:return false;case!!t&&!!e:p.reference=e;p.position_x=t.x;p.position_y=t.y;break;case!t&&!!e:p.reference=e;i=e.offset();p.position_x=i.left+e.outerHeight();p.position_y=i.top;break;case!!t&&!e:p.position_x=t.x;p.position_y=t.y;break}if(!!e&&!n&&u(e).data("vakata_contextmenu")){n=u(e).data("vakata_contextmenu")}if(u.vakata.context._parse(n)){p.element.html(p.html)}if(p.items.length){p.element.appendTo("body");r=p.element;s=p.position_x;o=p.position_y;a=r.width();l=r.height();c=u(window).width()+u(window).scrollLeft();d=u(window).height()+u(window).scrollTop();if(f){s-=r.outerWidth()-u(e).outerWidth();if(s<u(window).scrollLeft()+20){s=u(window).scrollLeft()+20}}if(s+a+20>c){s=c-(a+20)}if(o+l+20>d){o=d-(l+20)}p.element.css({left:s,top:o}).show().find("a").first().focus().parent().addClass("vakata-context-hover");p.is_visible=true;u.vakata.context._trigger("show")}},hide:function(){if(p.is_visible){p.element.hide().find("ul").hide().end().find(":focus").blur().end().detach();p.is_visible=false;u.vakata.context._trigger("hide")}}};u(function(){f=u("body").css("direction")==="rtl";var t=false;p.element=u("<ul class='vakata-context'></ul>");p.element.on("mouseenter","li",function(e){e.stopImmediatePropagation();if(u.contains(this,e.relatedTarget)){return}if(t){clearTimeout(t)}p.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end();u(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover");u.vakata.context._show_submenu(this)}).on("mouseleave","li",function(e){if(u.contains(this,e.relatedTarget)){return}u(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(e){u(this).find(".vakata-context-hover").removeClass("vakata-context-hover");if(u.vakata.context.settings.hide_onmouseleave){t=setTimeout(function(e){return function(){u.vakata.context.hide()}}(this),u.vakata.context.settings.hide_onmouseleave)}}).on("click","a",function(e){e.preventDefault();if(!u(this).blur().parent().hasClass("vakata-context-disabled")&&u.vakata.context._execute(u(this).attr("rel"))!==false){u.vakata.context.hide()}}).on("keydown","a",function(e){var t=null;switch(e.which){case 13:case 32:e.type="mouseup";e.preventDefault();u(e.currentTarget).trigger(e);break;case 37:if(p.is_visible){p.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 38:if(p.is_visible){t=p.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();if(!t.length){t=p.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()}t.addClass("vakata-context-hover").children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 39:if(p.is_visible){p.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 40:if(p.is_visible){t=p.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first();if(!t.length){t=p.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()}t.addClass("vakata-context-hover").children("a").focus();e.stopImmediatePropagation();e.preventDefault()}break;case 27:u.vakata.context.hide();e.preventDefault();break;default:break}}).on("keydown",function(e){e.preventDefault();var t=p.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();if(t.parent().not(".vakata-context-disabled")){t.click()}});u(y).on("mousedown.vakata.jstree",function(e){if(p.is_visible&&!u.contains(p.element[0],e.target)){u.vakata.context.hide()}}).on("context_show.vakata.jstree",function(e,t){p.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");if(f){p.element.addClass("vakata-context-rtl").css("direction","rtl")}p.element.find("ul").hide().end()})})}(C),C.jstree.defaults.dnd={copy:true,open_timeout:500,is_draggable:true,check_while_dragging:true,always_copy:false,inside_pos:0,drag_selection:true,touch:true,large_drop_target:false,large_drag_target:false},C.jstree.plugins.dnd=function(e,t){this.bind=function(){t.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",C.proxy(function(e){if(this.settings.dnd.large_drag_target&&C(e.target).closest(".jstree-node")[0]!==e.currentTarget){return true}if(e.type==="touchstart"&&(!this.settings.dnd.touch||this.settings.dnd.touch==="selected"&&!C(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked"))){return true}var t=this.get_node(e.target),n=this.is_selected(t)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,i=n>1?n+" "+this.get_string("nodes"):this.get_text(e.currentTarget);if(this.settings.core.force_text){i=C.vakata.html.escape(i)}if(t&&t.id&&t.id!=="#"&&(e.which===1||e.type==="touchstart")&&(this.settings.dnd.is_draggable===true||C.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,n>1?this.get_top_selected(true):[t]))){this.element.trigger("mousedown.jstree");return C.vakata.dnd.start(e,{jstree:true,origin:this,obj:this.get_node(t,true),nodes:n>1?this.get_top_selected():[t.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+i+'<ins class="jstree-copy" style="display:none;">+</ins></div>')}},this))}},C(function(){var x=false,w=false,j=false,k=C('<div id="jstree-marker">&#160;</div>').hide();C(y).on("dnd_start.vakata.jstree",function(e,t){x=false;if(!t||!t.data||!t.data.jstree){return}k.appendTo("body")}).on("dnd_move.vakata.jstree",function(e,n){if(j){clearTimeout(j)}if(!n||!n.data||!n.data.jstree){return}if(n.event.target.id&&n.event.target.id==="jstree-marker"){return}var i=C.jstree.reference(n.event.target),r=false,s=false,t=false,o,a,l,c,d,h,u,f,p,g,_,m,v,y,b;if(i&&i._data&&i._data.dnd){k.attr("class","jstree-"+i.get_theme()+(i.settings.core.themes.responsive?" jstree-dnd-responsive":""));n.helper.children().attr("class","jstree-"+i.get_theme()+" jstree-"+i.get_theme()+"-"+i.get_theme_variant()+" "+(i.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"show":"hide"]();if((n.event.target===i.element[0]||n.event.target===i.get_container_ul()[0])&&i.get_container_ul().children().length===0){f=true;for(p=0,g=n.data.nodes.length;p<g;p++){f=f&&i.check(n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node",n.data.origin&&n.data.origin!==i?n.data.origin.get_node(n.data.nodes[p]):n.data.nodes[p],"#","last",{dnd:true,ref:i.get_node("#"),pos:"i",origin:n.data.origin,is_multi:n.data.origin&&n.data.origin!==i,is_foreign:!n.data.origin});if(!f){break}}if(f){x={ins:i,par:"#",pos:"last"};k.hide();n.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");return}}else{r=i.settings.dnd.large_drop_target?C(n.event.target).closest(".jstree-node").children(".jstree-anchor"):C(n.event.target).closest(".jstree-anchor");if(r&&r.length&&r.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){s=r.offset();t=n.event.pageY-s.top;c=r.outerHeight();if(t<c/3){u=["b","i","a"]}else if(t>c-c/3){u=["a","i","b"]}else{u=t>c/2?["i","a","b"]:["i","b","a"]}C.each(u,function(e,t){switch(t){case"b":a=s.left-6;l=s.top;d=i.get_parent(r);h=r.parent().index();break;case"i":y=i.settings.dnd.inside_pos;b=i.get_node(r.parent());a=s.left-2;l=s.top+c/2+1;d=b.id;h=y==="first"?0:y==="last"?b.children.length:Math.min(y,b.children.length);break;case"a":a=s.left-6;l=s.top+c;d=i.get_parent(r);h=r.parent().index()+1;break}f=true;for(p=0,g=n.data.nodes.length;p<g;p++){_=n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node";m=h;if(_==="move_node"&&t==="a"&&(n.data.origin&&n.data.origin===i)&&d===i.get_parent(n.data.nodes[p])){v=i.get_node(d);if(m>C.inArray(n.data.nodes[p],v.children)){m-=1}}f=f&&(i&&i.settings&&i.settings.dnd&&i.settings.dnd.check_while_dragging===false||i.check(_,n.data.origin&&n.data.origin!==i?n.data.origin.get_node(n.data.nodes[p]):n.data.nodes[p],d,m,{dnd:true,ref:i.get_node(r.parent()),pos:t,origin:n.data.origin,is_multi:n.data.origin&&n.data.origin!==i,is_foreign:!n.data.origin}));if(!f){if(i&&i.last_error){w=i.last_error()}break}}if(t==="i"&&r.parent().is(".jstree-closed")&&i.settings.dnd.open_timeout){j=setTimeout(function(e,t){return function(){e.open_node(t)}}(i,r),i.settings.dnd.open_timeout)}if(f){x={ins:i,par:d,pos:t==="i"&&y==="last"&&h===0&&!i.is_loaded(b)?"last":h};k.css({left:a+"px",top:l+"px"}).show();n.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");w={};u=true;return false}});if(u===true){return}}}}x=false;n.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");k.hide()}).on("dnd_scroll.vakata.jstree",function(e,t){if(!t||!t.data||!t.data.jstree){return}k.hide();x=false;t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er")}).on("dnd_stop.vakata.jstree",function(e,t){if(j){clearTimeout(j)}if(!t||!t.data||!t.data.jstree){return}k.hide().detach();var n,i,r=[];if(x){for(n=0,i=t.data.nodes.length;n<i;n++){r[n]=t.data.origin?t.data.origin.get_node(t.data.nodes[n]):t.data.nodes[n]}x.ins[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(t.event.metaKey||t.event.ctrlKey))?"copy_node":"move_node"](r,x.par,x.pos,false,false,false,t.data.origin)}else{n=C(t.event.target).closest(".jstree");if(n.length&&w&&w.error&&w.error==="check"){n=n.jstree(true);if(n){n.settings.core.error.call(this,w)}}}}).on("keyup.jstree keydown.jstree",function(e,t){t=C.vakata.dnd._get();if(t&&t.data&&t.data.jstree){t.helper.find(".jstree-copy").first()[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(e.metaKey||e.ctrlKey))?"show":"hide"]()}})}),function(h){h.vakata.html={div:h("<div />"),escape:function(e){return h.vakata.html.div.text(e).html()},strip:function(e){return h.vakata.html.div.empty().append(h.parseHTML(e)).text()}};var u={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};h.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(e,t){var n=h.vakata.dnd._get();n.event=t;h(y).triggerHandler("dnd_"+e+".vakata",n)},_get:function(){return{data:u.data,element:u.element,helper:u.helper}},_clean:function(){if(u.helper){u.helper.remove()}if(u.scroll_i){clearInterval(u.scroll_i);u.scroll_i=false}u={element:false,target:false,is_down:false,is_drag:false,helper:false,helper_w:0,data:false,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:false,scroll_i:false,is_touch:false};h(y).off("mousemove.vakata.jstree touchmove.vakata.jstree",h.vakata.dnd.drag);h(y).off("mouseup.vakata.jstree touchend.vakata.jstree",h.vakata.dnd.stop)},_scroll:function(e){if(!u.scroll_e||!u.scroll_l&&!u.scroll_t){if(u.scroll_i){clearInterval(u.scroll_i);u.scroll_i=false}return false}if(!u.scroll_i){u.scroll_i=setInterval(h.vakata.dnd._scroll,100);return false}if(e===true){return false}var t=u.scroll_e.scrollTop(),n=u.scroll_e.scrollLeft();u.scroll_e.scrollTop(t+u.scroll_t*h.vakata.dnd.settings.scroll_speed);u.scroll_e.scrollLeft(n+u.scroll_l*h.vakata.dnd.settings.scroll_speed);if(t!==u.scroll_e.scrollTop()||n!==u.scroll_e.scrollLeft()){h.vakata.dnd._trigger("scroll",u.scroll_e)}},start:function(e,t,n){if(e.type==="touchstart"&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]){e.pageX=e.originalEvent.changedTouches[0].pageX;e.pageY=e.originalEvent.changedTouches[0].pageY;e.target=y.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(u.is_drag){h.vakata.dnd.stop({})}try{e.currentTarget.unselectable="on";e.currentTarget.onselectstart=function(){return false};if(e.currentTarget.style){e.currentTarget.style.MozUserSelect="none"}}catch(e){}u.init_x=e.pageX;u.init_y=e.pageY;u.data=t;u.is_down=true;u.element=e.currentTarget;u.target=e.target;u.is_touch=e.type==="touchstart";if(n!==false){u.helper=h("<div id='vakata-dnd'></div>").html(n).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})}h(y).on("mousemove.vakata.jstree touchmove.vakata.jstree",h.vakata.dnd.drag);h(y).on("mouseup.vakata.jstree touchend.vakata.jstree",h.vakata.dnd.stop);return false},drag:function(n){if(n.type==="touchmove"&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]){n.pageX=n.originalEvent.changedTouches[0].pageX;n.pageY=n.originalEvent.changedTouches[0].pageY;n.target=y.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(!u.is_down){return}if(!u.is_drag){if(Math.abs(n.pageX-u.init_x)>(u.is_touch?h.vakata.dnd.settings.threshold_touch:h.vakata.dnd.settings.threshold)||Math.abs(n.pageY-u.init_y)>(u.is_touch?h.vakata.dnd.settings.threshold_touch:h.vakata.dnd.settings.threshold)){if(u.helper){u.helper.appendTo("body");u.helper_w=u.helper.outerWidth()}u.is_drag=true;h.vakata.dnd._trigger("start",n)}else{return}}var e=false,t=false,i=false,r=false,s=false,o=false,a=false,l=false,c=false,d=false;u.scroll_t=0;u.scroll_l=0;u.scroll_e=false;h(h(n.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(h(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var e=h(this),t=e.offset();if(this.scrollHeight>this.offsetHeight){if(t.top+e.height()-n.pageY<h.vakata.dnd.settings.scroll_proximity){u.scroll_t=1}if(n.pageY-t.top<h.vakata.dnd.settings.scroll_proximity){u.scroll_t=-1}}if(this.scrollWidth>this.offsetWidth){if(t.left+e.width()-n.pageX<h.vakata.dnd.settings.scroll_proximity){u.scroll_l=1}if(n.pageX-t.left<h.vakata.dnd.settings.scroll_proximity){u.scroll_l=-1}}if(u.scroll_t||u.scroll_l){u.scroll_e=h(this);return false}});if(!u.scroll_e){e=h(y);t=h(window);i=e.height();r=t.height();s=e.width();o=t.width();a=e.scrollTop();l=e.scrollLeft();if(i>r&&n.pageY-a<h.vakata.dnd.settings.scroll_proximity){u.scroll_t=-1}if(i>r&&r-(n.pageY-a)<h.vakata.dnd.settings.scroll_proximity){u.scroll_t=1}if(s>o&&n.pageX-l<h.vakata.dnd.settings.scroll_proximity){u.scroll_l=-1}if(s>o&&o-(n.pageX-l)<h.vakata.dnd.settings.scroll_proximity){u.scroll_l=1}if(u.scroll_t||u.scroll_l){u.scroll_e=e}}if(u.scroll_e){h.vakata.dnd._scroll(true)}if(u.helper){c=parseInt(n.pageY+h.vakata.dnd.settings.helper_top,10);d=parseInt(n.pageX+h.vakata.dnd.settings.helper_left,10);if(i&&c+25>i){c=i-50}if(s&&d+u.helper_w>s){d=s-(u.helper_w+2)}u.helper.css({left:d+"px",top:c+"px"})}h.vakata.dnd._trigger("move",n);return false},stop:function(e){if(e.type==="touchend"&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]){e.pageX=e.originalEvent.changedTouches[0].pageX;e.pageY=e.originalEvent.changedTouches[0].pageY;e.target=y.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)}if(u.is_drag){h.vakata.dnd._trigger("stop",e)}else{if(e.type==="touchend"&&e.target===u.target){var t=setTimeout(function(){h(e.target).click()},100);h(e.target).one("click",function(){if(t){clearTimeout(t)}})}}h.vakata.dnd._clean();return false}}}(C),C.jstree.defaults.massload=null,C.jstree.plugins.massload=function(e,a){this.init=function(e,t){a.init.call(this,e,t);this._data.massload={}};this._load_nodes=function(r,s,o){var e=this.settings.massload;if(o&&!C.isEmptyObject(this._data.massload)){return a._load_nodes.call(this,r,s,o)}if(C.isFunction(e)){return e.call(this,r,C.proxy(function(e){if(e){for(var t in e){if(e.hasOwnProperty(t)){this._data.massload[t]=e[t]}}}a._load_nodes.call(this,r,s,o)},this))}if(typeof e==="object"&&e&&e.url){e=C.extend(true,{},e);if(C.isFunction(e.url)){e.url=e.url.call(this,r)}if(C.isFunction(e.data)){e.data=e.data.call(this,r)}return C.ajax(e).done(C.proxy(function(e,t,n){if(e){for(var i in e){if(e.hasOwnProperty(i)){this._data.massload[i]=e[i]}}}a._load_nodes.call(this,r,s,o)},this)).fail(C.proxy(function(e){a._load_nodes.call(this,r,s,o)},this))}return a._load_nodes.call(this,r,s,o)};this._load_node=function(t,n){var e=this._data.massload[t.id];if(e){return this[typeof e==="string"?"_append_html_data":"_append_json_data"](t,typeof e==="string"?C(C.parseHTML(e)).filter(function(){return this.nodeType!==3}):e,function(e){n.call(this,e);delete this._data.massload[t.id]})}return a._load_node.call(this,t,n)}},C.jstree.defaults.search={ajax:false,fuzzy:false,case_sensitive:false,show_only_matches:false,show_only_matches_children:false,close_opened_onclear:true,search_leaves_only:false,search_callback:false},C.jstree.plugins.search=function(e,t){this.bind=function(){t.bind.call(this);this._data.search.str="";this._data.search.dom=C();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=false;this._data.search.smc=false;this.element.on("before_open.jstree",C.proxy(function(e,t){var n,i,r,s=this._data.search.res,o=[],a=C();if(s&&s.length){this._data.search.dom=C(this.element[0].querySelectorAll("#"+C.map(s,function(e){return"0123456789".indexOf(e[0])!==-1?"\\3"+e[0]+" "+e.substr(1).replace(C.jstree.idregex,"\\$&"):e.replace(C.jstree.idregex,"\\$&")}).join(", #")));this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");if(this._data.search.som&&this._data.search.res.length){for(n=0,i=s.length;n<i;n++){o=o.concat(this.get_node(s[n]).parents)}o=C.vakata.array_remove_item(C.vakata.array_unique(o),"#");a=o.length?C(this.element[0].querySelectorAll("#"+C.map(o,function(e){return"0123456789".indexOf(e[0])!==-1?"\\3"+e[0]+" "+e.substr(1).replace(C.jstree.idregex,"\\$&"):e.replace(C.jstree.idregex,"\\$&")}).join(", #"))):C();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");a=a.add(this._data.search.dom);if(this._data.search.smc){this._data.search.dom.children(".jstree-children").find(".jstree-node").show()}a.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){C(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this)).on("search.jstree",C.proxy(function(e,t){if(this._data.search.som){if(t.nodes.length){this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");if(this._data.search.smc){t.nodes.children(".jstree-children").find(".jstree-node").show()}t.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){C(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}}},this)).on("clear_search.jstree",C.proxy(function(e,t){if(this._data.search.som&&t.nodes.length){this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")}},this))};this.search=function(i,e,t,n,r,s){if(i===false||C.trim(i.toString())===""){return this.clear_search()}n=this.get_node(n);n=n&&n.id?n.id:null;i=i.toString();var o=this.settings.search,a=o.ajax?o.ajax:false,l=this._model.data,c=null,d=[],h=[],u,f;if(this._data.search.res.length&&!r){this.clear_search()}if(t===x){t=o.show_only_matches}if(s===x){s=o.show_only_matches_children}if(!e&&a!==false){if(C.isFunction(a)){return a.call(this,i,C.proxy(function(e){if(e&&e.d){e=e.d}this._load_nodes(!C.isArray(e)?[]:C.vakata.array_unique(e),function(){this.search(i,true,t,n,r)},true)},this),n)}else{a=C.extend({},a);if(!a.data){a.data={}}a.data.str=i;if(n){a.data.inside=n}return C.ajax(a).fail(C.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(a)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(C.proxy(function(e){if(e&&e.d){e=e.d}this._load_nodes(!C.isArray(e)?[]:C.vakata.array_unique(e),function(){this.search(i,true,t,n,r)},true)},this))}}if(!r){this._data.search.str=i;this._data.search.dom=C();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=t;this._data.search.smc=s}c=new C.vakata.search(i,true,{caseSensitive:o.case_sensitive,fuzzy:o.fuzzy});C.each(l[n?n:"#"].children_d,function(e,t){var n=l[t];if(n.text&&(o.search_callback&&o.search_callback.call(this,i,n)||!o.search_callback&&c.search(n.text).isMatch)&&(!o.search_leaves_only||n.state.loaded&&n.children.length===0)){d.push(t);h=h.concat(n.parents)}});if(d.length){h=C.vakata.array_unique(h);this._search_open(h);if(!r){this._data.search.dom=C(this.element[0].querySelectorAll("#"+C.map(d,function(e){return"0123456789".indexOf(e[0])!==-1?"\\3"+e[0]+" "+e.substr(1).replace(C.jstree.idregex,"\\$&"):e.replace(C.jstree.idregex,"\\$&")}).join(", #")));this._data.search.res=d}else{this._data.search.dom=this._data.search.dom.add(C(this.element[0].querySelectorAll("#"+C.map(d,function(e){return"0123456789".indexOf(e[0])!==-1?"\\3"+e[0]+" "+e.substr(1).replace(C.jstree.idregex,"\\$&"):e.replace(C.jstree.idregex,"\\$&")}).join(", #"))));this._data.search.res=C.vakata.array_unique(this._data.search.res.concat(d))}this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:t})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");if(this.settings.search.close_opened_onclear){this.close_node(this._data.search.opn,0)}this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=C()};this._search_open=function(n){var i=this;C.each(n.concat([]),function(e,t){if(t==="#"){return true}try{t=C("#"+t.replace(C.jstree.idregex,"\\$&"),i.element)}catch(e){}if(t&&t.length){if(i.is_closed(t)){i._data.search.opn.push(t[0].id);i.open_node(t,function(){i._search_open(n)},0)}}})}},function(n){n.vakata.search=function(_,e,m){m=m||{};m=n.extend({},n.vakata.search.defaults,m);if(m.fuzzy!==false){m.fuzzy=true}_=m.caseSensitive?_:_.toLowerCase();var v=m.location,r=m.distance,y=m.threshold,b=_.length,x,w,j,t;if(b>32){m.fuzzy=false}if(m.fuzzy){x=1<<b-1;w=function(){var e={},t=0;for(t=0;t<b;t++){e[_.charAt(t)]=0}for(t=0;t<b;t++){e[_.charAt(t)]|=1<<b-t-1}return e}();j=function(e,t){var n=e/b,i=Math.abs(v-t);if(!r){return i?1:n}return n+i/r}}t=function(e){e=m.caseSensitive?e:e.toLowerCase();if(_===e||e.indexOf(_)!==-1){return{isMatch:true,score:0}}if(!m.fuzzy){return{isMatch:false,score:1}}var t,n,i=e.length,r=y,s=e.indexOf(_,v),o,a,l=b+i,c,d,h,u,f,p=1,g=[];if(s!==-1){r=Math.min(j(0,s),r);s=e.lastIndexOf(_,v+b);if(s!==-1){r=Math.min(j(0,s),r)}}s=-1;for(t=0;t<b;t++){o=0;a=l;while(o<a){if(j(t,v+a)<=r){o=a}else{l=a}a=Math.floor((l-o)/2+o)}l=a;d=Math.max(1,v-a+1);h=Math.min(v+a,i)+b;u=new Array(h+2);u[h+1]=(1<<t)-1;for(n=h;n>=d;n--){f=w[e.charAt(n-1)];if(t===0){u[n]=(u[n+1]<<1|1)&f}else{u[n]=(u[n+1]<<1|1)&f|((c[n+1]|c[n])<<1|1)|c[n+1]}if(u[n]&x){p=j(t,n-1);if(p<=r){r=p;s=n-1;g.push(s);if(s>v){d=Math.max(1,2*v-s)}else{break}}}}if(j(t+1,v)>r){break}c=u}return{isMatch:s>=0,score:p}};return e===true?{search:t}:t(e)};n.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:false,caseSensitive:false}}(C),C.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},C.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this);this.element.on("model.jstree",C.proxy(function(e,t){this.sort(t.parent,true)},this)).on("rename_node.jstree create_node.jstree",C.proxy(function(e,t){this.sort(t.parent||t.node.parent,false);this.redraw_node(t.parent||t.node.parent,true)},this)).on("move_node.jstree copy_node.jstree",C.proxy(function(e,t){this.sort(t.parent,false);this.redraw_node(t.parent,true)},this))};this.sort=function(e,t){var n,i;e=this.get_node(e);if(e&&e.children&&e.children.length){e.children.sort(C.proxy(this.settings.sort,this));if(t){for(n=0,i=e.children_d.length;n<i;n++){this.sort(e.children_d[n],false)}}}}};var l=false;C.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:false,filter:false},C.jstree.plugins.state=function(e,t){this.bind=function(){t.bind.call(this);var n=C.proxy(function(){this.element.on(this.settings.state.events,C.proxy(function(){if(l){clearTimeout(l)}l=setTimeout(C.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",C.proxy(function(e,t){this.element.one("restore_state.jstree",n);if(!this.restore_state()){n()}},this))};this.save_state=function(){var e={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};C.vakata.storage.set(this.settings.state.key,JSON.stringify(e))};this.restore_state=function(){var n=C.vakata.storage.get(this.settings.state.key);if(!!n){try{n=JSON.parse(n)}catch(e){return false}}if(!!n&&n.ttl&&n.sec&&+new Date-n.sec>n.ttl){return false}if(!!n&&n.state){n=n.state}if(!!n&&C.isFunction(this.settings.state.filter)){n=this.settings.state.filter.call(this,n)}if(!!n){this.element.one("set_state.jstree",function(e,t){t.instance.trigger("restore_state",{state:C.extend(true,{},n)})});this.set_state(n);return true}return false};this.clear_state=function(){return C.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(C),C.jstree.defaults.types={"#":{},default:{}},C.jstree.plugins.types=function(e,d){this.init=function(e,t){var n,i;if(t&&t.types&&t.types["default"]){for(n in t.types){if(n!=="default"&&n!=="#"&&t.types.hasOwnProperty(n)){for(i in t.types["default"]){if(t.types["default"].hasOwnProperty(i)&&t.types[n][i]===x){t.types[n][i]=t.types["default"][i]}}}}}d.init.call(this,e,t);this._model.data["#"].type="#"};this.refresh=function(e,t){d.refresh.call(this,e,t);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",C.proxy(function(e,t){var n=this._model.data,i=t.nodes,r=this.settings.types,s,o,a="default";for(s=0,o=i.length;s<o;s++){a="default";if(n[i[s]].original&&n[i[s]].original.type&&r[n[i[s]].original.type]){a=n[i[s]].original.type}if(n[i[s]].data&&n[i[s]].data.jstree&&n[i[s]].data.jstree.type&&r[n[i[s]].data.jstree.type]){a=n[i[s]].data.jstree.type}n[i[s]].type=a;if(n[i[s]].icon===true&&r[a].icon!==x){n[i[s]].icon=r[a].icon}}n["#"].type="#"},this));d.bind.call(this)};this.get_json=function(e,t,n){var i,r,s=this._model.data,o=t?C.extend(true,{},t,{no_id:false}):{},a=d.get_json.call(this,e,o,n);if(a===false){return false}if(C.isArray(a)){for(i=0,r=a.length;i<r;i++){a[i].type=a[i].id&&s[a[i].id]&&s[a[i].id].type?s[a[i].id].type:"default";if(t&&t.no_id){delete a[i].id;if(a[i].li_attr&&a[i].li_attr.id){delete a[i].li_attr.id}if(a[i].a_attr&&a[i].a_attr.id){delete a[i].a_attr.id}}}}else{a.type=a.id&&s[a.id]&&s[a.id].type?s[a.id].type:"default";if(t&&t.no_id){a=this._delete_ids(a)}}return a};this._delete_ids=function(e){if(C.isArray(e)){for(var t=0,n=e.length;t<n;t++){e[t]=this._delete_ids(e[t])}return e}delete e.id;if(e.li_attr&&e.li_attr.id){delete e.li_attr.id}if(e.a_attr&&e.a_attr.id){delete e.a_attr.id}if(e.children&&C.isArray(e.children)){e.children=this._delete_ids(e.children)}return e};this.check=function(e,t,n,i,r){if(d.check.call(this,e,t,n,i,r)===false){return false}t=t&&t.id?t:this.get_node(t);n=n&&n.id?n:this.get_node(n);var s=t&&t.id?r&&r.origin?r.origin:C.jstree.reference(t.id):null,o,a,l,c;s=s&&s._model&&s._model.data?s._model.data:null;switch(e){case"create_node":case"move_node":case"copy_node":if(e!=="move_node"||C.inArray(t.id,n.children)===-1){o=this.get_rules(n);if(o.max_children!==x&&o.max_children!==-1&&o.max_children===n.children.length){this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})};return false}if(o.valid_children!==x&&o.valid_children!==-1&&C.inArray(t.type||"default",o.valid_children)===-1){this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})};return false}if(s&&t.children_d&&t.parents){a=0;for(l=0,c=t.children_d.length;l<c;l++){a=Math.max(a,s[t.children_d[l]].parents.length)}a=a-t.parents.length+1}if(a<=0||a===x){a=1}do{if(o.max_depth!==x&&o.max_depth!==-1&&o.max_depth<a){this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})};return false}n=this.get_node(n.parent);o=this.get_rules(n);a++}while(n)}break}return true};this.get_rules=function(e){e=this.get_node(e);if(!e){return false}var t=this.get_type(e,true);if(t.max_depth===x){t.max_depth=-1}if(t.max_children===x){t.max_children=-1}if(t.valid_children===x){t.valid_children=-1}return t};this.get_type=function(e,t){e=this.get_node(e);return!e?false:t?C.extend({type:e.type},this.settings.types[e.type]):e.type};this.set_type=function(e,t){var n,i,r,s,o;if(C.isArray(e)){e=e.slice();for(i=0,r=e.length;i<r;i++){this.set_type(e[i],t)}return true}n=this.settings.types;e=this.get_node(e);if(!n[t]||!e){return false}s=e.type;o=this.get_icon(e);e.type=t;if(o===true||n[s]&&n[s].icon!==x&&o===n[s].icon){this.set_icon(e,n[t].icon!==x?n[t].icon:true)}return true}},C.jstree.defaults.unique={case_sensitive:false,duplicate:function(e,t){return e+" ("+t+")"}},C.jstree.plugins.unique=function(e,f){this.check=function(e,t,n,i,r){if(f.check.call(this,e,t,n,i,r)===false){return false}t=t&&t.id?t:this.get_node(t);n=n&&n.id?n:this.get_node(n);if(!n||!n.children){return true}var s=e==="rename_node"?i:t.text,o=[],a=this.settings.unique.case_sensitive,l=this._model.data,c,d;for(c=0,d=n.children.length;c<d;c++){o.push(a?l[n.children[c]].text:l[n.children[c]].text.toLowerCase())}if(!a){s=s.toLowerCase()}switch(e){case"delete_node":return true;case"rename_node":c=C.inArray(s,o)===-1||t.text&&t.text[a?"toString":"toLowerCase"]()===s;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+s+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})}}return c;case"create_node":c=C.inArray(s,o)===-1;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+s+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})}}return c;case"copy_node":c=C.inArray(s,o)===-1;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+s+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})}}return c;case"move_node":c=t.parent===n.id&&(!r||!r.is_multi)||C.inArray(s,o)===-1;if(!c){this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+s+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:i,obj:t&&t.id?t.id:false,par:n&&n.id?n.id:false})}}return c}return true};this.create_node=function(e,t,n,i,r){if(!t||t.text===x){if(e===null){e="#"}e=this.get_node(e);if(!e){return f.create_node.call(this,e,t,n,i,r)}n=n===x?"last":n;if(!n.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(e)){return f.create_node.call(this,e,t,n,i,r)}if(!t){t={}}var s,o,a,l,c,d=this._model.data,h=this.settings.unique.case_sensitive,u=this.settings.unique.duplicate;o=s=this.get_string("New node");a=[];for(l=0,c=e.children.length;l<c;l++){a.push(h?d[e.children[l]].text:d[e.children[l]].text.toLowerCase())}l=1;while(C.inArray(h?o:o.toLowerCase(),a)!==-1){o=u.call(this,s,++l).toString()}t.text=o}return f.create_node.call(this,e,t,n,i,r)}};var d=y.createElement("DIV");if(d.setAttribute("unselectable","on"),d.setAttribute("role","presentation"),d.className="jstree-wholerow",d.innerHTML="&#160;",C.jstree.plugins.wholerow=function(e,s){this.bind=function(){s.bind.call(this);this.element.on("ready.jstree set_state.jstree",C.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",C.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",C.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",C.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n=false,i,r;for(i=0,r=t.selected.length;i<r;i++){n=this.get_node(t.selected[i],true);if(n&&n.length){n.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}}},this)).on("open_node.jstree",C.proxy(function(e,t){this.get_node(t.node,true).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",C.proxy(function(e,t){if(e.type==="hover_node"&&this.is_disabled(t.node)){return}this.get_node(t.node,true).children(".jstree-wholerow")[e.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",C.proxy(function(e){e.preventDefault();var t=C.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY});C(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t)},this)).on("click.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var t=C.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});C(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",C.proxy(function(e){e.stopImmediatePropagation();var t=C.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});C(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",C.proxy(function(e){e.stopImmediatePropagation();if(!this.is_disabled(e.currentTarget)){this.hover_node(e.currentTarget)}return false},this)).on("mouseleave.jstree",".jstree-node",C.proxy(function(e){this.dehover_node(e.currentTarget)},this))};this.teardown=function(){if(this.settings.wholerow){this.element.find(".jstree-wholerow").remove()}s.teardown.call(this)};this.redraw_node=function(e,t,n,i){e=s.redraw_node.apply(this,arguments);if(e){var r=d.cloneNode(true);if(C.inArray(e.id,this._data.core.selected)!==-1){r.className+=" jstree-wholerow-clicked"}if(this._data.core.focused&&this._data.core.focused===e.id){r.className+=" jstree-wholerow-hovered"}e.insertBefore(r,e.childNodes[0])}return e}},y.registerElement&&Object&&Object.create){var h=Object.create(HTMLElement.prototype);h.createdCallback=function(){var e={core:{},plugins:[]},t;for(t in C.jstree.plugins){if(C.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]){e.plugins.push(t);if(this.getAttribute(t)&&JSON.parse(this.getAttribute(t))){e[t]=JSON.parse(this.getAttribute(t))}}}for(t in C.jstree.defaults.core){if(C.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]){e.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t)}}C(this).jstree(e)};try{y.registerElement("vakata-jstree",{prototype:h})}catch(e){}}})?i.apply(t,r):i)||(e.exports=s)}()},"./node_modules/lodash/_arrayAggregator.js":function(e,t){e.exports=function(e,t,n,i){for(var r=-1,s=null==e?0:e.length;++r<s;){var o=e[r];t(i,o,n(o),e)}return i}},"./node_modules/lodash/_arrayIncludes.js":function(e,t,n){var i=n("./node_modules/lodash/_baseIndexOf.js");e.exports=function(e,t){return!!(null==e?0:e.length)&&-1<i(e,t,0)}},"./node_modules/lodash/_arrayIncludesWith.js":function(e,t){e.exports=function(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}},"./node_modules/lodash/_baseAggregator.js":function(e,t,n){var o=n("./node_modules/lodash/_baseEach.js");e.exports=function(e,i,r,s){return o(e,function(e,t,n){i(s,e,r(e),n)}),s}},"./node_modules/lodash/_baseDifference.js":function(e,t,n){var f=n("./node_modules/lodash/_SetCache.js"),p=n("./node_modules/lodash/_arrayIncludes.js"),g=n("./node_modules/lodash/_arrayIncludesWith.js"),_=n("./node_modules/lodash/_arrayMap.js"),m=n("./node_modules/lodash/_baseUnary.js"),v=n("./node_modules/lodash/_cacheHas.js");e.exports=function(e,t,n,i){var r=-1,s=p,o=!0,a=e.length,l=[],c=t.length;if(!a)return l;n&&(t=_(t,m(n))),i?(s=g,o=!1):200<=t.length&&(s=v,o=!1,t=new f(t));e:for(;++r<a;){var d=e[r],h=null==n?d:n(d);if(d=i||0!==d?d:0,o&&h==h){for(var u=c;u--;)if(t[u]===h)continue e;l.push(d)}else s(t,h,i)||l.push(d)}return l}},"./node_modules/lodash/_baseFilter.js":function(e,t,n){var s=n("./node_modules/lodash/_baseEach.js");e.exports=function(e,i){var r=[];return s(e,function(e,t,n){i(e,t,n)&&r.push(e)}),r}},"./node_modules/lodash/_baseMap.js":function(e,t,n){var o=n("./node_modules/lodash/_baseEach.js"),a=n("./node_modules/lodash/isArrayLike.js");e.exports=function(e,i){var r=-1,s=a(e)?Array(e.length):[];return o(e,function(e,t,n){s[++r]=i(e,t,n)}),s}},"./node_modules/lodash/_baseOrderBy.js":function(e,t,n){var s=n("./node_modules/lodash/_arrayMap.js"),o=n("./node_modules/lodash/_baseGet.js"),a=n("./node_modules/lodash/_baseIteratee.js"),l=n("./node_modules/lodash/_baseMap.js"),c=n("./node_modules/lodash/_baseSortBy.js"),d=n("./node_modules/lodash/_baseUnary.js"),h=n("./node_modules/lodash/_compareMultiple.js"),u=n("./node_modules/lodash/identity.js"),f=n("./node_modules/lodash/isArray.js");e.exports=function(e,i,n){i=i.length?s(i,function(t){return f(t)?function(e){return o(e,1===t.length?t[0]:t)}:t}):[u];var r=-1;i=s(i,d(a));var t=l(e,function(t,e,n){return{criteria:s(i,function(e){return e(t)}),index:++r,value:t}});return c(t,function(e,t){return h(e,t,n)})}},"./node_modules/lodash/_basePropertyOf.js":function(e,t){e.exports=function(t){return function(e){return null==t?void 0:t[e]}}},"./node_modules/lodash/_baseRest.js":function(e,t,n){var i=n("./node_modules/lodash/identity.js"),r=n("./node_modules/lodash/_overRest.js"),s=n("./node_modules/lodash/_setToString.js");e.exports=function(e,t){return s(r(e,t,i),e+"")}},"./node_modules/lodash/_baseSortBy.js":function(e,t){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},"./node_modules/lodash/_compareAscending.js":function(e,t,n){var d=n("./node_modules/lodash/isSymbol.js");e.exports=function(e,t){if(e!==t){var n=void 0!==e,i=null===e,r=e==e,s=d(e),o=void 0!==t,a=null===t,l=t==t,c=d(t);if(!a&&!c&&!s&&t<e||s&&o&&l&&!a&&!c||i&&o&&l||!n&&l||!r)return 1;if(!i&&!s&&!c&&e<t||c&&n&&r&&!i&&!s||a&&n&&r||!o&&r||!l)return-1}return 0}},"./node_modules/lodash/_compareMultiple.js":function(e,t,n){var c=n("./node_modules/lodash/_compareAscending.js");e.exports=function(e,t,n){for(var i=-1,r=e.criteria,s=t.criteria,o=r.length,a=n.length;++i<o;){var l=c(r[i],s[i]);if(l)return a<=i?l:l*("desc"==n[i]?-1:1)}return e.index-t.index}},"./node_modules/lodash/_createAggregator.js":function(e,t,n){var o=n("./node_modules/lodash/_arrayAggregator.js"),a=n("./node_modules/lodash/_baseAggregator.js"),l=n("./node_modules/lodash/_baseIteratee.js"),c=n("./node_modules/lodash/isArray.js");e.exports=function(r,s){return function(e,t){var n=c(e)?o:a,i=s?s():{};return n(e,r,l(t,2),i)}}},"./node_modules/lodash/_createFind.js":function(e,t,n){var a=n("./node_modules/lodash/_baseIteratee.js"),l=n("./node_modules/lodash/isArrayLike.js"),c=n("./node_modules/lodash/keys.js");e.exports=function(o){return function(e,t,n){var i=Object(e);if(!l(e)){var r=a(t,3);e=c(e),t=function(e){return r(i[e],e,i)}}var s=o(e,t,n);return-1<s?i[r?e[s]:s]:void 0}}},"./node_modules/lodash/_escapeHtmlChar.js":function(e,t,n){var i=n("./node_modules/lodash/_basePropertyOf.js")({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=i},"./node_modules/lodash/_isIterateeCall.js":function(e,t,n){var r=n("./node_modules/lodash/eq.js"),s=n("./node_modules/lodash/isArrayLike.js"),o=n("./node_modules/lodash/_isIndex.js"),a=n("./node_modules/lodash/isObject.js");e.exports=function(e,t,n){if(!a(n))return!1;var i=typeof t;return!!("number"==i?s(n)&&o(t,n.length):"string"==i&&t in n)&&r(n[t],e)}},"./node_modules/lodash/countBy.js":function(e,t,n){var i=n("./node_modules/lodash/_baseAssignValue.js"),r=n("./node_modules/lodash/_createAggregator.js"),s=Object.prototype.hasOwnProperty,o=r(function(e,t,n){s.call(e,n)?++e[n]:i(e,n,1)});e.exports=o},"./node_modules/lodash/difference.js":function(e,t,n){var i=n("./node_modules/lodash/_baseDifference.js"),r=n("./node_modules/lodash/_baseFlatten.js"),s=n("./node_modules/lodash/_baseRest.js"),o=n("./node_modules/lodash/isArrayLikeObject.js"),a=s(function(e,t){return o(e)?i(e,r(t,1,o,!0)):[]});e.exports=a},"./node_modules/lodash/escape.js":function(e,t,n){var i=n("./node_modules/lodash/_escapeHtmlChar.js"),r=n("./node_modules/lodash/toString.js"),s=/[&<>"']/g,o=RegExp(s.source);e.exports=function(e){return(e=r(e))&&o.test(e)?e.replace(s,i):e}},"./node_modules/lodash/filter.js":function(e,t,n){var i=n("./node_modules/lodash/_arrayFilter.js"),r=n("./node_modules/lodash/_baseFilter.js"),s=n("./node_modules/lodash/_baseIteratee.js"),o=n("./node_modules/lodash/isArray.js");e.exports=function(e,t){return(o(e)?i:r)(e,s(t,3))}},"./node_modules/lodash/find.js":function(e,t,n){var i=n("./node_modules/lodash/_createFind.js")(n("./node_modules/lodash/findIndex.js"));e.exports=i},"./node_modules/lodash/findIndex.js":function(e,t,n){var s=n("./node_modules/lodash/_baseFindIndex.js"),o=n("./node_modules/lodash/_baseIteratee.js"),a=n("./node_modules/lodash/toInteger.js"),l=Math.max;e.exports=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:a(n);return r<0&&(r=l(i+r,0)),s(e,o(t,3),r)}},"./node_modules/lodash/isArrayLikeObject.js":function(e,t,n){var i=n("./node_modules/lodash/isArrayLike.js"),r=n("./node_modules/lodash/isObjectLike.js");e.exports=function(e){return r(e)&&i(e)}},"./node_modules/lodash/isEmpty.js":function(e,t,n){var i=n("./node_modules/lodash/_baseKeys.js"),r=n("./node_modules/lodash/_getTag.js"),s=n("./node_modules/lodash/isArguments.js"),o=n("./node_modules/lodash/isArray.js"),a=n("./node_modules/lodash/isArrayLike.js"),l=n("./node_modules/lodash/isBuffer.js"),c=n("./node_modules/lodash/_isPrototype.js"),d=n("./node_modules/lodash/isTypedArray.js"),h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||d(e)||s(e)))return!e.length;var t=r(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(c(e))return!i(e).length;for(var n in e)if(h.call(e,n))return!1;return!0}},"./node_modules/lodash/map.js":function(e,t,n){var i=n("./node_modules/lodash/_arrayMap.js"),r=n("./node_modules/lodash/_baseIteratee.js"),s=n("./node_modules/lodash/_baseMap.js"),o=n("./node_modules/lodash/isArray.js");e.exports=function(e,t){return(o(e)?i:s)(e,r(t,3))}},"./node_modules/lodash/sortBy.js":function(e,t,n){var i=n("./node_modules/lodash/_baseFlatten.js"),r=n("./node_modules/lodash/_baseOrderBy.js"),s=n("./node_modules/lodash/_baseRest.js"),o=n("./node_modules/lodash/_isIterateeCall.js"),a=s(function(e,t){if(null==e)return[];var n=t.length;return 1<n&&o(e,t[0],t[1])?t=[]:2<n&&o(t[0],t[1],t[2])&&(t=[t[0]]),r(e,i(t,1),[])});e.exports=a},"./node_modules/lodash/uniqueId.js":function(e,t,n){var i=n("./node_modules/lodash/toString.js"),r=0;e.exports=function(e){var t=++r;return i(e)+t}},"./node_modules/ng-file-upload/dist/ng-file-upload-all.js":function(e,t,n){(function(c,d){var i;!function(){function e(e,t){window.XMLHttpRequest.prototype[e]=t(window.XMLHttpRequest.prototype[e])}function o(e,t,n){try{Object.defineProperty(e,t,{get:n})}catch(e){}}if(window.FileAPI||(window.FileAPI={}),!window.XMLHttpRequest)throw"AJAX is not supported. XMLHttpRequest is not defined.";if(FileAPI.shouldLoad=!window.FormData||FileAPI.forceLoad,FileAPI.shouldLoad){function r(n){if(!n.__listeners){n.upload||(n.upload={}),n.__listeners=[];var i=n.upload.addEventListener;n.upload.addEventListener=function(e,t){n.__listeners[e]=t,i&&i.apply(this,arguments)}}}e("open",function(i){return function(t,e,n){r(this),this.__url=e;try{i.apply(this,[t,e,n])}catch(e){-1<e.message.indexOf("Access is denied")&&(this.__origError=e,i.apply(this,[t,"_fix_for_ie_crossdomain__",n]))}}}),e("getResponseHeader",function(t){return function(e){return this.__fileApiXHR&&this.__fileApiXHR.getResponseHeader?this.__fileApiXHR.getResponseHeader(e):null==t?null:t.apply(this,[e])}}),e("getAllResponseHeaders",function(e){return function(){return this.__fileApiXHR&&this.__fileApiXHR.getAllResponseHeaders?this.__fileApiXHR.getAllResponseHeaders():null==e?null:e.apply(this)}}),e("abort",function(e){return function(){return this.__fileApiXHR&&this.__fileApiXHR.abort?this.__fileApiXHR.abort():null==e?null:e.apply(this)}}),e("setRequestHeader",function(i){return function(e,t){if("__setXHR_"===e){r(this);var n=t(this);n instanceof Function&&n(this)}else this.__requestHeaders=this.__requestHeaders||{},this.__requestHeaders[e]=t,i.apply(this,arguments)}}),e("send",function(s){return function(){var i=this;if(arguments[0]&&arguments[0].__isFileAPIShim){for(var e=arguments[0],t={url:i.__url,jsonp:!1,cache:!0,complete:function(e,t){e&&angular.isString(e)&&-1!==e.indexOf("#2174")&&(e=null),i.__completed=!0,!e&&i.__listeners.load&&i.__listeners.load({type:"load",loaded:i.__loaded,total:i.__total,target:i,lengthComputable:!0}),!e&&i.__listeners.loadend&&i.__listeners.loadend({type:"loadend",loaded:i.__loaded,total:i.__total,target:i,lengthComputable:!0}),"abort"===e&&i.__listeners.abort&&i.__listeners.abort({type:"abort",loaded:i.__loaded,total:i.__total,target:i,lengthComputable:!0}),void 0!==t.status&&o(i,"status",function(){return 0===t.status&&e&&"abort"!==e?500:t.status}),void 0!==t.statusText&&o(i,"statusText",function(){return t.statusText}),o(i,"readyState",function(){return 4}),void 0!==t.response&&o(i,"response",function(){return t.response});var n=t.responseText||(e&&0===t.status&&"abort"!==e?e:void 0);o(i,"responseText",function(){return n}),o(i,"response",function(){return n}),e&&o(i,"err",function(){return e}),i.__fileApiXHR=t,i.onreadystatechange&&i.onreadystatechange(),i.onload&&i.onload()},progress:function(e){if((e.target=i).__listeners.progress&&i.__listeners.progress(e),i.__total=e.total,i.__loaded=e.loaded,e.total===e.loaded){var t=this;setTimeout(function(){i.__completed||(i.getAllResponseHeaders=function(){},t.complete(null,{status:204,statusText:"No Content"}))},FileAPI.noContentTimeout||1e4)}},headers:i.__requestHeaders,data:{},files:{}},n=0;n<e.data.length;n++){var r=e.data[n];null!=r.val&&null!=r.val.name&&null!=r.val.size&&null!=r.val.type?t.files[r.key]=r.val:t.data[r.key]=r.val}setTimeout(function(){if(!FileAPI.hasFlash)throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';i.__fileApiXHR=FileAPI.upload(t)},1)}else{if(this.__origError)throw this.__origError;s.apply(i,arguments)}}}),window.XMLHttpRequest.__isFileAPIShim=!0,window.FormData=FormData=function(){return{append:function(e,t,n){t.__isFileAPIBlobShim&&(t=t.data[0]),this.data.push({key:e,val:t,name:n})},data:[],__isFileAPIShim:!0}},window.Blob=Blob=function(e){return{data:e,__isFileAPIBlobShim:!0}}}}(),function(){function e(){try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(e){if(void 0!==navigator.mimeTypes["application/x-shockwave-flash"])return!0}return!1}function o(e){var t=0,n=0;if(c)return d(e).offset();if(e.offsetParent)for(;t+=e.offsetLeft-e.scrollLeft,n+=e.offsetTop-e.scrollTop,e=e.offsetParent;);return{left:t,top:n}}if(FileAPI.shouldLoad){if(FileAPI.hasFlash=e(),FileAPI.forceLoad&&(FileAPI.html5=!1),!FileAPI.upload){var t,n,i,r,s,a=document.createElement("script"),l=document.getElementsByTagName("script");if(window.FileAPI.jsUrl)t=window.FileAPI.jsUrl;else if(window.FileAPI.jsPath)n=window.FileAPI.jsPath;else for(i=0;i<l.length;i++)if(-1<(r=(s=l[i].src).search(/\/ng\-file\-upload[\-a-zA-z0-9\.]*\.js/))){n=s.substring(0,r+1);break}null==FileAPI.staticPath&&(FileAPI.staticPath=n),a.setAttribute("src",t||n+"FileAPI.min.js"),document.getElementsByTagName("head")[0].appendChild(a)}FileAPI.ngfFixIE=function(n,i,r){if(!e())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';n.bind("mouseenter",function(){var e,t=i.parent();n.attr("disabled")?t&&t.removeClass("js-fileapi-wrapper"):(i.attr("__ngf_flash_")||(i.unbind("change"),i.unbind("click"),i.bind("change",function(e){s.apply(this,[e]),r.apply(this,[e])}),i.attr("__ngf_flash_","true")),t.addClass("js-fileapi-wrapper"),"input"===(e=n)[0].tagName.toLowerCase()&&e.attr("type")&&"file"===e.attr("type").toLowerCase()||(t.css("position","absolute").css("top",o(n[0]).top+"px").css("left",o(n[0]).left+"px").css("width",n[0].offsetWidth+"px").css("height",n[0].offsetHeight+"px").css("filter","alpha(opacity=0)").css("display",n.css("display")).css("overflow","hidden").css("z-index","900000").css("visibility","visible"),i.css("width",n[0].offsetWidth+"px").css("height",n[0].offsetHeight+"px").css("position","absolute").css("top","0px").css("left","0px")))});var s=function(t){for(var e=FileAPI.getFiles(t),n=0;n<e.length;n++)void 0===e[n].size&&(e[n].size=0),void 0===e[n].name&&(e[n].name="file"),void 0===e[n].type&&(e[n].type="undefined");t.target||(t.target={}),t.target.files=e,t.target.files!==e&&(t.__files_=e),(t.__files_||t.target.files).item=function(e){return(t.__files_||t.target.files)[e]||null}}},FileAPI.disableFileInput=function(e,t){t?e.removeClass("js-fileapi-wrapper"):e.addClass("js-fileapi-wrapper")}}}(),window.FileReader||(window.FileReader=function(){var i=this,n=!1;this.listeners={},this.addEventListener=function(e,t){i.listeners[e]=i.listeners[e]||[],i.listeners[e].push(t)},this.removeEventListener=function(e,t){i.listeners[e]&&i.listeners[e].splice(i.listeners[e].indexOf(t),1)},this.dispatchEvent=function(e){var t=i.listeners[e.type];if(t)for(var n=0;n<t.length;n++)t[n].call(i,e)},this.onabort=this.onerror=this.onload=this.onloadstart=this.onloadend=this.onprogress=null;function r(e,t){var n={type:e,target:i,loaded:t.loaded,total:t.total,error:t.error};return null!=t.result&&(n.target.result=t.result),n}function t(e){var t;n||(n=!0,i.onloadstart&&i.onloadstart(r("loadstart",e))),"load"===e.type?(i.onloadend&&i.onloadend(r("loadend",e)),t=r("load",e),i.onload&&i.onload(t)):"progress"===e.type?(t=r("progress",e),i.onprogress&&i.onprogress(t)):(t=r("error",e),i.onerror&&i.onerror(t)),i.dispatchEvent(t)}this.readAsDataURL=function(e){FileAPI.readAsDataURL(e,t)},this.readAsText=function(e){FileAPI.readAsText(e,t)}}),!window.XMLHttpRequest||window.FileAPI&&FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=(i=window.XMLHttpRequest.prototype.setRequestHeader,function(e,t){if("__setXHR_"===e){var n=t(this);n instanceof Function&&n(this)}else i.apply(this,arguments)}));var r=angular.module("ngFileUpload",[]);function o(r,e,s,o,a,l,c,d){function h(t){var n=r.attrGetter("ngfNoObjectUrl",a,s);r.dataUrl(t,n).finally(function(){e(function(){var e=(n?t.$ngfDataUrl:t.$ngfBlobUrl)||t.$ngfDataUrl;d?o.css("background-image","url('"+(e||"")+"')"):o.attr("src",e),e?o.removeClass("ng-hide"):o.addClass("ng-hide")})})}e(function(){var e=s.$watch(a[l],function(n){var e,t=c;if("ngfThumbnail"===l&&0===(t=t||{width:o[0].naturalWidth||o[0].clientWidth,height:o[0].naturalHeight||o[0].clientHeight}).width&&window.getComputedStyle){var i=getComputedStyle(o[0]);i.width&&-1<i.width.indexOf("px")&&i.height&&-1<i.height.indexOf("px")&&(t={width:parseInt(i.width.slice(0,-2)),height:parseInt(i.height.slice(0,-2))})}if(angular.isString(n))return o.removeClass("ng-hide"),d?o.css("background-image","url('"+n+"')"):o.attr("src",n);!n||!n.type||0!==n.type.search("img"===(e=o[0]).tagName.toLowerCase()?"image":"audio"===e.tagName.toLowerCase()?"audio":"video"===e.tagName.toLowerCase()?"video":/./)||d&&0!==n.type.indexOf("image")?o.addClass("ng-hide"):t&&r.isResizeSupported()?(t.resizeIf=function(e,t){return r.attrGetter("ngfResizeIf",a,s,{$width:e,$height:t,$file:n})},r.resize(n,t).then(function(e){h(e)},function(e){throw e})):h(n)});s.$on("$destroy",function(){e()})})}function u(){var e=document.createElement("div");return"draggable"in e&&"ondrop"in e&&!/Edge\/12./i.test(navigator.userAgent)}r.version="12.2.13",r.service("UploadBase",["$http","$q","$timeout",function(a,e,l){var c=this;c.promisesCount=0,this.isResumeSupported=function(){return window.Blob&&window.Blob.prototype.slice};var d=this.isResumeSupported();function t(n){n.method=n.method||"POST",n.headers=n.headers||{};var i=n._deferred=n._deferred||e.defer(),r=i.promise;function s(e){i.notify&&i.notify(e),r.progressFunc&&l(function(){r.progressFunc(e)})}function t(e){return null!=n._start&&d?{loaded:e.loaded+n._start,total:n._file&&n._file.size||e.total,type:e.type,config:n,lengthComputable:!0,target:e.target}:e}function o(){a(n).then(function(e){if(d&&n._chunkSize&&!n._finished&&n._file){var t=n._file&&n._file.size||0;s({loaded:Math.min(n._end,t),total:t,config:n,type:"progress"}),c.upload(n,!0)}else n._finished&&delete n._finished,i.resolve(e)},function(e){i.reject(e)},function(e){i.notify(e)})}return n.disableProgress||(n.headers.__setXHR_=function(){return function(e){e&&e.upload&&e.upload.addEventListener&&(n.__XHR=e,n.xhrFn&&n.xhrFn(e),e.upload.addEventListener("progress",function(e){e.config=n,s(t(e))},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&(e.config=n,s(t(e)))},!1))}}),d?n._chunkSize&&n._end&&!n._finished?(n._start=n._end,n._end+=n._chunkSize,o()):n.resumeSizeUrl?a.get(n.resumeSizeUrl).then(function(e){n.resumeSizeResponseReader?n._start=n.resumeSizeResponseReader(e.data):n._start=parseInt((null==e.data.size?e.data:e.data.size).toString()),n._chunkSize&&(n._end=n._start+n._chunkSize),o()},function(e){throw e}):n.resumeSize?n.resumeSize().then(function(e){n._start=e,n._chunkSize&&(n._end=n._start+n._chunkSize),o()},function(e){throw e}):(n._chunkSize&&(n._start=0,n._end=n._start+n._chunkSize),o()):o(),r.success=function(t){return r.then(function(e){t(e.data,e.status,e.headers,n)}),r},r.error=function(t){return r.then(null,function(e){t(e.data,e.status,e.headers,n)}),r},r.progress=function(t){return r.progressFunc=t,r.then(null,null,function(e){t(e)}),r},r.abort=r.pause=function(){return n.__XHR&&l(function(){n.__XHR.abort()}),r},r.xhr=function(e){var t;return n.xhrFn=(t=n.xhrFn,function(){t&&t.apply(r,arguments),e.apply(r,arguments)}),r},c.promisesCount++,r.finally&&r.finally instanceof Function&&r.finally(function(){c.promisesCount--}),r}function n(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}this.isUploadInProgress=function(){return 0<c.promisesCount},this.rename=function(e,t){return e.ngfName=t,e},this.jsonBlob=function(e){null==e||angular.isString(e)||(e=JSON.stringify(e));var t=new window.Blob([e],{type:"application/json"});return t._ngfBlob=!0,t},this.json=function(e){return angular.toJson(e)},this.isFile=function(e){return null!=e&&(e instanceof window.Blob||e.flashId&&e.name&&e.size)},this.upload=function(a,e){function l(e,t,n){if(void 0!==t)if(angular.isDate(t)&&(t=t.toISOString()),angular.isString(t))e.append(n,t);else if(c.isFile(t)){var i=function(e,t){if(e._ngfBlob)return e;if(a._file=a._file||e,null!=a._start&&d){a._end&&a._end>=e.size&&(a._finished=!0,a._end=e.size);var n=e.slice(a._start,a._end||e.size);return n.name=e.name,n.ngfName=e.ngfName,a._chunkSize&&(t.append("_chunkSize",a._chunkSize),t.append("_currentChunkSize",a._end-a._start),t.append("_chunkNumber",Math.floor(a._start/a._chunkSize)),t.append("_totalSize",a._file.size)),n}return e}(t,e),r=n.split(",");r[1]&&(i.ngfName=r[1].replace(/^\s+|\s+$/g,""),n=r[0]),a._fileKey=a._fileKey||n,e.append(n,i,i.ngfName||i.name)}else if(angular.isObject(t)){if(t.$$ngfCircularDetection)throw"ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: "+n;t.$$ngfCircularDetection=!0;try{for(var s in t)if(t.hasOwnProperty(s)&&"$$ngfCircularDetection"!==s){var o=null==a.objectKey?"[i]":a.objectKey;t.length&&-1<parseInt(s)&&(o=null==a.arrayKey?o:a.arrayKey),l(e,t[s],n+o.replace(/[ik]/g,s))}}finally{delete t.$$ngfCircularDetection}}else e.append(n,t)}return e||(a=n(a)),a._isDigested||(a._isDigested=!0,a._chunkSize=c.translateScalars(a.resumeChunkSize),a._chunkSize=a._chunkSize?parseInt(a._chunkSize.toString()):null,a.headers=a.headers||{},a.headers["Content-Type"]=void 0,a.transformRequest=a.transformRequest?angular.isArray(a.transformRequest)?a.transformRequest:[a.transformRequest]:[],a.transformRequest.push(function(e){var t,n=new window.FormData;for(t in e=e||a.fields||{},a.file&&(e.file=a.file),e)if(e.hasOwnProperty(t)){var i=e[t];a.formDataAppender?a.formDataAppender(n,t,i):l(n,i,t)}return n})),t(a)},this.http=function(e){return(e=n(e)).transformRequest=e.transformRequest||function(e){return window.ArrayBuffer&&e instanceof window.ArrayBuffer||e instanceof window.Blob?e:a.defaults.transformRequest[0].apply(this,arguments)},e._chunkSize=c.translateScalars(e.resumeChunkSize),e._chunkSize=e._chunkSize?parseInt(e._chunkSize.toString()):null,t(e)},this.translateScalars=function(e){if(angular.isString(e)){if(e.search(/kb/i)===e.length-2)return parseFloat(1024*e.substring(0,e.length-2));if(e.search(/mb/i)===e.length-2)return parseFloat(1048576*e.substring(0,e.length-2));if(e.search(/gb/i)===e.length-2)return parseFloat(1073741824*e.substring(0,e.length-2));if(e.search(/b/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/s/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/m/i)===e.length-1)return parseFloat(60*e.substring(0,e.length-1));if(e.search(/h/i)===e.length-1)return parseFloat(3600*e.substring(0,e.length-1))}return e},this.urlToBlob=function(s){var o=e.defer();return a({url:s,method:"get",responseType:"arraybuffer"}).then(function(e){var t=new Uint8Array(e.data),n=e.headers("content-type")||"image/WebP",i=new window.Blob([t],{type:n}),r=s.match(/.*\/(.+?)(\?.*)?$/);1<r.length&&(i.name=r[1]),o.resolve(i)},function(e){o.reject(e)}),o.promise},this.setDefaults=function(e){this.defaults=e||{}},this.defaults={},this.version=r.version}]),r.service("Upload",["$parse","$timeout","$compile","$q","UploadExif",function(w,j,e,k,t){var C=t;function A(i,r,s,o,a){var l=[C.emptyPromise()];function e(n,t){if(0===n.type.indexOf("image")){if(i.pattern&&!C.validatePattern(n,i.pattern))return;i.resizeIf=function(e,t){return C.attrGetter("ngfResizeIf",s,o,{$width:e,$height:t,$file:n})};var e=C.resize(n,i);l.push(e),e.then(function(e){r.splice(t,1,e)},function(e){n.$error="resize",(n.$errorMessages=n.$errorMessages||{}).resize=!0,n.$errorParam=(e?(e.message?e.message:e)+": ":"")+(n&&n.name),a.$ngfValidations.push({name:"resize",valid:!1}),C.applyModelValidation(a,r)})}}for(var t=0;t<r.length;t++)e(r[t],t);return k.all(l)}return C.getAttrWithDefaults=function(e,t){if(null!=e[t])return e[t];var n=C.defaults[t];return null==n||angular.isString(n)?n:JSON.stringify(n)},C.attrGetter=function(t,e,n,i){var r=this.getAttrWithDefaults(e,t);if(!n)return r;try{return i?w(r)(n,i):w(r)(n)}catch(e){if(t.search(/min|max|pattern/i))return r;throw e}},C.shouldUpdateOn=function(e,t,n){var i=C.attrGetter("ngfModelOptions",t,n);return!i||!i.updateOn||-1<i.updateOn.split(" ").indexOf(e)},C.emptyPromise=function(){var e=k.defer(),t=arguments;return j(function(){e.resolve.apply(e,t)}),e.promise},C.rejectPromise=function(){var e=k.defer(),t=arguments;return j(function(){e.reject.apply(e,t)}),e.promise},C.happyPromise=function(e,t){var n=k.defer();return e.then(function(e){n.resolve(e)},function(e){j(function(){throw e}),n.resolve(t)}),n.promise},C.updateModel=function(l,c,d,h,o,u,t){function a(e,t,n,i,r){c.$$ngfPrevValidFiles=e,c.$$ngfPrevInvalidFiles=t;var s=e&&e.length?e[0]:null,o=t&&t.length?t[0]:null;l&&(C.applyModelValidation(l,e),l.$setViewValue(r?s:e)),h&&w(h)(d,{$files:e,$file:s,$newFiles:n,$duplicateFiles:i,$invalidFiles:t,$invalidFile:o,$event:u});var a=C.attrGetter("ngfModelInvalid",c);a&&j(function(){w(a).assign(d,r?o:t)}),j(function(){})}var f,s,p,e,g=[],_=[],m=[];function v(){function i(){j(function(){a(n?s.concat(m):m,n?p.concat(_):_,o,g,y)},x&&x.debounce?x.debounce.change||x.debounce:0)}var r=b?f:m;(function(t,n,i,r){var e=C.attrGetter("ngfResize",n,i);if(!e||!C.isResizeSupported()||!t.length)return C.emptyPromise();if(e instanceof Function){var s=k.defer();return e(t).then(function(e){A(e,t,n,i,r).then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(e){s.reject(e)})}return A(e,t,n,i,r)})(r,c,d,l).then(function(){b?C.validate(f,n?s.length:0,l,c,d).then(function(e){m=e.validsFiles,_=e.invalidsFiles,i()}):i()},function(){for(var e=0;e<r.length;e++){var t=r[e];if("resize"===t.$error){var n=m.indexOf(t);-1<n&&(m.splice(n,1),_.push(t)),i()}}})}s=c.$$ngfPrevValidFiles||[],p=c.$$ngfPrevInvalidFiles||[],l&&l.$modelValue&&(e=l.$modelValue,s=angular.isArray(e)?e:[e]);var n=C.attrGetter("ngfKeep",c,d);f=(o||[]).slice(0),"distinct"!==n&&!0!==C.attrGetter("ngfKeepDistinct",c,d)||function(){function n(e,t){return e.name===t.name&&(e.$ngfOrigSize||e.size)===(t.$ngfOrigSize||t.size)&&e.type===t.type}function e(e){var t;for(t=0;t<s.length;t++)if(n(e,s[t]))return 1;for(t=0;t<p.length;t++)if(n(e,p[t]))return 1}if(o){f=[],g=[];for(var t=0;t<o.length;t++)e(o[t])?g.push(o[t]):f.push(o[t])}}();var y=!n&&!C.attrGetter("ngfMultiple",c,d)&&!C.attrGetter("multiple",c);if(!n||f.length){C.attrGetter("ngfBeforeModelChange",c,d,{$files:o,$file:o&&o.length?o[0]:null,$newFiles:f,$duplicateFiles:g,$event:u});var b=C.attrGetter("ngfValidateAfterResize",c,d),x=C.attrGetter("ngfModelOptions",c,d);C.validate(f,n?s.length:0,l,c,d).then(function(e){var n,i,r,s;t?a(f,[],o,g,y):(x&&x.allowInvalid||b?m=f:(m=e.validFiles,_=e.invalidFiles),C.attrGetter("ngfFixOrientation",c,d)&&C.isExifSupported()?(n=m,i=c,r=d,s=[C.emptyPromise()],angular.forEach(n,function(e,t){0===e.type.indexOf("image/jpeg")&&C.attrGetter("ngfFixOrientation",i,r,{$file:e})&&s.push(C.happyPromise(C.applyExifRotation(e),e).then(function(e){n.splice(t,1,e)}))}),k.all(s).then(function(){v()})):v())})}},C}]),r.directive("ngfSelect",["$parse","$timeout","$compile","Upload",function(e,r,t,m){var v=[];function s(r,s,o,a,e,t,n,l){var i=function(e,t){return l.attrGetter(e,o,t)};function c(){return"input"===s[0].tagName.toLowerCase()&&o.type&&"file"===o.type.toLowerCase()}function d(){return i("ngfChange")||i("ngfSelect")}function h(e){if(l.shouldUpdateOn("change",o,r)){var t=e.__files_||e.target&&e.target.files,n=[];if(!t)return;for(var i=0;i<t.length;i++)n.push(t[i]);l.updateModel(a,o,r,d(),n.length?n:null,e)}}l.registerModelChangeValidator(a,o,r);var u=[];i("ngfMultiple")&&u.push(r.$watch(i("ngfMultiple"),function(){g.attr("multiple",i("ngfMultiple",r))})),i("ngfCapture")&&u.push(r.$watch(i("ngfCapture"),function(){g.attr("capture",i("ngfCapture",r))})),i("ngfAccept")&&u.push(r.$watch(i("ngfAccept"),function(){g.attr("accept",i("ngfAccept",r))})),u.push(o.$observe("accept",function(){g.attr("accept",i("accept"))}));var f=0,p=0;var g=s;function _(e){l.shouldUpdateOn("click",o,r)&&g.val()&&(g.val(null),l.updateModel(a,o,r,d(),null,e,!0))}c()||(g=function(){if(c())return s;var e=angular.element('<input type="file">'),t=angular.element("<label>upload</label>");return t.css("visibility","hidden").css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px").css("border","none").css("margin","0px").css("padding","0px").attr("tabindex","-1"),function(t,n){function e(e){t.attr("id","ngf-"+e),n.attr("id","ngf-label-"+e)}for(var i=0;i<s[0].attributes.length;i++){var r=s[0].attributes[i];"type"!==r.name&&"class"!==r.name&&"style"!==r.name&&("id"===r.name?(e(r.value),u.push(o.$observe("id",e))):t.attr(r.name,r.value||"required"!==r.name&&"multiple"!==r.name?r.value:r.name))}}(e,t),v.push({el:s,ref:t}),document.body.appendChild(t.append(e)[0]),e}()),g.bind("change",h),c()?s.bind("click",_):s.bind("click touchstart touchend",function(e){if(s.attr("disabled"))return!1;if(!i("ngfSelectDisabled",r)){var t=function(e){var t=e.changedTouches||e.originalEvent&&e.originalEvent.changedTouches;if(t){if("touchstart"===e.type)return p=t[0].clientX,f=t[0].clientY,!0;if("touchend"===e.type){var n=t[0].clientX,i=t[0].clientY;if(20<Math.abs(n-p)||20<Math.abs(i-f))return e.stopPropagation(),e.preventDefault(),!1}return!0}}(e);if(null!=t)return t;_(e);try{c()||document.body.contains(g[0])||(v.push({el:s,ref:g.parent()}),document.body.appendChild(g.parent()[0]),g.bind("change",h))}catch(e){}return!function(e){var t=e.match(/Android[^\d]*(\d+)\.(\d+)/);if(t&&2<t.length){var n=m.defaults.androidFixMinorVersion||4;return parseInt(t[1])<4||parseInt(t[1])===n&&parseInt(t[2])<n}return-1===e.indexOf("Chrome")&&/.*Windows.*Safari.*/.test(e)}(navigator.userAgent)?g[0].click():setTimeout(function(){g[0].click()},0),!1}}),-1!==navigator.appVersion.indexOf("MSIE 10")&&g.bind("click",function e(t){if(g&&!g.attr("__ngf_ie10_Fix_")){if(!g[0].parentNode)return void(g=null);t.preventDefault(),t.stopPropagation(),g.unbind("click");var n=g.clone();return g.replaceWith(n),(g=n).attr("__ngf_ie10_Fix_","true"),g.bind("change",h),g.bind("click",e),g[0].click(),!1}g.removeAttr("__ngf_ie10_Fix_")}),a&&a.$formatters.push(function(e){return null!=e&&0!==e.length||g.val()&&g.val(null),e}),r.$on("$destroy",function(){c()||g.parent().remove(),angular.forEach(u,function(e){e()})}),t(function(){for(var e=0;e<v.length;e++){var t=v[e];document.body.contains(t.el[0])||(v.splice(e,1),t.ref.remove())}}),window.FileAPI&&window.FileAPI.ngfFixIE&&window.FileAPI.ngfFixIE(s,g,h)}return{restrict:"AEC",require:"?ngModel",link:function(e,t,n,i){s(e,t,n,i,0,r,0,m)}}}]),r.service("UploadDataUrl",["UploadBase","$timeout","$q",function(e,n,a){var l=e;return l.base64DataUrl=function(n){if(angular.isArray(n)){var i=a.defer(),r=0;return angular.forEach(n,function(e){l.dataUrl(e,!0).finally(function(){if(++r===n.length){var t=[];angular.forEach(n,function(e){t.push(e.$ngfDataUrl)}),i.resolve(t,n)}})}),i.promise}return l.dataUrl(n,!0)},l.dataUrl=function(s,t){if(!s)return l.emptyPromise(s,s);if(t&&null!=s.$ngfDataUrl||!t&&null!=s.$ngfBlobUrl)return l.emptyPromise(t?s.$ngfDataUrl:s.$ngfBlobUrl,s);var e=t?s.$$ngfDataUrlPromise:s.$$ngfBlobUrlPromise;if(e)return e;var o=a.defer();return n(function(){if(window.FileReader&&s&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 8")||s.size<2e4)&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 9")||s.size<4e6)){var i=window.URL||window.webkitURL;if(i&&i.createObjectURL&&!t){var r;try{r=i.createObjectURL(s)}catch(e){return void n(function(){s.$ngfBlobUrl="",o.reject()})}n(function(){if(s.$ngfBlobUrl=r){o.resolve(r,s),l.blobUrls=l.blobUrls||[],l.blobUrlsTotalSize=l.blobUrlsTotalSize||0,l.blobUrls.push({url:r,size:s.size}),l.blobUrlsTotalSize+=s.size||0;for(var e=l.defaults.blobUrlsMaxMemory||268435456,t=l.defaults.blobUrlsMaxQueueSize||200;(l.blobUrlsTotalSize>e||l.blobUrls.length>t)&&1<l.blobUrls.length;){var n=l.blobUrls.splice(0,1)[0];i.revokeObjectURL(n.url),l.blobUrlsTotalSize-=n.size}}})}else{var e=new FileReader;e.onload=function(e){n(function(){s.$ngfDataUrl=e.target.result,o.resolve(e.target.result,s),n(function(){delete s.$ngfDataUrl},1e3)})},e.onerror=function(){n(function(){s.$ngfDataUrl="",o.reject()})},e.readAsDataURL(s)}}else n(function(){s[t?"$ngfDataUrl":"$ngfBlobUrl"]="",o.reject()})}),(e=t?s.$$ngfDataUrlPromise=o.promise:s.$$ngfBlobUrlPromise=o.promise).finally(function(){delete s[t?"$$ngfDataUrlPromise":"$$ngfBlobUrlPromise"]}),e},l}]),r.directive("ngfSrc",["Upload","$timeout",function(i,r){return{restrict:"AE",link:function(e,t,n){o(i,r,e,t,n,"ngfSrc",i.attrGetter("ngfResize",n,e),!1)}}}]),r.directive("ngfBackground",["Upload","$timeout",function(i,r){return{restrict:"AE",link:function(e,t,n){o(i,r,e,t,n,"ngfBackground",i.attrGetter("ngfResize",n,e),!0)}}}]),r.directive("ngfThumbnail",["Upload","$timeout",function(r,s){return{restrict:"AE",link:function(e,t,n){var i=r.attrGetter("ngfSize",n,e);o(r,s,e,t,n,"ngfThumbnail",i,r.attrGetter("ngfAsBackground",n,e))}}}]),r.config(["$compileProvider",function(e){e.imgSrcSanitizationWhitelist&&e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/),e.aHrefSanitizationWhitelist&&e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/)}]),r.filter("ngfDataUrl",["UploadDataUrl","$sce",function(r,s){return function(e,t,n){if(angular.isString(e))return s.trustAsResourceUrl(e);var i=e&&((t?e.$ngfDataUrl:e.$ngfBlobUrl)||e.$ngfDataUrl);return e&&!i?(!e.$ngfDataUrlFilterInProgress&&angular.isObject(e)&&(e.$ngfDataUrlFilterInProgress=!0,r.dataUrl(e,t)),""):(e&&delete e.$ngfDataUrlFilterInProgress,(e&&i?n?s.trustAsResourceUrl(i):i:e)||"")}}]),r.service("UploadValidate",["UploadDataUrl","$q","$timeout",function(e,m,a){var v=e;return v.validatePattern=function(e,t){if(!t)return!0;var n=function e(t){var n="",i=[];if(2<t.length&&"/"===t[0]&&"/"===t[t.length-1])n=t.substring(1,t.length-1);else{var r=t.split(",");if(1<r.length)for(var s=0;s<r.length;s++){var o=e(r[s]);o.regexp?(n+="("+o.regexp+")",s<r.length-1&&(n+="|")):i=i.concat(o.excludes)}else 0===t.indexOf("!")?i.push("^((?!"+e(t.substring(1)).regexp+").)*$"):(0===t.indexOf(".")&&(t="*"+t),n=(n="^"+t.replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")+"$").replace(/\\\*/g,".*").replace(/\\\?/g,"."))}return{regexp:n,excludes:i}}(t),i=!0;if(n.regexp&&n.regexp.length){var r=new RegExp(n.regexp,"i");i=null!=e.type&&r.test(e.type)||null!=e.name&&r.test(e.name)}for(var s=n.excludes.length;s--;){var o=new RegExp(n.excludes[s],"i");i=i&&(null==e.type||o.test(e.type))&&(null==e.name||o.test(e.name))}return i},v.ratioToFloat=function(e){var t=e.toString(),n=t.search(/[x:]/i);return t=-1<n?parseFloat(t.substring(0,n))/parseFloat(t.substring(n+1)):parseFloat(t)},v.registerModelChangeValidator=function(n,i,r){n&&n.$formatters.push(function(e){if(n.$dirty){var t=e;e&&!angular.isArray(e)&&(t=[e]),v.validate(t,0,n,i,r).then(function(){v.applyModelValidation(n,t)})}return e})},v.applyModelValidation=function(t,e){var n;n=t,null==e||n.$dirty||(n.$setDirty?n.$setDirty():n.$dirty=!0),angular.forEach(t.$ngfValidations,function(e){t.$setValidity(e.name,e.valid)})},v.getValidationAttr=function(e,t,n,i,r){var s="ngf"+n[0].toUpperCase()+n.substr(1),o=v.attrGetter(s,e,t,{$file:r});if(null==o&&(o=v.attrGetter("ngfValidate",e,t,{$file:r}))){var a=(i||n).split(".");o=o[a[0]],1<a.length&&(o=o&&o[a[1]])}return o},v.validate=function(c,i,d,h,u){(d=d||{}).$ngfValidations=d.$ngfValidations||[],angular.forEach(d.$ngfValidations,function(e){e.valid=!0});var f=function(e,t){return v.attrGetter(e,h,u,t)},p=(v.attrGetter("ngfIgnoreInvalid",h,u)||"").split(" "),g=v.attrGetter("ngfRunAllValidations",h,u);if(null==c||0===c.length)return v.emptyPromise({validFiles:c,invalidFiles:[]});c=void 0===c.length?[c]:c.slice(0);var _=[];function t(e,t,n){if(c){for(var i=c.length,r=null;i--;){var s=c[i];if(s){var o=v.getValidationAttr(h,u,e,t,s);null!=o&&(n(s,o,i)||(-1===p.indexOf(e)?(s.$error=e,(s.$errorMessages=s.$errorMessages||{})[e]=!0,s.$errorParam=o,-1===_.indexOf(s)&&_.push(s),g||c.splice(i,1),r=!1):c.splice(i,1)))}}null!==r&&d.$ngfValidations.push({name:e,valid:r})}}t("pattern",null,v.validatePattern),t("minSize","size.min",function(e,t){return e.size+.1>=v.translateScalars(t)}),t("maxSize","size.max",function(e,t){return e.size-.1<=v.translateScalars(t)});var n=0;if(t("maxTotalSize",null,function(e,t){if(!((n+=e.size)>v.translateScalars(t)))return 1;c.splice(0,c.length)}),t("validateFn",null,function(e,t){return!0===t||null===t||""===t}),!c.length)return v.emptyPromise({validFiles:[],invalidFiles:_});function e(o,e,i,n,a){function r(i,r,s){function t(e){if(e())if(-1===p.indexOf(o)){if(r.$error=o,(r.$errorMessages=r.$errorMessages||{})[o]=!0,r.$errorParam=s,-1===_.indexOf(r)&&_.push(r),!g){var t=c.indexOf(r);-1<t&&c.splice(t,1)}i.resolve(!1)}else{var n=c.indexOf(r);-1<n&&c.splice(n,1),i.resolve(!0)}else i.resolve(!0)}null!=s?n(r,s).then(function(e){t(function(){return!a(e,s)})},function(){t(function(){return f("ngfValidateForce",{$file:r})})}):i.resolve(!0)}var s=[v.emptyPromise(!0)];c&&(c=void 0===c.length?[c]:c,angular.forEach(c,function(t){var n=m.defer();s.push(n.promise),!i||null!=t.type&&0===t.type.search(i)?"dimensions"===o&&null!=v.attrGetter("ngfDimensions",h)?v.imageDimensions(t).then(function(e){r(n,t,f("ngfDimensions",{$file:t,$width:e.width,$height:e.height}))},function(){n.resolve(!1)}):"duration"===o&&null!=v.attrGetter("ngfDuration",h)?v.mediaDuration(t).then(function(e){r(n,t,f("ngfDuration",{$file:t,$duration:e}))},function(){n.resolve(!1)}):r(n,t,v.getValidationAttr(h,u,o,e,t)):n.resolve(!0)}));var l=m.defer();return m.all(s).then(function(e){for(var t=!0,n=0;n<e.length;n++)if(!e[n]){t=!1;break}d.$ngfValidations.push({name:o,valid:t}),l.resolve(t)}),l.promise}var r=m.defer(),s=[];return s.push(e("maxHeight","height.max",/image/,this.imageDimensions,function(e,t){return e.height<=t})),s.push(e("minHeight","height.min",/image/,this.imageDimensions,function(e,t){return e.height>=t})),s.push(e("maxWidth","width.max",/image/,this.imageDimensions,function(e,t){return e.width<=t})),s.push(e("minWidth","width.min",/image/,this.imageDimensions,function(e,t){return e.width>=t})),s.push(e("dimensions",null,/image/,function(e,t){return v.emptyPromise(t)},function(e){return e})),s.push(e("ratio",null,/image/,this.imageDimensions,function(e,t){for(var n=t.toString().split(","),i=!1,r=0;r<n.length;r++)Math.abs(e.width/e.height-v.ratioToFloat(n[r]))<.01&&(i=!0);return i})),s.push(e("maxRatio","ratio.max",/image/,this.imageDimensions,function(e,t){return e.width/e.height-v.ratioToFloat(t)<1e-4})),s.push(e("minRatio","ratio.min",/image/,this.imageDimensions,function(e,t){return-1e-4<e.width/e.height-v.ratioToFloat(t)})),s.push(e("maxDuration","duration.max",/audio|video/,this.mediaDuration,function(e,t){return e<=v.translateScalars(t)})),s.push(e("minDuration","duration.min",/audio|video/,this.mediaDuration,function(e,t){return e>=v.translateScalars(t)})),s.push(e("duration",null,/audio|video/,function(e,t){return v.emptyPromise(t)},function(e){return e})),s.push(e("validateAsyncFn",null,null,function(e,t){return t},function(e){return!0===e||null===e||""===e})),m.all(s).then(function(){if(g)for(var e=0;e<c.length;e++){c[e].$error&&c.splice(e--,1)}g=!1,t("maxFiles",null,function(e,t,n){return i+n<t}),r.resolve({validFiles:c,invalidFiles:_})}),r.promise},v.imageDimensions=function(s){if(s.$ngfWidth&&s.$ngfHeight){var e=m.defer();return a(function(){e.resolve({width:s.$ngfWidth,height:s.$ngfHeight})}),e.promise}if(s.$ngfDimensionPromise)return s.$ngfDimensionPromise;var o=m.defer();return a(function(){0===s.type.indexOf("image")?v.dataUrl(s).then(function(e){var n=angular.element("<img>").attr("src",e).css("visibility","hidden").css("position","fixed").css("max-width","none !important").css("max-height","none !important");function t(){var e=n[0].naturalWidth||n[0].clientWidth,t=n[0].naturalHeight||n[0].clientHeight;n.remove(),s.$ngfWidth=e,s.$ngfHeight=t,o.resolve({width:e,height:t})}function i(){n.remove(),o.reject("load error")}n.on("load",t),n.on("error",i);var r=0;!function e(){a(function(){n[0].parentNode&&(n[0].clientWidth?t:10<r++?i:e)()},1e3)}(),angular.element(document.getElementsByTagName("body")[0]).append(n)},function(){o.reject("load error")}):o.reject("not image")}),s.$ngfDimensionPromise=o.promise,s.$ngfDimensionPromise.finally(function(){delete s.$ngfDimensionPromise}),s.$ngfDimensionPromise},v.mediaDuration=function(s){if(s.$ngfDuration){var e=m.defer();return a(function(){e.resolve(s.$ngfDuration)}),e.promise}if(s.$ngfDurationPromise)return s.$ngfDurationPromise;var o=m.defer();return a(function(){0===s.type.indexOf("audio")||0===s.type.indexOf("video")?v.dataUrl(s).then(function(e){var t=angular.element(0===s.type.indexOf("audio")?"<audio>":"<video>").attr("src",e).css("visibility","none").css("position","fixed");function n(){var e=t[0].duration;s.$ngfDuration=e,t.remove(),o.resolve(e)}function i(){t.remove(),o.reject("load error")}t.on("loadedmetadata",n),t.on("error",i);var r=0;!function e(){a(function(){t[0].parentNode&&(t[0].duration?n:10<r?i:e)()},1e3)}(),angular.element(document.body).append(t)},function(){o.reject("load error")}):o.reject("not media")}),s.$ngfDurationPromise=o.promise,s.$ngfDurationPromise.finally(function(){delete s.$ngfDurationPromise}),s.$ngfDurationPromise},v}]),r.service("UploadResize",["UploadValidate","$q",function(e,t){function o(e,c,d,h,u,f,p,g){var _=t.defer(),m=document.createElement("canvas"),v=document.createElement("img");return v.setAttribute("style","visibility:hidden;position:fixed;z-index:-100000"),document.body.appendChild(v),v.onload=function(){var e,t,n,i,r,s=v.width,o=v.height;if(v.parentNode.removeChild(v),null==g||!1!==g(s,o))try{if(f){var a=y.ratioToFloat(f);s/o<a?d=(c=s)/a:c=(d=o)*a}var l=(e=s,t=o,n=c=c||s,i=d=d||o,r=p?Math.max(n/e,i/t):Math.min(n/e,i/t),{width:e*r,height:t*r,marginX:e*r-n,marginY:t*r-i});m.width=Math.min(l.width,c),m.height=Math.min(l.height,d),m.getContext("2d").drawImage(v,Math.min(0,-l.marginX/2),Math.min(0,-l.marginY/2),l.width,l.height),_.resolve(m.toDataURL(u||"image/WebP",h||.934))}catch(e){_.reject(e)}else _.reject("resizeIf")},v.onerror=function(){v.parentNode.removeChild(v),_.reject()},v.src=e,_.promise}var y=e;return y.dataUrltoBlob=function(e,t,n){for(var i=e.split(","),r=i[0].match(/:(.*?);/)[1],s=atob(i[1]),o=s.length,a=new Uint8Array(o);o--;)a[o]=s.charCodeAt(o);var l=new window.Blob([a],{type:r});return l.name=t,l.$ngfOrigSize=n,l},y.isResizeSupported=function(){var e=document.createElement("canvas");return window.atob&&e.getContext&&e.getContext("2d")&&window.Blob},y.isResizeSupported()&&Object.defineProperty(window.Blob.prototype,"name",{get:function(){return this.$ngfName},set:function(e){this.$ngfName=e},configurable:!0}),y.resize=function(i,r){if(0!==i.type.indexOf("image"))return y.emptyPromise(i);var s=t.defer();return y.dataUrl(i,!0).then(function(n){o(n,r.width,r.height,r.quality,r.type||i.type,r.ratio,r.centerCrop,r.resizeIf).then(function(e){if("image/jpeg"===i.type&&!1!==r.restoreExif)try{e=y.restoreExif(n,e)}catch(e){setTimeout(function(){throw e},1)}try{var t=y.dataUrltoBlob(e,i.name,i.size);s.resolve(t)}catch(e){s.reject(e)}},function(e){"resizeIf"===e&&s.resolve(i),s.reject(e)})},function(e){s.reject(e)}),s.promise},y}]),r.directive("ngfDrop",["$parse","$timeout","$window","Upload","$http","$q",function(r,s,o,a,e,l){return{restrict:"AEC",require:"?ngModel",link:function(e,t,n,i){!function(m,n,v,i,e,r,y,b,x){var t=u(),w=function(e,t,n){return b.attrGetter(e,v,t,n)};w("dropAvailable")&&r(function(){m[w("dropAvailable")]?m[w("dropAvailable")].value=t:m[w("dropAvailable")]=t});if(!t)return!0===w("ngfHideOnDropNotAvailable",m)&&n.css("display","none");function s(){return n.attr("disabled")||w("ngfDropDisabled",m)}null==w("ngfSelect")&&b.registerModelChangeValidator(i,v,m);var o,a=null,l=e(w("ngfStopPropagation")),c=1;n[0].addEventListener("dragover",function(t){if(!s()&&b.shouldUpdateOn("drop",v,m)){if(t.preventDefault(),l(m)&&t.stopPropagation(),-1<navigator.userAgent.indexOf("Chrome")){var e=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy"}r.cancel(a),o||(o="C",function(e,t,n){var i=w("ngfDragOverClass",e,{$event:t}),r="dragover";if(angular.isString(i))r=i;else if(i&&(i.delay&&(c=i.delay),i.accept||i.reject)){var s=t.dataTransfer.items;if(null!=s&&s.length)for(var o=i.pattern||w("ngfPattern",e,{$event:t}),a=s.length;a--;){if(!b.validatePattern(s[a],o)){r=i.reject;break}r=i.accept}else r=i.accept}n(r)}(m,t,function(e){o=e,n.addClass(o),w("ngfDrag",m,{$isDragging:!0,$class:o,$event:t})}))}},!1),n[0].addEventListener("dragenter",function(e){!s()&&b.shouldUpdateOn("drop",v,m)&&(e.preventDefault(),l(m)&&e.stopPropagation())},!1),n[0].addEventListener("dragleave",function(e){!s()&&b.shouldUpdateOn("drop",v,m)&&(e.preventDefault(),l(m)&&e.stopPropagation(),a=r(function(){o&&n.removeClass(o),o=null,w("ngfDrag",m,{$isDragging:!1,$event:e})},c||100))},!1),n[0].addEventListener("drop",function(e){!s()&&b.shouldUpdateOn("drop",v,m)&&(e.preventDefault(),l(m)&&e.stopPropagation(),o&&n.removeClass(o),o=null,d(e.dataTransfer,e,"dropUrl"))},!1),n[0].addEventListener("paste",function(e){-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&w("ngfEnableFirefoxPaste",m)&&e.preventDefault(),!s()&&b.shouldUpdateOn("paste",v,m)&&d(e.clipboardData||e.originalEvent.clipboardData,e,"pasteUrl")},!1),-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&w("ngfEnableFirefoxPaste",m)&&(n.attr("contenteditable",!0),n.on("keypress",function(e){e.metaKey||e.ctrlKey||e.preventDefault()}));function d(e,t,n){if(e){var i;try{i=e&&e.getData&&e.getData("text/html")}catch(e){}(function(e,t,n,i){var l=b.getValidationAttr(v,m,"maxFiles");null==l&&(l=Number.MAX_VALUE);var c=b.getValidationAttr(v,m,"maxTotalSize");null==c&&(c=Number.MAX_VALUE);var d=w("ngfIncludeDir",m),h=[],u=0;function f(t,n){var i=x.defer();if(null!=t)if(t.isDirectory){var r=[b.emptyPromise()];if(d){var e={type:"directory"};e.name=e.path=(n||"")+t.name,h.push(e)}var s=t.createReader(),o=[],a=function(){s.readEntries(function(e){try{e.length?(o=o.concat(Array.prototype.slice.call(e||[],0)),a()):(angular.forEach(o.slice(0),function(e){h.length<=l&&u<=c&&r.push(f(e,(n||"")+t.name+"/"))}),x.all(r).then(function(){i.resolve()},function(e){i.reject(e)}))}catch(e){i.reject(e)}},function(e){i.reject(e)})};a()}else t.file(function(e){try{e.path=(n||"")+e.name,d&&(e=b.rename(e,e.path)),h.push(e),u+=e.size,i.resolve()}catch(e){i.reject(e)}},function(e){i.reject(e)});return i.promise}var r=[b.emptyPromise()];if(e&&0<e.length&&"file:"!==y.location.protocol)for(var s=0;s<e.length;s++){if(e[s].webkitGetAsEntry&&e[s].webkitGetAsEntry()&&e[s].webkitGetAsEntry().isDirectory){var o=e[s].webkitGetAsEntry();if(o.isDirectory&&!n)continue;null!=o&&r.push(f(o))}else{var a=e[s].getAsFile();null!=a&&(h.push(a),u+=a.size)}if(h.length>l||c<u||!i&&0<h.length)break}else if(null!=t)for(var p=0;p<t.length;p++){var g=t.item(p);if((g.type||0<g.size)&&(h.push(g),u+=g.size),h.length>l||c<u||!i&&0<h.length)break}var _=x.defer();return x.all(r).then(function(){if(i||d||!h.length)_.resolve(h);else{for(var e=0;h[e]&&"directory"===h[e].type;)e++;_.resolve([h[e]])}},function(e){_.reject(e)}),_.promise})(e.items,e.files,!1!==w("ngfAllowDir",m),w("multiple")||w("ngfMultiple",m)).then(function(e){e.length?h(e,t):function(e,t){if(!b.shouldUpdateOn(e,v,m)||"string"!=typeof t)return b.rejectPromise([]);var i=[];t.replace(/<(img src|img [^>]* src) *=\"([^\"]*)\"/gi,function(e,t,n){i.push(n)});var n=[],r=[];if(i.length){angular.forEach(i,function(e){n.push(b.urlToBlob(e).then(function(e){r.push(e)}))});var s=x.defer();return x.all(n).then(function(){s.resolve(r)},function(e){s.reject(e)}),s.promise}return b.emptyPromise()}(n,i).then(function(e){h(e,t)})})}}function h(e,t){b.updateModel(i,v,m,w("ngfChange")||w("ngfDrop"),e,t)}}(e,t,n,i,r,s,o,a,l)}}}]),r.directive("ngfNoFileDrop",function(){return function(e,t){u()&&t.css("display","none")}}),r.directive("ngfDropAvailable",["$parse","$timeout","Upload",function(r,s,o){return function(e,t,n){if(u()){var i=r(o.attrGetter("ngfDropAvailable",n));s(function(){i(e),i.assign&&i.assign(e,!0)})}}}]),r.service("UploadExif",["UploadResize","$q",function(e,i){var l=e;return l.isExifSupported=function(){return window.FileReader&&(new FileReader).readAsArrayBuffer&&l.isResizeSupported()},l.readOrientation=function(e){var d=i.defer(),t=new FileReader,n=e.slice?e.slice(0,65536):e;return t.readAsArrayBuffer(n),t.onerror=function(e){return d.reject(e)},t.onload=function(e){var t={orientation:1},n=new DataView(this.result);if(65496!==n.getUint16(0,!1))return d.resolve(t);for(var i=n.byteLength,r=2;r<i;){var s=n.getUint16(r,!1);if(r+=2,65505===s){if(1165519206!==n.getUint32(r+=2,!1))return d.resolve(t);var o=18761===n.getUint16(r+=6,!1);r+=n.getUint32(r+4,o);var a=n.getUint16(r,o);r+=2;for(var l=0;l<a;l++)if(274===n.getUint16(r+12*l,o)){var c=n.getUint16(r+12*l+8,o);return 2<=c&&c<=8&&(n.setUint16(r+12*l+8,1,o),t.fixedArrayBuffer=e.target.result),t.orientation=c,d.resolve(t)}}else{if(65280!=(65280&s))break;r+=n.getUint16(r,!1)}}return d.resolve(t)},d.promise},l.applyExifRotation=function(o){if(0!==o.type.indexOf("image/jpeg"))return l.emptyPromise(o);var a=i.defer();return l.readOrientation(o).then(function(s){if(s.orientation<2||8<s.orientation)return a.resolve(o);l.dataUrl(o,!0).then(function(e){var i=document.createElement("canvas"),r=document.createElement("img");r.onload=function(){try{i.width=4<s.orientation?r.height:r.width,i.height=4<s.orientation?r.width:r.height;var e=i.getContext("2d");!function(e,t,n,i){switch(t){case 2:return e.transform(-1,0,0,1,n,0);case 3:return e.transform(-1,0,0,-1,n,i);case 4:return e.transform(1,0,0,-1,0,i);case 5:return e.transform(0,1,1,0,0,0);case 6:return e.transform(0,1,-1,0,i,0);case 7:return e.transform(0,-1,-1,0,i,n);case 8:e.transform(0,-1,1,0,0,n)}}(e,s.orientation,r.width,r.height),e.drawImage(r,0,0);var t=i.toDataURL(o.type||"image/WebP",.934);t=l.restoreExif(function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=0;r<i;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}(s.fixedArrayBuffer),t);var n=l.dataUrltoBlob(t,o.name);a.resolve(n)}catch(e){return a.reject(e)}},r.onerror=function(){a.reject()},r.src=e},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},l.restoreExif=function(e,t){var n={KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){for(var t,n,i,r,s,o="",a="",l="",c=0;i=(t=e[c++])>>2,r=(3&t)<<4|(n=e[c++])>>4,s=(15&n)<<2|(a=e[c++])>>6,l=63&a,isNaN(n)?s=l=64:isNaN(a)&&(l=64),o=o+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(s)+this.KEY_STR.charAt(l),t=n=a="",i=r=s=l="",c<e.length;);return o},restore:function(e,t){e.match("data:image/jpeg;base64,")&&(e=e.replace("data:image/jpeg;base64,",""));var n=this.decode64(e),i=this.slice2Segments(n),r=this.exifManipulation(t,i);return"data:image/jpeg;base64,"+this.encode64(r)},exifManipulation:function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n);return new Uint8Array(i)},getExifArray:function(e){for(var t,n=0;n<e.length;n++)if(255===(t=e[n])[0]&225===t[1])return t;return[]},insertExif:function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),r=i.indexOf(255,3),s=i.slice(0,r),o=i.slice(r),a=s;return a=(a=a.concat(t)).concat(o)},slice2Segments:function(e){for(var t=0,n=[];!(255===e[t]&218===e[t+1]);){if(255===e[t]&216===e[t+1])t+=2;else{var i=t+(256*e[t+2]+e[t+3])+2,r=e.slice(t,i);n.push(r),t=i}if(t>e.length)break}return n},decode64:function(e){var t,n,i,r,s="",o="",a=0,l=[];for(/[^A-Za-z0-9\+\/\=]/g.exec(e),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");t=this.KEY_STR.indexOf(e.charAt(a++))<<2|(i=this.KEY_STR.indexOf(e.charAt(a++)))>>4,n=(15&i)<<4|(r=this.KEY_STR.indexOf(e.charAt(a++)))>>2,s=(3&r)<<6|(o=this.KEY_STR.indexOf(e.charAt(a++))),l.push(t),64!==r&&l.push(n),64!==o&&l.push(s),t=n=s="",i=r=o="",a<e.length;);return l}};return n.restore(e,t)},l}])}).call(this,n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/jquery/dist/jquery.js"))},"./node_modules/ng-file-upload/index.js":function(e,t,n){n("./node_modules/ng-file-upload/dist/ng-file-upload-all.js"),e.exports="ngFileUpload"}}]);